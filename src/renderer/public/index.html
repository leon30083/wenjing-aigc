<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WinJin AIGC - è§†é¢‘ç”Ÿæˆ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      background: rgba(255, 255, 255, 0.95);
      padding: 24px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .header h1 {
      color: #333;
      font-size: 28px;
      margin-bottom: 8px;
    }

    .header p {
      color: #666;
      font-size: 14px;
    }

    .platform-selector {
      margin-top: 16px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .platform-selector label {
      font-weight: 600;
      color: #555;
    }

    .platform-selector select {
      padding: 8px 16px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
    }

    .tabs {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
    }

    .tab {
      padding: 12px 24px;
      background: rgba(255, 255, 255, 0.9);
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 500;
      color: #555;
      transition: all 0.2s;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .tab:hover {
      background: rgba(255, 255, 255, 1);
      transform: translateY(-2px);
    }

    .tab.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .tab-content {
      display: none;
      background: rgba(255, 255, 255, 0.95);
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .tab-content.active {
      display: block;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      font-weight: 600;
      color: #333;
      margin-bottom: 8px;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.2s;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: #667eea;
    }

    .form-group textarea {
      min-height: 120px;
      resize: vertical;
    }

    .form-row {
      display: flex;
      gap: 16px;
    }

    .form-row .form-group {
      flex: 1;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary {
      background: #f0f0f0;
      color: #333;
    }

    .btn-secondary:hover {
      background: #e0e0e0;
    }

    .result-box {
      margin-top: 20px;
      padding: 16px;
      border-radius: 8px;
      display: none;
    }

    .result-box.success {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
    }

    .result-box.error {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }

    .result-box.show {
      display: block;
    }

    .shots-container {
      margin-top: 16px;
    }

    .shot-item {
      display: flex;
      gap: 12px;
      margin-bottom: 12px;
      align-items: flex-start;
    }

    .shot-item input {
      flex: 1;
    }

    .shot-item input[type='number'] {
      flex: 0 0 100px;
    }

    .shot-item button {
      padding: 8px 16px;
      background: #f0f0f0;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .shot-item button:hover {
      background: #e0e0e0;
    }

    .loading {
      display: none;
      text-align: center;
      padding: 20px;
    }

    .loading.show {
      display: block;
    }

    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .video-preview {
      margin-top: 16px;
    }

    .video-preview video {
      max-width: 100%;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ¬ WinJin AIGC</h1>
      <p>Sora2 è§†é¢‘ç”Ÿæˆå·¥å…· - æ”¯æŒèšé‘«/è´è´åŒå¹³å°</p>
      <div class="platform-selector">
        <label for="platform-select">é€‰æ‹©å¹³å°ï¼š</label>
        <select id="platform-select">
          <option value="juxin">èšé‘« (api.jxincm.cn)</option>
          <option value="zhenzhen">è´è´ (ai.t8star.cn)</option>
        </select>
      </div>
    </div>

    <div class="tabs">
      <button class="tab active" data-tab="video">æ–‡ç”Ÿè§†é¢‘</button>
      <button class="tab" data-tab="storyboard">æ•…äº‹æ¿ï¼ˆæ‰¹é‡ï¼‰</button>
      <button class="tab" data-tab="character">åˆ›å»ºè§’è‰²</button>
      <button class="tab" data-tab="task">æŸ¥è¯¢ä»»åŠ¡</button>
    </div>

    <!-- æ–‡ç”Ÿè§†é¢‘ -->
    <div class="tab-content active" id="video-tab">
      <div class="form-group">
        <label for="video-prompt">æç¤ºè¯</label>
        <textarea id="video-prompt" placeholder="æè¿°ä½ æƒ³è¦ç”Ÿæˆçš„è§†é¢‘å†…å®¹..."></textarea>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="video-model">æ¨¡å‹</label>
          <select id="video-model">
            <option value="sora-2">Sora-2</option>
            <option value="sora-2-pro">Sora-2 Pro</option>
          </select>
        </div>
        <div class="form-group">
          <label for="video-orientation">ç”»é¢æ–¹å‘</label>
          <select id="video-orientation">
            <option value="landscape">æ¨ªå± (16:9)</option>
            <option value="portrait">ç«–å± (9:16)</option>
          </select>
        </div>
        <div class="form-group">
          <label for="video-duration">æ—¶é•¿ï¼ˆç§’ï¼‰</label>
          <select id="video-duration">
            <option value="10">10ç§’</option>
            <option value="15">15ç§’</option>
            <option value="25">25ç§’</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="video-size">åˆ†è¾¨ç‡</label>
          <select id="video-size">
            <option value="small">æ ‡æ¸…</option>
            <option value="large">é«˜æ¸…</option>
          </select>
        </div>
        <div class="form-group">
          <label for="video-watermark">æ°´å°</label>
          <select id="video-watermark">
            <option value="false">æ— æ°´å°</option>
            <option value="true">æœ‰æ°´å°</option>
          </select>
        </div>
      </div>
      <button class="btn btn-primary" id="video-create-btn">åˆ›å»ºè§†é¢‘</button>
      <div class="loading" id="video-loading">
        <div class="spinner"></div>
        <p>æ­£åœ¨åˆ›å»ºè§†é¢‘...</p>
      </div>
      <div class="result-box" id="video-result"></div>
    </div>

    <!-- æ•…äº‹æ¿ -->
    <div class="tab-content" id="storyboard-tab">
      <div class="form-group">
        <label>é•œå¤´åˆ—è¡¨</label>
        <div class="shots-container" id="shots-container">
          <div class="shot-item">
            <input type="number" placeholder="æ—¶é•¿(ç§’)" value="5" class="shot-duration" />
            <input type="text" placeholder="åœºæ™¯æè¿°" class="shot-scene" />
            <button class="btn-remove-shot">åˆ é™¤</button>
          </div>
        </div>
        <button class="btn btn-secondary" id="add-shot-btn" style="margin-top: 12px;">+ æ·»åŠ é•œå¤´</button>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="storyboard-model">æ¨¡å‹</label>
          <select id="storyboard-model">
            <option value="sora-2">Sora-2</option>
            <option value="sora-2-pro">Sora-2 Pro</option>
          </select>
        </div>
        <div class="form-group">
          <label for="storyboard-orientation">ç”»é¢æ–¹å‘</label>
          <select id="storyboard-orientation">
            <option value="landscape">æ¨ªå± (16:9)</option>
            <option value="portrait">ç«–å± (9:16)</option>
          </select>
        </div>
        <div class="form-group">
          <label for="storyboard-size">åˆ†è¾¨ç‡</label>
          <select id="storyboard-size">
            <option value="small">æ ‡æ¸…</option>
            <option value="large">é«˜æ¸…</option>
          </select>
        </div>
      </div>
      <button class="btn btn-primary" id="storyboard-create-btn">åˆ›å»ºæ•…äº‹æ¿è§†é¢‘</button>
      <div class="loading" id="storyboard-loading">
        <div class="spinner"></div>
        <p>æ­£åœ¨åˆ›å»ºæ•…äº‹æ¿è§†é¢‘...</p>
      </div>
      <div class="result-box" id="storyboard-result"></div>
    </div>

    <!-- åˆ›å»ºè§’è‰² -->
    <div class="tab-content" id="character-tab">
      <div class="form-group">
        <label for="character-url">è§†é¢‘é“¾æ¥</label>
        <input type="text" id="character-url" placeholder="è¾“å…¥è§†é¢‘ URL..." />
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="character-start">å¼€å§‹æ—¶é—´ï¼ˆç§’ï¼‰</label>
          <input type="number" id="character-start" value="1" min="0" step="0.1" />
        </div>
        <div class="form-group">
          <label for="character-end">ç»“æŸæ—¶é—´ï¼ˆç§’ï¼‰</label>
          <input type="number" id="character-end" value="3" min="0" step="0.1" />
        </div>
      </div>
      <p style="color: #666; font-size: 13px; margin-bottom: 16px;">
        æ³¨æ„ï¼šæ—¶é—´èŒƒå›´å·®å€¼å¿…é¡»æ˜¯ 1-3 ç§’
      </p>
      <button class="btn btn-primary" id="character-create-btn">åˆ›å»ºè§’è‰²</button>
      <div class="loading" id="character-loading">
        <div class="spinner"></div>
        <p>æ­£åœ¨åˆ›å»ºè§’è‰²...</p>
      </div>
      <div class="result-box" id="character-result"></div>
    </div>

    <!-- æŸ¥è¯¢ä»»åŠ¡ -->
    <div class="tab-content" id="task-tab">
      <div class="form-group">
        <label for="task-id">ä»»åŠ¡ ID</label>
        <input type="text" id="task-id" placeholder="è¾“å…¥ä»»åŠ¡ ID..." />
      </div>
      <button class="btn btn-primary" id="task-query-btn">æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€</button>
      <div class="loading" id="task-loading">
        <div class="spinner"></div>
        <p>æ­£åœ¨æŸ¥è¯¢...</p>
      </div>
      <div class="result-box" id="task-result"></div>
      <div class="video-preview" id="video-preview"></div>
    </div>
  </div>

  <script>
    const API_BASE = 'http://localhost:9000/api';
    let currentPlatform = 'juxin';

    // å¹³å°åˆ‡æ¢
    document.getElementById('platform-select').addEventListener('change', (e) => {
      currentPlatform = e.target.value;
      console.log('Switched to platform:', currentPlatform);
    });

    // æ ‡ç­¾é¡µåˆ‡æ¢
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.tab + '-tab').classList.add('active');
      });
    });

    // é€šç”¨ç»“æœæ˜¾ç¤º
    function showResult(elementId, success, message, data) {
      const resultBox = document.getElementById(elementId);
      resultBox.className = `result-box ${success ? 'success' : 'error'} show`;
      let html = `<strong>${success ? 'æˆåŠŸ' : 'å¤±è´¥'}</strong><br>${message}`;
      if (data && success) {
        html += `<br><pre>${JSON.stringify(data, null, 2)}</pre>`;
      }
      resultBox.innerHTML = html;
    }

    // é€šç”¨åŠ è½½çŠ¶æ€
    function setLoading(loadingId, btnId, loading) {
      const loadingEl = document.getElementById(loadingId);
      const btn = document.getElementById(btnId);
      if (loading) {
        loadingEl.classList.add('show');
        btn.disabled = true;
      } else {
        loadingEl.classList.remove('show');
        btn.disabled = false;
      }
    }

    // åˆ›å»ºè§†é¢‘
    document.getElementById('video-create-btn').addEventListener('click', async () => {
      const prompt = document.getElementById('video-prompt').value.trim();
      if (!prompt) {
        showResult('video-result', false, 'è¯·è¾“å…¥æç¤ºè¯');
        return;
      }

      setLoading('video-loading', 'video-create-btn', true);

      try {
        const response = await fetch(`${API_BASE}/video/create`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            platform: currentPlatform,
            prompt: prompt,
            model: document.getElementById('video-model').value,
            orientation: document.getElementById('video-orientation').value,
            duration: parseInt(document.getElementById('video-duration').value),
            size: document.getElementById('video-size').value,
            watermark: document.getElementById('video-watermark').value === 'true',
            private: true,
            images: [],
          }),
        });

        const result = await response.json();
        showResult('video-result', result.success, result.error || 'ä»»åŠ¡å·²åˆ›å»º', result.data);
      } catch (error) {
        showResult('video-result', false, `ç½‘ç»œé”™è¯¯: ${error.message}`);
      } finally {
        setLoading('video-loading', 'video-create-btn', false);
      }
    });

    // æ•…äº‹æ¿ - æ·»åŠ /åˆ é™¤é•œå¤´
    document.getElementById('add-shot-btn').addEventListener('click', () => {
      const container = document.getElementById('shots-container');
      const shotItem = document.createElement('div');
      shotItem.className = 'shot-item';
      shotItem.innerHTML = `
        <input type="number" placeholder="æ—¶é•¿(ç§’)" value="5" class="shot-duration" />
        <input type="text" placeholder="åœºæ™¯æè¿°" class="shot-scene" />
        <button class="btn-remove-shot">åˆ é™¤</button>
      `;
      container.appendChild(shotItem);
      shotItem.querySelector('.btn-remove-shot').addEventListener('click', () => {
        shotItem.remove();
      });
    });

    document.querySelectorAll('.btn-remove-shot').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.target.closest('.shot-item').remove();
      });
    });

    // åˆ›å»ºæ•…äº‹æ¿è§†é¢‘
    document.getElementById('storyboard-create-btn').addEventListener('click', async () => {
      const shots = [];
      document.querySelectorAll('.shot-item').forEach(item => {
        const duration = item.querySelector('.shot-duration').value;
        const scene = item.querySelector('.shot-scene').value.trim();
        if (scene) {
          shots.push({ duration: parseFloat(duration), scene });
        }
      });

      if (shots.length === 0) {
        showResult('storyboard-result', false, 'è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªé•œå¤´');
        return;
      }

      setLoading('storyboard-loading', 'storyboard-create-btn', true);

      try {
        const response = await fetch(`${API_BASE}/video/storyboard`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            platform: currentPlatform,
            shots: shots,
            model: document.getElementById('storyboard-model').value,
            orientation: document.getElementById('storyboard-orientation').value,
            size: document.getElementById('storyboard-size').value,
            watermark: false,
            private: true,
            images: [],
          }),
        });

        const result = await response.json();
        showResult('storyboard-result', result.success, result.error || 'æ•…äº‹æ¿ä»»åŠ¡å·²åˆ›å»º', result.data);
      } catch (error) {
        showResult('storyboard-result', false, `ç½‘ç»œé”™è¯¯: ${error.message}`);
      } finally {
        setLoading('storyboard-loading', 'storyboard-create-btn', false);
      }
    });

    // åˆ›å»ºè§’è‰²
    document.getElementById('character-create-btn').addEventListener('click', async () => {
      const url = document.getElementById('character-url').value.trim();
      const start = document.getElementById('character-start').value;
      const end = document.getElementById('character-end').value;

      if (!url) {
        showResult('character-result', false, 'è¯·è¾“å…¥è§†é¢‘é“¾æ¥');
        return;
      }

      const timestamps = `${start},${end}`;
      const diff = end - start;
      if (diff < 1 || diff > 3) {
        showResult('character-result', false, 'æ—¶é—´èŒƒå›´å·®å€¼å¿…é¡»æ˜¯ 1-3 ç§’');
        return;
      }

      setLoading('character-loading', 'character-create-btn', true);

      try {
        const response = await fetch(`${API_BASE}/character/create`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            platform: currentPlatform,
            url: url,
            timestamps: timestamps,
          }),
        });

        const result = await response.json();
        showResult('character-result', result.success, result.error || 'è§’è‰²åˆ›å»ºæˆåŠŸ', result.data);
      } catch (error) {
        showResult('character-result', false, `ç½‘ç»œé”™è¯¯: ${error.message}`);
      } finally {
        setLoading('character-loading', 'character-create-btn', false);
      }
    });

    // æŸ¥è¯¢ä»»åŠ¡
    document.getElementById('task-query-btn').addEventListener('click', async () => {
      const taskId = document.getElementById('task-id').value.trim();
      if (!taskId) {
        showResult('task-result', false, 'è¯·è¾“å…¥ä»»åŠ¡ ID');
        return;
      }

      setLoading('task-loading', 'task-query-btn', true);
      document.getElementById('video-preview').innerHTML = '';

      try {
        const response = await fetch(`${API_BASE}/task/${taskId}?platform=${currentPlatform}`);
        const result = await response.json();

        if (result.success && result.data) {
          const data = result.data;
          let message = `çŠ¶æ€: ${data.status}`;
          if (data.status === 'SUCCESS' && data.data?.output) {
            message += '<br>è§†é¢‘å·²ç”Ÿæˆå®Œæˆï¼';
            document.getElementById('video-preview').innerHTML = `
              <video controls src="${data.data.output}"></video>
            `;
          } else if (data.status === 'FAILURE') {
            message += `<br>å¤±è´¥åŸå› : ${data.fail_reason || 'æœªçŸ¥é”™è¯¯'}`;
          }
          showResult('task-result', true, message, data);
        } else {
          showResult('task-result', false, result.error || 'æŸ¥è¯¢å¤±è´¥');
        }
      } catch (error) {
        showResult('task-result', false, `ç½‘ç»œé”™è¯¯: ${error.message}`);
      } finally {
        setLoading('task-loading', 'task-query-btn', false);
      }
    });
  </script>
</body>
</html>
