## 接下来我想完善以下功能：
### 视频生成节点：
    - 目前的比例参数不对，sora2没有1:1比例，取消掉。
    - 增加时长选项，值对齐API的时长参数。

### 任务结果节点：
    - 增加手动查询功能，和之前网页中的查询功能一致，以便用户手动获取结果。
    - 显示视频下载链接，并且提供快速复制链接的功能。
    - 任务ID也提示快速复制功能。

### 增加工作流管理功能：
    - 初步实现工作流保存、另存、新建等功能。
    - 增加工作流可视化编辑功能，用户可以通过拖拽节点的方式来编辑工作流。

### 接下来测试角色生成工作流是否正常运行
### 节点管理有以下bug要处理：
- 在节点上点击右键，删除节点时，是删除当前选中的节点，而不是删除当前画布中的所有节点。
- 在画布上右击空白区域，弹出菜单，新建节点时，新建的节点应该出现在鼠标所在位置，而不是默认位置。
### 角色生成有以下问题解决：
1. 需要生成专门的角色结果获取节点，用于获取角色生成任务的结果。
2. 角色结果节点需要显示角色的详细信息，包括角色ID、名称、别名等。
3. 角色结果节点需要增加一个按钮，用于复制角色ID到剪贴板。
4. 角色生成结果与角色库是什么关系，请引导我梳理这个关系。

### 测试角色库节点功能
1. 测试角色库节点是否可以正常显示角色列表。

  增强：
  - 添加角色删除功能（单个删除/批量删除）
  - 添加角色编辑功能（修改别名）
  - 添加角色详情页面
 
2. 测试角色生成视频的工作流：
    - 按照角色库节点-视频生成节点-任务结果节点的顺序连接节点。
    - 但是在视频生成节点中，如何在指令中引用角色？
      请思考以下指令如何快速输入：
      示例指令： @user_name1 一边吃饭，一边和和 @user_name2 聊天。
      建议你参考网页版中的角色快速调用方式。
      先不要写代码，先思考如何实现，梳理一下实现流程。

很好，单角色正确传递到了视频生成节点。
- 接下来需要实现多角色传递，而不是像现在这样只能点选一个角色。
---
视频生成节点需要做以下调整：
- 取消自动填写角色功能，完全参考网页版中的角色调用方式。那种方式经验验证，非常灵活，方便。
---
请根据以上内容，规划代码实现，先不要写代码，先规划一下实现流程。

---

很好，角色调用功能已经实现。
- 角色库节点中的批量删除有歧义，应该改成【角色编辑】。


很好，现在增加节点功能增强：
- 所有节点的大小可以调整，类似comfyui的节点大小调整功能，用户用鼠标拖动节点的边框来调整节点的大小。
- 视频生成节点的指令输入框里，按住鼠标左键应该是选中文本，而不是移动节点。
- 原则上，节点的操作习惯应该和comfyui保持一致。

好的，接下来按照同样的逻辑，把所有节点大小调整功能实现。
----
接下来我们要重点测试故事板功能是否正常运行，目前的故事板节点还是初代版本，功能比较简单。
可能需要你参考视频生成节点的功能，结合网页版的故事板功能，做一次初步的梳理。
先不要写代码，先思考一下实现流程。

我看到你刚才连续犯了两次重大错误：
1. 使用错误的服务器启动方式；
2. 在网页版中去调试，竟然忘记了当前我们的重要任务是画布工作流。
为避免再次出现类似错误，我想请你更新文档，把这两点都写清楚。

---
现在我们来完整测试画布故事板生成视频工作流，我已连接好节点，请你执行测试。
据我观察，当前故事板节点，角色调用功能不正常，在指令里调用的是角色别名，并且没有像视频生成节点那样显示传递给API的指令。
你可以截图查看。

---
请用这张图作为测试用参考图，再
测试用参考图：https://lowly-rain-658.notion.site/image/attachment%3Ae04902db-f0e0-4b5f-81b0-1eec1874872e%3Aview_144a2b95.png?table=block&id=2d8a3f92-69aa-8055-9a2d-d8881e3b4aa6&spaceId=86aa3f92-69aa-81db-ab3d-00033d2c4978&width=290&userId=&cache=v2

---
有以下问题：
 - 角色库节点，选中角色后，视频生成节点和故事板节点没有立即更新角色信息。
 - 参考图片节点，选中图片后，视频生成节点和故事板节点没有立即更新图片信息。取消选中图片后，视频生成节点和故事板节点也没有更新。
 - 上一个任务失败后，重新在视频生成节点提交任务，重新提交的任务API后台显示成功了，但任务结果节点没有更新。我手动查询任务结果，又显示成功了。
   这是一个bug，需要修复。
- 加载历史记录的工作流时，角色库节点没有选中对应的角色；任务结果节点没有显示成功的任务结果，仍然是空白。【我想请你检查任务节点查询到的视频，有没有下载到本地，如果没有下载到本地，需要调整这个节点的逻辑，视频是需要 下载到本地，然后显示在任务结果节点中。这样方便后续使用。】

2026-1-1-10.00

---
很好，角色和参考图随选更新的问题确实解决了，但是还有以下问题，请记录：
- 加载历史记录的工作流时，工作流的状态并不是生成任务时的状态，比如我刚才加载了最新历史记录的工作流，工作流的参数是最新历史记录的参考，但“任务结果”节点显示的视频却是之前小猫视频的生成结果。
- 请你记录下这个问题，然后总结节点修复的经验，并更新文档，做一次推送。
- 注意：这次修复意义重大，调整了很多东西，可能要修正很多之前错误的信息，请先使用plan模式。


---
工欲善其事，必先利其器。把以下自动化测试流程加入到文档中：
你可以在浏览器点击测试，不要总是问我，配置的mcp工具，除了使用连线连接节点和模拟鼠标拖拽完成不了，其它的大部分任务都可以完成，所以，每一个任务都要使用这种方式在浏览器中测试。
如果测试中有工具不能完成的操作，请告诉用户，叫用户协同完成测试，现在请把这种自动化调试流程加入到你的开发流程中，并严格执行【这是一个基础标准范式，不能被其它信息淹没，所以要记录到合适的位置】

---
- 取消历史记录中的下载功能
- 历史记录里有一些多余的按钮，显示不清楚，而且也是不需要 的功能，请删除。说见截图：D:\user\github\winjin\用户输入文件夹\开发对话\image.png

---
---

调整以下配置：
  - 接聚鑫平台通知，sora2模型更名为：sora-2-all
  - 贞贞平台不变
  - 项目显示名称换成：AI star视频工作台
---
任务结果节点：
- 显示任务进度百分比
工作流菜单：
打开工作流找不到保存的工作流。

---
测试角色库、参考图片节点一对多功能与两个故事板节点的协作是否正常。
---
 我新建了一个专门测试聚鑫的工作流，经过测试，我大概看明白了，如下：
 - 聚鑫好像没有专门的故事板模式，只能使用普通模式。
 - 当前的普通模式下，只要使用合适的指令，也能实现类似故事板的功能，所以，我建议你把聚鑫故事板的API调用当作普通模式的API调用，只是节点前端界面不一样而已。
 - 你现在设计的聚鑫故事板节点无法正常工作，因为API调用参数不对。
