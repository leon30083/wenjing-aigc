# æ•…äº‹æ¿èŠ‚ç‚¹ä¿®å¤è§„åˆ’

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-12-30
**çŠ¶æ€**: è§„åˆ’ä¸­ï¼Œå¾…å®ç°

---

## ä¸€ã€é—®é¢˜æ¦‚è¿°

### 1.1 æ ¸å¿ƒé—®é¢˜

**æ ¹æœ¬æ€§ç†è§£é”™è¯¯**: æ•…äº‹æ¿è¢«é”™è¯¯ç†è§£ä¸º"æ‰¹é‡ç”Ÿæˆå¤šä¸ªç‹¬ç«‹è§†é¢‘"

- **é”™è¯¯**: æ¯ä¸ªé•œå¤´è°ƒç”¨ä¸€æ¬¡ APIï¼Œè¿”å› N ä¸ª taskId
- **æ­£ç¡®**: è°ƒç”¨ä¸€æ¬¡ APIï¼Œè¿”å›å•ä¸ª taskIdï¼ˆå•ä¸ªè§†é¢‘ä»»åŠ¡ï¼Œå¤šæ—¶é—´æ®µæè¿°ï¼‰

### 1.2 å‘ç°è¿‡ç¨‹

1. ç”¨æˆ·è¦æ±‚åˆ†ææ•…äº‹æ¿åŠŸèƒ½å¹¶è§„åˆ’å®ç°
2. é˜…è¯» API æ–‡æ¡£å‘ç°æ•…äº‹æ¿æœ¬è´¨ï¼š
   - è´è´å¹³å°æ–‡æ¡£æ˜ç¡®è¯´æ˜ï¼š`POST /v2/videos/generations` ä½¿ç”¨æ•…äº‹æ¿æ ¼å¼æç¤ºè¯
   - æ ¼å¼ï¼š`Shot N:\nduration: Xsec\nScene: Y\n\n`
3. æ£€æŸ¥åç«¯å®ç°ï¼ˆsora2-client.jsï¼‰å‘ç°å·²æ­£ç¡®å®ç°
4. æ£€æŸ¥å‰ç«¯å®ç°ï¼ˆStoryboardNode.jsxï¼‰å‘ç°ç†è§£é”™è¯¯

---

## äºŒã€æŠ€æœ¯åˆ†æ

### 2.1 æ•…äº‹æ¿ API æ ¼å¼

**è´è´å¹³å° API æ–‡æ¡£**ï¼ˆ`ç”¨æˆ·è¾“å…¥æ–‡ä»¶å¤¹/è´è´å·¥åŠ/Sora2æ•…äº‹æ¿è§†é¢‘.md`ï¼‰:

```yaml
openapi: 3.0.1
paths:
  /v2/videos/generations:
    post:
      summary: Sora2æ•…äº‹æ¿è§†é¢‘
      description: |
        æç¤ºè¯æŒ‰ç…§ä»¥ä¸‹æ ¼å¼ä¼ å³å¯è‡ªåŠ¨å¯ç”¨æ•…äº‹æ¿

        Shot 1:
        duration: 7.5sec
        Scene: é£æœºèµ·é£

        Shot 2:
        duration: 7.5sec
        Scene: é£æœºé™è½
      requestBody:
        content:
          application/json:
            schema:
              properties:
                prompt:
                  type: string
                  x-apifox-mock: |
                    Shot 1:
                    duration: 7.5sec
                    Scene: é£æœºèµ·é£

                    Shot 2:
                    duration: 7.5sec
                    Scene: é£æœºé™è½
                model:
                  type: string
                  enum: [sora-2, sora-2-pro]
                aspect_ratio:
                  type: string
                  enum: ['16:9', '9:16']
```

**å…³é”®è¦ç‚¹**:
1. å•ä¸ª API è°ƒç”¨ï¼ˆ`POST /v2/videos/generations`ï¼‰
2. æç¤ºè¯ä½¿ç”¨æ•…äº‹æ¿æ ¼å¼
3. è¿”å›å•ä¸ªä»»åŠ¡ IDï¼ˆ`task_id` æˆ– `id`ï¼‰

### 2.2 åç«¯æ­£ç¡®å®ç°

**æ–‡ä»¶**: `src/server/sora2-client.js`ï¼ˆç¬¬318-370è¡Œï¼‰

```javascript
async createStoryboardVideo(options) {
  const { shots, model = 'sora-2', orientation, size, watermark, images = [] } = options;

  // âœ… æ”¶é›†æ‰€æœ‰é•œå¤´çš„å‚è€ƒå›¾ç‰‡
  const allImages = [...images];
  shots.forEach((shot) => {
    if (shot.image) {
      allImages.push(shot.image);
    }
  });

  // âœ… æ‹¼æ¥æ•…äº‹æ¿æç¤ºè¯æ ¼å¼
  const promptParts = shots.map((shot, index) => {
    return `Shot ${index + 1}:\nduration: ${shot.duration}sec\nScene: ${shot.scene}`;
  });
  const prompt = promptParts.join('\n\n');

  // âœ… æ„å»ºè¯·æ±‚ä½“
  const body = {
    model,
    prompt,  // æ•…äº‹æ¿æ ¼å¼çš„æç¤ºè¯
    images: allImages,  // æ‰€æœ‰å›¾ç‰‡
    watermark,
    private: isPrivate,
  };

  // âœ… è½¬æ¢å‚æ•°
  if (this.platform.useAspectRatio) {
    body.aspect_ratio = this._convertOrientationParam(orientation);
    body.hd = typeof size === 'boolean' ? size : undefined;
    body.duration = typeof size === 'string' ? size : undefined;
  }

  // âœ… è°ƒç”¨ä¸€æ¬¡ç»Ÿä¸€çš„è§†é¢‘åˆ›å»º API
  return await this.createVideo(body);
}
```

### 2.3 å‰ç«¯é”™è¯¯å®ç°

**æ–‡ä»¶**: `src/client/src/nodes/process/StoryboardNode.jsx`ï¼ˆç¬¬55-130è¡Œï¼‰

```javascript
// âŒ é”™è¯¯ï¼šå¾ªç¯è°ƒç”¨ API
for (let i = 0; i < validShots.length; i++) {
  const shot = validShots[i];

  const payload = {
    platform: 'juxin',
    model: config.model,
    prompt: shot.scene,  // âŒ ç›´æ¥ç”¨ sceneï¼Œæœªæ‹¼æ¥æ•…äº‹æ¿æ ¼å¼
    duration: `${shot.duration}s`,  // âŒ åº”è¯¥æ˜¯æ•°å­—ç±»å‹
    aspect_ratio: config.aspect,
    watermark: config.watermark,
    storyboard_mode: true,  // âŒ åç«¯ä¸è¯†åˆ«æ­¤å‚æ•°
    shot_index: i,  // âŒ åç«¯ä¸è¯†åˆ«æ­¤å‚æ•°
    total_shots: validShots.length,  // âŒ åç«¯ä¸è¯†åˆ«æ­¤å‚æ•°
  };

  // âŒ æ¯ä¸ªé•œå¤´è°ƒç”¨ä¸€æ¬¡ API
  const response = await fetch(`${API_BASE}/video/create`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload),
  });

  const result = await response.json();

  if (result.success && result.data) {
    setResults(prev => [...prev, {
      shotId: shot.id,
      scene: shot.scene,
      taskId: result.data.id || result.data.task_id,  // âŒ è¿”å›æ•°ç»„
      status: 'queued',
    }]);
    setProgress(prev => ({ ...prev, completed: prev.completed + 1 }));
  }
}

setStatus('success');

// âŒ é”™è¯¯ï¼šæ´¾å‘ results æ•°ç»„
if (data.onStoryboardGenerated) {
  data.onStoryboardGenerated(results);  // âŒ åº”è¯¥æ˜¯å•ä¸ª taskId
}
```

**é”™è¯¯åˆ—è¡¨**:
1. å¾ªç¯è°ƒç”¨ N æ¬¡ APIï¼ˆåº”è¯¥è°ƒç”¨ä¸€æ¬¡ï¼‰
2. æœªæ‹¼æ¥æ•…äº‹æ¿æ ¼å¼çš„æç¤ºè¯
3. ä½¿ç”¨ä¸å­˜åœ¨çš„å‚æ•°ï¼ˆ`storyboard_mode`, `shot_index`, `total_shots`ï¼‰
4. è¿”å› results æ•°ç»„ï¼ˆåº”è¯¥è¿”å›å•ä¸ª taskIdï¼‰
5. duration ç±»å‹é”™è¯¯ï¼ˆåº”è¯¥æ˜¯æ•°å­—ï¼Œä¸æ˜¯å­—ç¬¦ä¸²ï¼‰
6. è¿›åº¦è·Ÿè¸ªé€»è¾‘é”™è¯¯ï¼ˆä¸éœ€è¦ total/completed/failedï¼‰

---

## ä¸‰ã€ä¿®å¤æ–¹æ¡ˆ

### 3.1 Phase 1: è§’è‰²å¼•ç”¨é›†æˆ

**ç›®æ ‡**: æ·»åŠ è§’è‰²å¼•ç”¨åŠŸèƒ½ï¼Œä»¿ç…§ VideoGenerateNode

**çŠ¶æ€ç®¡ç†**:
```javascript
const [connectedCharacters, setConnectedCharacters] = useState([]);
const sceneRefs = useRef([]);  // å­˜å‚¨æ¯ä¸ªåœºæ™¯è¾“å…¥æ¡†çš„ ref
const lastFocusedSceneIndex = useRef(null);  // è®°å½•æœ€åç„¦ç‚¹çš„åœºæ™¯ç´¢å¼•
```

**å€™é€‰è§’è‰²æ˜¾ç¤ºåŒº**:
```jsx
<div style={{ marginBottom: '8px' }}>
  <div style={{ fontSize: '11px', fontWeight: 'bold', color: '#4338ca' }}>
    ğŸ“Š å€™é€‰è§’è‰² (ç‚¹å‡»æ’å…¥åˆ°ç„¦ç‚¹åœºæ™¯)
  </div>
  {connectedCharacters.map((char) => (
    <div onClick={() => insertCharacterToFocusedScene(char.username, char.alias)}>
      <img src={char.profilePictureUrl} />
      <span>{char.alias || char.username}</span>
    </div>
  ))}
</div>
```

**ç„¦ç‚¹ç®¡ç†**:
```javascript
// åœºæ™¯è¾“å…¥æ¡†è·å–ç„¦ç‚¹æ—¶è®°å½•ç´¢å¼•
const handleSceneFocus = (index) => {
  lastFocusedSceneIndex.current = index;
};

// åœ¨ç„¦ç‚¹åœºæ™¯æ’å…¥è§’è‰²å¼•ç”¨
const insertCharacterToFocusedScene = (username, alias) => {
  const targetIndex = lastFocusedSceneIndex.current;
  if (targetIndex === null) return;

  const sceneInput = sceneRefs.current[targetIndex];
  if (!sceneInput) return;

  const start = sceneInput.selectionStart;
  const end = sceneInput.selectionEnd;
  const text = shots[targetIndex].scene;
  const refText = `@${alias} `;

  // æ›´æ–°åœºæ™¯æè¿°
  const newScene = text.substring(0, start) + refText + text.substring(end);
  updateShot(shots[targetIndex].id, 'scene', newScene);

  // ç§»åŠ¨å…‰æ ‡
  setTimeout(() => {
    sceneInput.setSelectionRange(start + refText.length, start + refText.length);
    sceneInput.focus();
  }, 0);
};
```

**åœºæ™¯è¾“å…¥æ¡†ç»‘å®š**:
```jsx
{shots.map((shot, index) => (
  <input
    ref={(el) => sceneRefs.current[index] = el}
    type="text"
    value={shot.scene}
    onChange={(e) => updateShot(shot.id, 'scene', e.target.value)}
    onFocus={() => handleSceneFocus(index)}
    placeholder="åœºæ™¯æè¿°..."
  />
))}
```

### 3.2 Phase 2: ä¿®æ­£ API è°ƒç”¨é€»è¾‘

**ç›®æ ‡**: ç§»é™¤å¾ªç¯è°ƒç”¨ï¼Œæ”¹ä¸ºè°ƒç”¨ä¸€æ¬¡ `/api/video/storyboard`

```javascript
const handleGenerate = async () => {
  // éªŒè¯
  const validShots = shots.filter(s => s.scene.trim());
  if (validShots.length === 0) {
    alert('è¯·è‡³å°‘å¡«å†™ä¸€ä¸ªåˆ†é•œå¤´åœºæ™¯');
    return;
  }

  setStatus('generating');

  try {
    // âœ… æ”¶é›†æ‰€æœ‰å›¾ç‰‡
    const allImages = [];

    // å…¨å±€å›¾ç‰‡ï¼ˆä» ReferenceImageNode è¿æ¥ï¼‰
    if (data.connectedImages && data.connectedImages.length > 0) {
      allImages.push(...data.connectedImages);
    }

    // æ¯ä¸ªé•œå¤´çš„å›¾ç‰‡
    validShots.forEach(shot => {
      if (shot.image && shot.image.trim()) {
        allImages.push(shot.image.trim());
      }
    });

    // âœ… è°ƒç”¨åç«¯æ•…äº‹æ¿ API
    const response = await fetch(`${API_BASE}/api/video/storyboard`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        platform: 'juxin',  // æˆ–ä» config è·å–
        model: config.model.toLowerCase(),
        shots: validShots.map(s => ({
          duration: s.duration,
          scene: s.scene,
          image: s.image,
        })),
        images: allImages,
        aspect_ratio: config.aspect,
        watermark: config.watermark,
      }),
    });

    const result = await response.json();

    if (result.success && result.data) {
      const taskId = result.data.id || result.data.task_id;

      setStatus('success');

      // âœ… æ´¾å‘äº‹ä»¶åˆ° TaskResultNode
      window.dispatchEvent(new CustomEvent('video-task-created', {
        detail: { sourceNodeId: nodeId, taskId }
      }));
    } else {
      setStatus('error');
      alert(result.error || 'ç”Ÿæˆå¤±è´¥');
    }
  } catch (err) {
    setStatus('error');
    console.error('Storyboard generation error:', err);
    alert(`ç½‘ç»œé”™è¯¯: ${err.message}`);
  }
};
```

### 3.3 Phase 3: UI ä¼˜åŒ–

**ç›®æ ‡**: ç®€åŒ–çŠ¶æ€ç®¡ç†ï¼Œç§»é™¤é”™è¯¯çš„ UI å…ƒç´ 

**ç§»é™¤å†…å®¹**:
1. ç§»é™¤ `progress` çŠ¶æ€ï¼ˆtotal/completed/failedï¼‰
2. ç§»é™¤ "æ‰¹é‡ç”Ÿæˆ" æŒ‰é’®æ–‡æœ¬
3. ç§»é™¤ 1:1 æ¯”ä¾‹é€‰é¡¹ï¼ˆSora2 ä¸æ”¯æŒï¼‰
4. ä¿®æ­£ duration ä¸ºæ•°å­—ç±»å‹ï¼ˆ5, 10, 15, 25ï¼‰

**ç®€åŒ–çŠ¶æ€**:
```javascript
// âŒ åˆ é™¤
const [progress, setProgress] = useState({ total: 0, completed: 0, failed: 0 });
const [results, setResults] = useState([]);

// âœ… ä¿ç•™
const [status, setStatus] = useState('idle'); // idle, generating, success, error
```

**æŒ‰é’®æ–‡æœ¬ä¿®æ”¹**:
```jsx
// âŒ åˆ é™¤
{status === 'idle' && 'æ‰¹é‡ç”Ÿæˆ'}
{status === 'generating' && `ç”Ÿæˆä¸­... (${progress.completed}/${progress.total})`}
{status === 'success' && `âœ“ å®Œæˆ (${progress.completed}ä¸ªæˆåŠŸ)`}

// âœ… ä¿®æ”¹ä¸º
{status === 'idle' && 'ç”Ÿæˆæ•…äº‹æ¿è§†é¢‘'}
{status === 'generating' && 'ç”Ÿæˆä¸­...'}
{status === 'success' && 'âœ“ å®Œæˆ'}
{status === 'error' && 'âœ— å¤±è´¥'}
```

### 3.4 Phase 4: æµ‹è¯•éªŒè¯

**æµ‹è¯•æ¸…å•**:
1. âœ… è§’è‰²æ’å…¥åŠŸèƒ½ï¼ˆç‚¹å‡»æ’å…¥åˆ°ç„¦ç‚¹åœºæ™¯ï¼‰
2. âœ… æ•…äº‹æ¿æ ¼å¼æ‹¼æ¥ï¼ˆShot 1: duration X sec Scene: Yï¼‰
3. âœ… API è°ƒç”¨ï¼ˆå•æ¬¡è¯·æ±‚ï¼Œå•ä¸ª taskIdï¼‰
4. âœ… TaskResultNode è½®è¯¢ï¼ˆæ¥æ”¶ taskId å¹¶æŸ¥è¯¢ï¼‰
5. âœ… å‚è€ƒå›¾ç‰‡æ”¶é›†ï¼ˆå…¨å±€ + é•œå¤´å›¾ç‰‡ï¼‰

**æµ‹è¯•æ­¥éª¤**:
1. åˆ›å»ºæ•…äº‹æ¿èŠ‚ç‚¹ï¼Œè¿æ¥è§’è‰²åº“èŠ‚ç‚¹
2. æ·»åŠ  3 ä¸ªé•œå¤´ï¼Œæ¯ä¸ªé•œå¤´å¡«å†™åœºæ™¯æè¿°
3. ç‚¹å‡»è§’è‰²å¡ç‰‡ï¼ŒéªŒè¯æ’å…¥åˆ°ç„¦ç‚¹åœºæ™¯
4. ç‚¹å‡»"ç”Ÿæˆæ•…äº‹æ¿è§†é¢‘"æŒ‰é’®
5. æ£€æŸ¥ Network é¢æ¿ï¼Œç¡®è®¤åªè°ƒç”¨ä¸€æ¬¡ API
6. æ£€æŸ¥è¯·æ±‚ payloadï¼Œç¡®è®¤æ•…äº‹æ¿æ ¼å¼æ­£ç¡®
7. è¿æ¥ TaskResultNodeï¼ŒéªŒè¯è½®è¯¢æ­£å¸¸

---

## å››ã€æ•°æ®æµè®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        StoryboardNode                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¾“å…¥ï¼š                                                               â”‚
â”‚  - connectedCharacters (è§’è‰²æ•°ç»„) - ä» CharacterLibraryNode ä¼ é€’    â”‚
â”‚  - connectedImages (å›¾ç‰‡æ•°ç»„) - ä» ReferenceImageNode ä¼ é€’         â”‚
â”‚                                                                       â”‚
â”‚  UIäº¤äº’ï¼š                                                             â”‚
â”‚  - é•œå¤´åˆ—è¡¨ï¼šæ¯ä¸ªé•œå¤´æœ‰ scene, duration, image                       â”‚
â”‚  - ç‚¹å‡»è§’è‰²å¡ç‰‡ â†’ æ’å…¥åˆ°å½“å‰ç„¦ç‚¹çš„ scene è¾“å…¥æ¡†                      â”‚
â”‚  - ç„¦ç‚¹ç®¡ç†ï¼šè®°å½•æœ€åç„¦ç‚¹çš„åœºæ™¯è¾“å…¥æ¡†                                â”‚
â”‚                                                                       â”‚
â”‚  ç”Ÿæˆæµç¨‹ï¼š                                                           â”‚
â”‚  1. æ”¶é›†æ‰€æœ‰ shots æ•°æ®                                             â”‚
â”‚  2. æ”¶é›†è§’è‰²å¼•ç”¨ï¼ˆä» scene ä¸­æå– @usernameï¼‰                        â”‚
â”‚  3. æ”¶é›†æ‰€æœ‰å›¾ç‰‡ï¼ˆå…¨å±€ images + æ¯ä¸ª shot çš„ imageï¼‰                 â”‚
â”‚  4. æ‹¼æ¥æ•…äº‹æ¿æ ¼å¼                                                   â”‚
â”‚  5. è°ƒç”¨ä¸€æ¬¡ API (POST /api/video/storyboard)                       â”‚
â”‚  6. è·å–å•ä¸ª taskId                                                 â”‚
â”‚  7. æ´¾å‘äº‹ä»¶åˆ° TaskResultNode                                        â”‚
â”‚                                                                       â”‚
â”‚  è¾“å‡ºï¼š                                                               â”‚
â”‚  - æ´¾å‘äº‹ä»¶ 'video-task-created' â†’ taskId                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**äº‹ä»¶ç³»ç»Ÿ**:
```javascript
// StoryboardNode æ´¾å‘äº‹ä»¶
window.dispatchEvent(new CustomEvent('video-task-created', {
  detail: { sourceNodeId: nodeId, taskId }
}));

// TaskResultNode ç›‘å¬äº‹ä»¶
useEffect(() => {
  const handleVideoCreated = (event) => {
    const { sourceNodeId, taskId: newTaskId } = event.detail;
    if (data.connectedSourceId === sourceNodeId && newTaskId) {
      setTaskId(newTaskId);  // è®¾ç½® taskIdï¼Œè§¦å‘è½®è¯¢
    }
  };

  window.addEventListener('video-task-created', handleVideoCreated);
  return () => window.removeEventListener('video-task-created', handleVideoCreated);
}, [data.connectedSourceId]);
```

---

## äº”ã€å®æ–½æ­¥éª¤

### 5.1 å‡†å¤‡å·¥ä½œ
- [ ] é˜…è¯»è´è´å¹³å° API æ–‡æ¡£
- [ ] æ£€æŸ¥åç«¯å®ç°ï¼ˆsora2-client.jsï¼‰
- [ ] æ£€æŸ¥ç½‘é¡µç‰ˆå®ç°ï¼ˆindex.htmlï¼‰

### 5.2 ä»£ç ä¿®æ”¹
- [ ] Phase 1: æ·»åŠ è§’è‰²å¼•ç”¨åŠŸèƒ½
  - [ ] çŠ¶æ€ç®¡ç†ï¼šconnectedCharacters, sceneRefs, lastFocusedSceneIndex
  - [ ] å€™é€‰è§’è‰²æ˜¾ç¤ºåŒº
  - [ ] ç„¦ç‚¹ç®¡ç†é€»è¾‘
  - [ ] insertCharacterToFocusedScene å‡½æ•°
- [ ] Phase 2: ä¿®æ­£ API è°ƒç”¨
  - [ ] ç§»é™¤å¾ªç¯è°ƒç”¨é€»è¾‘ï¼ˆç¬¬74-118è¡Œï¼‰
  - [ ] æ”¶é›†æ‰€æœ‰å›¾ç‰‡
  - [ ] è°ƒç”¨ /api/video/storyboard
  - [ ] å¤„ç†å•ä¸ª taskId
  - [ ] æ´¾å‘äº‹ä»¶
- [ ] Phase 3: UI ä¼˜åŒ–
  - [ ] ç§»é™¤ progress çŠ¶æ€
  - [ ] ç§»é™¤ results çŠ¶æ€
  - [ ] ä¿®æ”¹æŒ‰é’®æ–‡æœ¬
  - [ ] ç§»é™¤ 1:1 æ¯”ä¾‹
  - [ ] ä¿®æ­£ duration ç±»å‹
- [ ] Phase 4: æµ‹è¯•éªŒè¯
  - [ ] åŠŸèƒ½æµ‹è¯•
  - [ ] API æµ‹è¯•
  - [ ] äº‹ä»¶æµæµ‹è¯•

### 5.3 æ–‡æ¡£æ›´æ–°
- [x] base.md: æ›´æ–°æ•…äº‹æ¿æ¨¡å¼è§„èŒƒ
- [x] code.md: æ·»åŠ é”™è¯¯27 - æ•…äº‹æ¿å®ç°é”™è¯¯
- [x] å¼€å‘äº¤æ¥ä¹¦.md: æ·»åŠ çº é”™è®°å½•
- [ ] æœ¬è§„åˆ’æ–‡æ¡£ï¼šå®Œæˆåæ ‡è®°ä¸ºå·²å®Œæˆ

---

## å…­ã€å…³é”®è¦ç‚¹æ€»ç»“

| é¡¹ç›® | å½“å‰å®ç°ï¼ˆé”™è¯¯ï¼‰ | æ­£ç¡®å®ç° |
|------|----------------|---------|
| **API è°ƒç”¨æ¬¡æ•°** | å¾ªç¯ N æ¬¡ï¼ˆæ¯ä¸ª shot ä¸€æ¬¡ï¼‰ | 1 æ¬¡ï¼ˆæ‹¼æ¥æ•…äº‹æ¿æ ¼å¼ï¼‰ |
| **æç¤ºè¯æ ¼å¼** | ç›´æ¥ç”¨ `shot.scene` | æ‹¼æ¥: `Shot 1:\nduration: Xsec\nScene: Y\n\n...` |
| **è¿”å›ç»“æœ** | N ä¸ª taskId æ•°ç»„ | 1 ä¸ª taskId |
| **çŠ¶æ€è·Ÿè¸ª** | progress.total/completed/failed | ç®€å•çš„ idle/generating/success |
| **è§’è‰²å¼•ç”¨** | æ— æ”¯æŒ | ç‚¹å‡»æ’å…¥åˆ°ç„¦ç‚¹åœºæ™¯ |
| **å›¾ç‰‡æ”¶é›†** | æ‰‹åŠ¨åˆå¹¶åˆ°æ¯ä¸ªè¯·æ±‚ | ç»Ÿä¸€æ”¶é›†ï¼Œä¼ ç»™åç«¯æ‹¼æ¥ |

---

## ä¸ƒã€å‚è€ƒæ–‡æ¡£

- **è´è´å¹³å° API**: `ç”¨æˆ·è¾“å…¥æ–‡ä»¶å¤¹/è´è´å·¥åŠ/Sora2æ•…äº‹æ¿è§†é¢‘.md`
- **åç«¯å®ç°**: `src/server/sora2-client.js`ï¼ˆç¬¬318-370è¡Œï¼‰
- **ç½‘é¡µç‰ˆå®ç°**: `src/renderer/public/index.html`ï¼ˆç¬¬1356-1407è¡Œï¼‰
- **é¡¹ç›®è§„èŒƒ**: `.claude/rules/base.md`, `.claude/rules/code.md`

---

**æœ€åæ›´æ–°**: 2025-12-30
**ç»´æŠ¤è€…**: WinJin AIGC Team
