# WinJin AIGC å¼€å‘äº¤æ¥ä¹¦

**æ–‡æ¡£ç‰ˆæœ¬**: v5.1 â­ (2026-01-09 æ›´æ–°)
**ä¸Šä¸€ç‰ˆæœ¬**: v5.0 (2026-01-09)
**æ›´æ–°æ—¥æœŸ**: 2026-01-09
**é¡¹ç›®**: WinJin AIGC (å¼€æºé‡æ„ç‰ˆ)
**ä»“åº“**: https://github.com/leon30083/wenjing-aigc.git

---

## âš¡ å¿«é€Ÿå‚è€ƒï¼ˆå¼€å‘å‰å¿…è¯»ï¼‰

> è¯¦ç»†è¯´æ˜è¯·æŸ¥çœ‹ `.claude/rules/quick-reference.md`

### 1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨ â­

**å·¥ä½œæµç”»å¸ƒå¼€å‘ï¼ˆå½“å‰é‡ç‚¹ï¼‰**:
```bash
# ç»ˆç«¯1: å¯åŠ¨åç«¯ API
npm run server

# ç»ˆç«¯2: å¯åŠ¨å‰ç«¯ Vite
cd src/client && npm run dev

# æµè§ˆå™¨è®¿é—®
http://localhost:5173/  â† å·¥ä½œæµç”»å¸ƒï¼ˆReact Flowï¼‰â­
```

### 2. æµ‹è¯•ç›®æ ‡åŒºåˆ† âš ï¸

| ç«¯å£ | æŠ€æœ¯ | ç”¨é€” | å½“å‰é‡ç‚¹ |
|------|------|------|----------|
| **5173** | React Flow | **å·¥ä½œæµç”»å¸ƒ** | â­ **YES** |
| 9000 | åŸç”Ÿ HTML | ç½‘é¡µç‰ˆï¼ˆæ—§ç‰ˆï¼‰ | NO |

### 3. å¸¸è§é”™è¯¯ âŒ

```bash
# âŒ é”™è¯¯1: åªå¯åŠ¨åç«¯ï¼Œè®¿é—®ç½‘é¡µç‰ˆ
npm run server
# æµè§ˆå™¨æ‰“å¼€ localhost:9000  â† è¿™æ˜¯ç½‘é¡µç‰ˆï¼Œä¸æ˜¯å·¥ä½œæµç”»å¸ƒï¼

# âŒ é”™è¯¯2: ä½¿ç”¨ npm startï¼ˆéœ€è¦ electronï¼‰
npm start  # 'electron' ä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤

# âœ… æ­£ç¡®: åŒæ—¶å¯åŠ¨åç«¯å’Œå‰ç«¯
npm run server          # ç»ˆç«¯1
cd src/client && npm run dev  # ç»ˆç«¯2
# è®¿é—® localhost:5173  â† è¿™æ‰æ˜¯å·¥ä½œæµç”»å¸ƒï¼
```

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [ç¯å¢ƒè¦æ±‚](#ç¯å¢ƒè¦æ±‚)
3. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
4. [Claude Code é…ç½®ï¼ˆé‡è¦ï¼‰](#claude-code-é…ç½®é‡è¦)
5. [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
6. [å¸¸ç”¨å‘½ä»¤](#å¸¸ç”¨å‘½ä»¤)
7. [API ç«¯ç‚¹](#api-ç«¯ç‚¹)
8. [å¼€å‘è§„èŒƒ](#å¼€å‘è§„èŒƒ)
9. [å…³é”®æ¨¡å—è¯´æ˜](#å…³é”®æ¨¡å—è¯´æ˜)
10. [æœ€æ–°å¼€å‘è¿›åº¦](#æœ€æ–°å¼€å‘è¿›åº¦)
11. [æ³¨æ„äº‹é¡¹](#æ³¨æ„äº‹é¡¹)
12. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)
13. [å·¥ä½œæµç¼–è¾‘å™¨ä½¿ç”¨æŒ‡å—] â­ æ–°å¢

---

## é¡¹ç›®æ¦‚è¿°

WinJin AIGC æ˜¯ä¸€ä¸ªåŸºäº Electron + Express çš„ AI è§†é¢‘ç”Ÿæˆå·¥å…·ï¼Œæ”¯æŒï¼š

- **Sora2 è§†é¢‘ç”Ÿæˆ**: æ–‡ç”Ÿè§†é¢‘ã€è§’è‰²å‚è€ƒè§†é¢‘ã€æ•…äº‹æ¿æ‰¹é‡ç”Ÿæˆ
- **è§’è‰²åˆ›å»º**: ä»è§†é¢‘ä¸­æå–è§’è‰²ï¼Œæ”¯æŒè§’è‰²åº“ç®¡ç†
- **åŒå¹³å°æ”¯æŒ**: èšé‘«å¹³å° (api.jxincm.cn) å’Œè´è´å¹³å° (ai.t8star.cn)
- **å†å²è®°å½•**: è‡ªåŠ¨ä¿å­˜ä»»åŠ¡è®°å½•åˆ° JSON æ–‡ä»¶ï¼Œåå°è½®è¯¢è‡ªåŠ¨æ›´æ–°çŠ¶æ€
- **è§’è‰²åº“**: ç®¡ç†åˆ›å»ºçš„è§’è‰²ï¼Œæ”¯æŒæœç´¢ã€åˆ«åã€å¿«é€Ÿè°ƒç”¨
- **å¯è§†åŒ–èŠ‚ç‚¹å·¥ä½œæµ** â­ v2.0 æ–°å¢: ComfyUI é£æ ¼çš„æ‹–æ‹½å¼èŠ‚ç‚¹ç¼–è¾‘å™¨

---

## ç¯å¢ƒè¦æ±‚

### å¿…éœ€è½¯ä»¶

| è½¯ä»¶ | ç‰ˆæœ¬è¦æ±‚ | ä¸‹è½½åœ°å€ |
|------|----------|----------|
| **Node.js** | 16.x æˆ–æ›´é«˜ | https://nodejs.org/ |
| **npm** | 8.x æˆ–æ›´é«˜ | éš Node.js å®‰è£… |
| **Git** | æœ€æ–°ç‰ˆ | https://git-scm.com/ |
| **Claude Code** | æœ€æ–°ç‰ˆ | https://claude.com/claude-code |

### å¯é€‰è½¯ä»¶

- **VS Code**: æ¨èçš„ä»£ç ç¼–è¾‘å™¨
- **Chrome DevTools**: è°ƒè¯•å‰ç«¯ï¼ˆClaude Code å·²é›†æˆï¼‰

### æ“ä½œç³»ç»Ÿ

- Windows 10/11ï¼ˆä¸»è¦ç›®æ ‡å¹³å°ï¼‰
- macOS/Linuxï¼ˆå…¼å®¹ï¼‰

---

## å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/leon30083/wenjing-aigc.git
cd wenjing-aigc
```

### 2. å®‰è£…ä¾èµ–

```bash
# å®‰è£…é¡¹ç›®ä¾èµ–
npm install
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
copy .env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„ API Key
```

**`.env` æ–‡ä»¶å†…å®¹**:

```bash
# èšé‘«å¹³å° API Keyï¼ˆå¿…å¡«ï¼‰
SORA2_API_KEY=sk-your-actual-juxin-api-key

# è´è´å¹³å° API Keyï¼ˆå¯é€‰ï¼‰
ZHENZHEN_API_KEY=sk-your-actual-zhenzhen-api-key

# æœåŠ¡å™¨ç«¯å£
PORT=9000
```

### 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

**âš ï¸ é‡è¦**ï¼šé¡¹ç›®æœ‰ä¸¤ç§å¯åŠ¨æ–¹å¼ï¼Œæ³¨æ„åŒºåˆ†ï¼

#### æ–¹å¼1: ä»…å¯åŠ¨ HTTP æœåŠ¡å™¨ï¼ˆæ¨èç”¨äº API æµ‹è¯•ï¼‰

```bash
npm run server
```

- **ç”¨é€”**: å¯åŠ¨ Express HTTP æœåŠ¡å™¨ï¼Œæä¾› API æ¥å£
- **ç«¯å£**: `http://localhost:9000`
- **è®¿é—®**: æµè§ˆå™¨æ‰“å¼€ http://localhost:9000
- **é€‚ç”¨åœºæ™¯**:
  - æµ‹è¯• API æ¥å£
  - æµ‹è¯•ç½‘é¡µç‰ˆåŠŸèƒ½ï¼ˆéå·¥ä½œæµç”»å¸ƒï¼‰
- **æ³¨æ„**: **ä¸å¯åŠ¨ Electron æ¡Œé¢åº”ç”¨**

#### æ–¹å¼2: å¯åŠ¨å·¥ä½œæµç”»å¸ƒå¼€å‘æœåŠ¡å™¨ â­ å½“å‰å¼€å‘é‡ç‚¹

**âš ï¸ é‡è¦**ï¼šè¿™æ˜¯å½“å‰é¡¹ç›®çš„ä¸»è¦å¼€å‘ç›®æ ‡ï¼

```bash
# æ­¥éª¤1: å¯åŠ¨åç«¯ API æœåŠ¡å™¨
npm run server

# æ­¥éª¤2: å¯åŠ¨å‰ç«¯ Vite å¼€å‘æœåŠ¡å™¨ï¼ˆæ–°ç»ˆç«¯çª—å£ï¼‰
cd src/client
npm run dev
```

- **åç«¯ç«¯å£**: `http://localhost:9000` (API æ¥å£)
- **å‰ç«¯ç«¯å£**: `http://localhost:5173` (å·¥ä½œæµç”»å¸ƒ)
- **è®¿é—®**: æµè§ˆå™¨æ‰“å¼€ **http://localhost:5173/**
- **é€‚ç”¨åœºæ™¯**:
  - **å·¥ä½œæµèŠ‚ç‚¹å¼€å‘** â­
  - **èŠ‚ç‚¹è¿çº¿æµ‹è¯•** â­
  - **React Flow åŠŸèƒ½è°ƒè¯•** â­
- **æ³¨æ„**:
  - **å¿…é¡»åŒæ—¶è¿è¡Œä¸¤ä¸ªæœåŠ¡å™¨**ï¼ˆåç«¯ + å‰ç«¯ï¼‰
  - **æµ‹è¯•æ—¶è®¿é—® 5173 ç«¯å£ï¼Œä¸æ˜¯ 9000 ç«¯å£** âš ï¸
  - 9000 ç«¯å£æ˜¯ç½‘é¡µç‰ˆï¼Œä¸æ˜¯å·¥ä½œæµç”»å¸ƒ âš ï¸

#### æ–¹å¼3: å¯åŠ¨å®Œæ•´çš„ Electron æ¡Œé¢åº”ç”¨

```bash
npm start
```

- **ç”¨é€”**: å¯åŠ¨ Electron æ¡Œé¢åº”ç”¨ï¼ˆåŒ…å«å†…åµŒçš„ HTTP æœåŠ¡å™¨ï¼‰
- **è¦æ±‚**: éœ€è¦å…ˆå®‰è£… electron (`npm install electron --save-dev`)
- **é€‚ç”¨åœºæ™¯**:
  - æ‰“åŒ…æ¡Œé¢åº”ç”¨
  - æµ‹è¯•æ¡Œé¢åº”ç”¨åŠŸèƒ½

#### å¸¸è§é—®é¢˜ âš ï¸ æ˜“çŠ¯é”™è¯¯

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| `electron: command not found` | electron æœªå®‰è£… | ä½¿ç”¨ `npm run server` ä»£æ›¿ `npm start` |
| ç«¯å£è¢«å ç”¨ | 9000 ç«¯å£å·²è¢«ä½¿ç”¨ | ä¿®æ”¹ `.env` ä¸­çš„ PORT é…ç½® |
| **æµ‹è¯•äº†ç½‘é¡µç‰ˆè€Œéç”»å¸ƒ** | âŒ è®¿é—® localhost:9000 | âœ… è®¿é—® localhost:5173ï¼ˆå·¥ä½œæµç”»å¸ƒï¼‰ |
| **å‰ç«¯æ— æ³•è¿æ¥ API** | åªå¯åŠ¨äº† Viteï¼Œæ²¡å¯åŠ¨åç«¯ | åŒæ—¶è¿è¡Œ `npm run server` å’Œ `npm run dev` |

**å¼€å‘æµç¨‹æ¨è** â­:
1. ç»ˆç«¯1: `npm run server` (åç«¯ API)
2. ç»ˆç«¯2: `cd src/client && npm run dev` (å‰ç«¯ç”»å¸ƒ)
3. æµè§ˆå™¨è®¿é—®: **http://localhost:5173/** â­

**âŒ é”™è¯¯æ“ä½œ**:
- åªè¿è¡Œ `npm run server` åè®¿é—® 9000 ç«¯å£ â†’ æµ‹è¯•çš„æ˜¯ç½‘é¡µç‰ˆï¼Œä¸æ˜¯å·¥ä½œæµç”»å¸ƒ
- åªè¿è¡Œ Vite dev server â†’ å‰ç«¯æ— æ³•è¿æ¥åç«¯ API

---

## Claude Code é…ç½®ï¼ˆé‡è¦ï¼‰

**âš ï¸ è¿™æ˜¯å¼€å‘çš„æ ¸å¿ƒé…ç½®ï¼Œå¿…é¡»åœ¨æ–°çš„å¼€å‘ç¯å¢ƒä¸­æ­£ç¡®è®¾ç½®ï¼**

### é…ç½®æ–‡ä»¶ä½ç½®

```
.claude/
â”œâ”€â”€ settings.json          # Claude Code è®¾ç½®
â”œâ”€â”€ settings.local.json    # æœ¬åœ°è¦†ç›–è®¾ç½®ï¼ˆä¸æäº¤ï¼‰
â””â”€â”€ rules/                 # å¼€å‘è§„åˆ™
    â”œâ”€â”€ base.md            # åŸºç¡€æŠ€æœ¯æ ˆè§„åˆ™
    â””â”€â”€ code.md            # ä»£ç è§„èŒƒå’Œæœ€ä½³å®è·µ
```

### settings.json é…ç½®

**ä½ç½®**: `é¡¹ç›®æ ¹ç›®å½•/.claude/settings.json`

```json
{
  "mcpServers": {
    "memory": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-memory"]
    },
    "chrome-devtools": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-chrome-devtools"]
    },
    "context7": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-context7"]
    }
  }
}
```

### rules/base.md - æŠ€æœ¯æ ˆçº¦æŸ

**å…³é”®å†…å®¹**:

```markdown
## è¿è¡Œæ—¶ç¯å¢ƒ
- Node.js: 16.x æˆ–æ›´é«˜
- npm: 8.x æˆ–æ›´é«˜

## æ ¸å¿ƒæ¡†æ¶ç‰ˆæœ¬
| æ¡†æ¶/åº“ | ç‰ˆæœ¬è¦æ±‚ |
|---------|----------|
| Electron | ^28.0.0 |
| Express | ^4.18.2 |
| axios | ^1.6.5 |
| dotenv | ^17.2.3 |

## Sora2 API æ”¯æŒå¹³å°
### èšé‘«å¹³å° (api.jxincm.cn)
- åˆ›å»ºè§†é¢‘: POST /v1/video/create
- æŸ¥è¯¢ä»»åŠ¡: GET /v1/video/query?id={taskId} âš ï¸ æŸ¥è¯¢å‚æ•°
- åˆ›å»ºè§’è‰²: POST /sora/v1/characters

### è´è´å¹³å° (ai.t8star.cn)
- åˆ›å»ºè§†é¢‘: POST /v1/video/create
- æŸ¥è¯¢ä»»åŠ¡: GET /v2/videos/generations/{taskId} âš ï¸ è·¯å¾„å‚æ•°
- åˆ›å»ºè§’è‰²: POST /sora/v1/characters

### é‡è¦å·®å¼‚
- æŸ¥è¯¢ç«¯ç‚¹: èšé‘«ç”¨æŸ¥è¯¢å‚æ•° ?id=ï¼Œè´è´ç”¨è·¯å¾„å‚æ•° /{taskId}
- å“åº”æ ¼å¼: èšé‘«è¿”å› {id}, è´è´è¿”å› {task_id} âš ï¸ éœ€è¦å…¼å®¹å¤„ç†
- è§’è‰²åˆ›å»º: éƒ½æ”¯æŒ from_task å‚æ•°ï¼ˆæ¨èï¼‰

### è§’è‰²å¼•ç”¨è¯­æ³• â­
æ‰€æœ‰å¹³å°ç»Ÿä¸€ä½¿ç”¨ @username æ ¼å¼ï¼ˆä¸å¸¦èŠ±æ‹¬å·ï¼‰
ç¤ºä¾‹: @6f2dbf2b3.zenwhisper åœ¨å·¥åœ°ä¸Šå¹²æ´»

### è§’è‰²åˆ›å»ºè§„èŒƒ â­
- ç«¯ç‚¹: POST /sora/v1/characters
- å‚æ•°: url æˆ– from_task äºŒé€‰ä¸€
- å¿…å¡«: timestamps (æ ¼å¼: "1,3")
- âš ï¸ ç¦æ­¢: ä¸è¦ä¼ é€’ model å‚æ•°
- âœ… æ¨è: ä¼˜å…ˆä½¿ç”¨ from_task å‚æ•°

## è½®è¯¢ç­–ç•¥
- åå°è‡ªåŠ¨è½®è¯¢: 30ç§’é—´éš”
- æ£€æŸ¥èŒƒå›´: æ‰€æœ‰ queued å’Œ processing çŠ¶æ€çš„ä»»åŠ¡
- æ‰‹åŠ¨æŸ¥è¯¢: æä¾›"æŸ¥è¯¢çŠ¶æ€"æŒ‰é’®
```

### rules/code.md - ä»£ç è§„èŒƒ

**å…³é”®å†…å®¹**:

```markdown
## å‘½åçº¦å®š
- æ–‡ä»¶å: kebab-case
- å˜é‡/å‡½æ•°: camelCase
- ç±»å: PascalCase
- å¸¸é‡: UPPER_SNAKE_CASE
- ç§æœ‰æˆå‘˜: å‰ç¼€ä¸‹åˆ’çº¿ _

## Sora2 API å¼€å‘è§„èŒƒ

### åŒå¹³å°ä»»åŠ¡IDå…¼å®¹å¤„ç† âš ï¸ é‡è¦
// âœ… æ­£ç¡®ï¼šå…¼å®¹åŒå¹³å°çš„ä»»åŠ¡IDæ ¼å¼
const taskId = result.data.id || result.data.task_id;
if (taskId) {
  historyStorage.addRecord({ taskId, platform, prompt, model, options });
}

### è§’è‰²å¼•ç”¨è¯­æ³•
// âœ… æ­£ç¡®ï¼šæ‰€æœ‰å¹³å°ä½¿ç”¨ @username æ ¼å¼
const prompt = '@6f2dbf2b3.zenwhisper åœ¨å·¥åœ°ä¸Šå¹²æ´»';
// âŒ é”™è¯¯ï¼šä¸è¦ä½¿ç”¨èŠ±æ‹¬å·
const prompt = '@{6f2dbf2b3.zenwhisper} åœ¨å·¥åœ°ä¸Šå¹²æ´»';
```

### é…ç½® Claude Code è‡ªåŠ¨åŠ è½½è§„åˆ™

å½“åœ¨æ–°çš„å¼€å‘ç¯å¢ƒé¦–æ¬¡ä½¿ç”¨ Claude Code æ—¶ï¼š

1. **æ‰“å¼€é¡¹ç›®æ ¹ç›®å½•**
   ```bash
   cd D:\user\github\winjin
   ```

2. **å¯åŠ¨ Claude Code**
   - Claude Code ä¼šè‡ªåŠ¨è¯»å– `.claude/settings.json`
   - ä¼šè‡ªåŠ¨åŠ è½½ `rules/` ç›®å½•ä¸‹çš„è§„åˆ™æ–‡ä»¶

3. **éªŒè¯é…ç½®**
   - åœ¨ Claude Code ä¸­è¯¢é—®ï¼šè¯·åˆ—å‡ºå½“å‰é¡¹ç›®çš„æŠ€æœ¯æ ˆ
   - åº”è¯¥è¿”å› base.md ä¸­å®šä¹‰çš„æŠ€æœ¯æ ˆä¿¡æ¯

---

## é¡¹ç›®ç»“æ„

```
wenjing-aigc/
â”œâ”€â”€ .claude/                    # Claude Code é…ç½® â­
â”‚   â”œâ”€â”€ settings.json           # MCP æœåŠ¡å™¨é…ç½®
â”‚   â””â”€â”€ rules/                  # å¼€å‘è§„åˆ™
â”‚       â”œâ”€â”€ base.md             # æŠ€æœ¯æ ˆçº¦æŸ
â”‚       â””â”€â”€ code.md             # ä»£ç è§„èŒƒ
â”œâ”€â”€ data/                       # æ•°æ®æŒä¹…åŒ–ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”‚   â”œâ”€â”€ history.json            # å†å²è®°å½•
â”‚   â””â”€â”€ characters.json         # è§’è‰²åº“
â”œâ”€â”€ downloads/                  # è§†é¢‘ä¸‹è½½ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”œâ”€â”€ reference/                  # å‚è€ƒæ–‡æ¡£
â”‚   â””â”€â”€ ç”¨æˆ·è¾“å…¥æ–‡ä»¶å¤¹/
â”‚       â”œâ”€â”€ å¼€å‘ç»éªŒ/           # å¼€å‘æ–‡æ¡£ â­
â”‚       â”œâ”€â”€ èšé‘«sora2/          # èšé‘« API æ–‡æ¡£
â”‚       â””â”€â”€ è´è´å·¥åŠ/           # è´è´ API æ–‡æ¡£
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/                   # Electron ä¸»è¿›ç¨‹ï¼ˆæš‚æœªä½¿ç”¨ï¼‰
â”‚   â”œâ”€â”€ renderer/               # Electron æ¸²æŸ“è¿›ç¨‹
â”‚   â”‚   â””â”€â”€ public/
â”‚   â”‚       â””â”€â”€ index.html      # Web å‰ç«¯ç•Œé¢ï¼ˆv1.xï¼‰
â”‚   â”œâ”€â”€ server/                 # HTTP æœåŠ¡å™¨ â­
â”‚   â”‚   â”œâ”€â”€ index.js            # Express æœåŠ¡å™¨ä¸»æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ sora2-client.js     # Sora2 API å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ history-storage.js  # å†å²è®°å½•å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ character-storage.js # è§’è‰²åº“å­˜å‚¨
â”‚   â”‚   â””â”€â”€ batch-queue.js      # æ‰¹é‡ä»»åŠ¡é˜Ÿåˆ—
â”‚   â””â”€â”€ client/                 # â­ v2.0 æ–°å¢ï¼šå·¥ä½œæµç¼–è¾‘å™¨
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ nodes/          # è‡ªå®šä¹‰èŠ‚ç‚¹
â”‚       â”‚   â”‚   â”œâ”€â”€ input/      # è¾“å…¥èŠ‚ç‚¹ (4ä¸ª)
â”‚       â”‚   â”‚   â”œâ”€â”€ process/    # å¤„ç†èŠ‚ç‚¹ (3ä¸ª)
â”‚       â”‚   â”‚   â””â”€â”€ output/     # è¾“å‡ºèŠ‚ç‚¹ (2ä¸ª)
â”‚       â”‚   â”œâ”€â”€ hooks/          # React Hooks
â”‚       â”‚   â”‚   â””â”€â”€ useWorkflowExecution.js
â”‚       â”‚   â”œâ”€â”€ App.jsx         # ä¸»åº”ç”¨
â”‚       â”‚   â””â”€â”€ App.css
â”‚       â”œâ”€â”€ package.json
â”‚       â””â”€â”€ vite.config.js
â”œâ”€â”€ .env                        # ç¯å¢ƒå˜é‡ï¼ˆä¸æäº¤ï¼‰
â”œâ”€â”€ .env.example                # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ .gitignore                  # Git å¿½ç•¥è§„åˆ™
â”œâ”€â”€ package.json                # é¡¹ç›®ä¾èµ–
â””â”€â”€ README.md                   # é¡¹ç›®è¯´æ˜
```

---

## å¸¸ç”¨å‘½ä»¤

### å¼€å‘å‘½ä»¤

```bash
# å¯åŠ¨ HTTP æœåŠ¡å™¨ï¼ˆæœ€å¸¸ç”¨ï¼‰
npm run server

# å¯åŠ¨ Electron åº”ç”¨
npm start

# å¼€å‘æ¨¡å¼ï¼ˆçƒ­é‡è½½ï¼‰
npm run dev

# â­ v2.0 æ–°å¢ï¼šå¯åŠ¨å·¥ä½œæµç¼–è¾‘å™¨
cd src/client && npm run dev
# è®¿é—® http://localhost:5173
```

### Git å‘½ä»¤

```bash
# æŸ¥çœ‹çŠ¶æ€
git status

# æäº¤æ›´æ”¹
git add .
git commit -m "feat: your message"
git push origin master

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin master

# è®¾ç½®ä»£ç†ï¼ˆå¦‚éœ€è¦ï¼‰
git config --global http.proxy http://127.0.0.1:7890
git config --global https.proxy http://127.0.0.1:7890

# å–æ¶ˆä»£ç†
git config --global --unset http.proxy
git config --global --unset https.proxy
```

### æµ‹è¯•å‘½ä»¤

```bash
# æµ‹è¯•æœåŠ¡å™¨å¥åº·
curl http://localhost:9000/health

# æµ‹è¯•åˆ›å»ºè§†é¢‘
curl -X POST http://localhost:9000/api/video/create \
  -H "Content-Type: application/json" \
  -d '{"platform":"juxin","prompt":"A cat","model":"sora-2"}'
```

### éªŒè¯å‘½ä»¤ â­ Phase 1 & Phase 2 (2026-01-09)

```bash
# Phase 1: åŸºç¡€éªŒè¯
npm run validate:registry    # éªŒè¯èŠ‚ç‚¹æ³¨å†Œè¡¨
npm run validate:nodes       # éªŒè¯èŠ‚ç‚¹æ–‡ä»¶è¯­æ³•
npm run validate:docs        # éªŒè¯æ–‡æ¡£ä¸­çš„èŠ‚ç‚¹å¼•ç”¨
npm run validate:all         # è¿è¡Œæ‰€æœ‰ Phase 1 éªŒè¯

# Phase 2: æ•°æ®æµéªŒè¯ â­ æ–°å¢
npm run validate:data-flow   # éªŒè¯æ•°æ®æµå®Œæ•´æ€§
npm run detect:contracts     # æ£€æµ‹æ•°æ®å¥‘çº¦
npm run validate:phase2      # è¿è¡Œå®Œæ•´ Phase 2 éªŒè¯

# èŠ‚ç‚¹å½±å“åˆ†æ
npm run analyze:impact -- <nodeType>    # åˆ†ææŸä¸ªèŠ‚ç‚¹çš„å½±å“
npm run test:affected -- <nodeType>     # æµ‹è¯•å—å½±å“çš„èŠ‚ç‚¹
```

---

## API ç«¯ç‚¹

### å¥åº·æ£€æŸ¥
```
GET /health
```

### è§†é¢‘ç”Ÿæˆ
```
POST /api/video/create              # æ–‡ç”Ÿè§†é¢‘
POST /api/video/create-with-character  # å¸¦è§’è‰²å‚è€ƒ
POST /api/video/storyboard          # æ•…äº‹æ¿æ‰¹é‡
POST /api/video/download            # ä¸‹è½½è§†é¢‘
```

### è§’è‰²ç®¡ç†
```
POST   /api/character/create           # åˆ›å»ºè§’è‰²
GET    /api/character/list             # è·å–è§’è‰²åˆ—è¡¨
GET    /api/character/stats            # è·å–ç»Ÿè®¡ä¿¡æ¯
GET    /api/character/:characterId     # è·å–å•ä¸ªè§’è‰²
GET    /api/character/search/:query    # æœç´¢è§’è‰²
PUT    /api/character/:characterId/alias  # è®¾ç½®åˆ«å â­
DELETE /api/character/:characterId     # åˆ é™¤è§’è‰²
DELETE /api/character/all             # æ¸…ç©ºæ‰€æœ‰è§’è‰²
```

### ä»»åŠ¡æŸ¥è¯¢
```
GET /api/task/:taskId               # æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€
GET /api/task/:taskId/wait          # ç­‰å¾…ä»»åŠ¡å®Œæˆ
```

### æ‰¹é‡ä»»åŠ¡
```
POST /api/batch/create              # åˆ›å»ºæ‰¹é‡ä»»åŠ¡
POST /api/batch/:id/submit          # æäº¤æ‰¹é‡ä»»åŠ¡
GET  /api/batch/:id/poll            # è½®è¯¢æ‰¹é‡ä»»åŠ¡
GET  /api/batch/:id/status          # è·å–æ‰¹é‡ä»»åŠ¡çŠ¶æ€
GET  /api/batch/list                # è·å–æ‰€æœ‰æ‰¹é‡ä»»åŠ¡
DELETE /api/batch/:id               # åˆ é™¤æ‰¹é‡ä»»åŠ¡
```

### å¤‡ä»½ç®¡ç† â­ æ–°å¢
```
GET  /api/backup/export             # å¯¼å‡ºå¤‡ä»½ï¼ˆJSONæ ¼å¼ï¼‰
POST /api/backup/import             # å¯¼å…¥å¤‡ä»½
GET  /api/backup/info               # è·å–æ•°æ®ç»Ÿè®¡ä¿¡æ¯
```

---

## å¼€å‘è§„èŒƒ

### ä»£ç é£æ ¼

```javascript
// âœ… æ­£ç¡®çš„å‘½å
const getUserData = () => {};  // camelCase
class UserService {};          // PascalCase
const MAX_RETRIES = 3;         // UPPER_SNAKE_CASE
const _privateVar = 'secret';  // ç§æœ‰æˆå‘˜å‰ç¼€

// âŒ é”™è¯¯çš„å‘½å
const GetUserData = () => {};  // ä¸ä½¿ç”¨ PascalCase
const user_data = () => {};    // ä¸ä½¿ç”¨ snake_case
```

### API è°ƒç”¨è§„èŒƒ

```javascript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ async/await + try-catch
async function createVideo(options) {
  try {
    const response = await axios.post('/api/video/create', options);
    return { success: true, data: response.data };
  } catch (error) {
    return { success: false, error: error.message };
  }
}

// âŒ é”™è¯¯ï¼šä¸ä½¿ç”¨ try-catch
async function createVideo(options) {
  const response = await axios.post('/api/video/create', options);
  return response.data;  // å¯èƒ½æŠ›å‡ºæœªæ•è·çš„å¼‚å¸¸
}
```

### ç»Ÿä¸€å“åº”æ ¼å¼

```javascript
// æˆåŠŸå“åº”
{ success: true, data: {...} }

// å¤±è´¥å“åº”
{ success: false, error: "é”™è¯¯ä¿¡æ¯" }
```

---

## å…³é”®æ¨¡å—è¯´æ˜

### 1. Sora2Client (src/server/sora2-client.js)

**èŒè´£**: å°è£… Sora2 API è°ƒç”¨ï¼Œæ”¯æŒåŒå¹³å°

**å…³é”®æ–¹æ³•**:
```javascript
// åˆ›å»ºè§†é¢‘ï¼ˆå…¼å®¹åŒå¹³å°å“åº”æ ¼å¼ï¼‰
await client.createVideo({
  prompt: 'A cat sleeping',
  model: 'sora-2',
  orientation: 'landscape',
  duration: 10,
  size: 'small'
});

// æŸ¥è¯¢ä»»åŠ¡ï¼ˆè‡ªåŠ¨å¤„ç†å¹³å°å·®å¼‚ï¼‰
await client.getTaskStatus(taskId);

// åˆ›å»ºè§’è‰²ï¼ˆæ”¯æŒ from_taskï¼‰
await client.createCharacter({
  from_task: taskId,  // æ¨èæ–¹å¼
  timestamps: '1,3'
});
```

### 2. HistoryStorage (src/server/history-storage.js)

**èŒè´£**: å†å²è®°å½•æŒä¹…åŒ–å­˜å‚¨

**å­˜å‚¨ä½ç½®**: `data/history.json`

**å…³é”®æ–¹æ³•**:
```javascript
// æ·»åŠ è®°å½•
historyStorage.addRecord({
  taskId: 'video_xxx',
  platform: 'juxin',
  prompt: 'A cat',
  model: 'sora-2'
});

// æ ‡è®°å®Œæˆ
historyStorage.markCompleted(taskId, { output: 'url' });

// è·å–æ‰€æœ‰è®°å½•
const records = historyStorage.getAllRecords({
  status: 'queued',
  platform: 'zhenzhen'
});
```

### 3. CharacterStorage (src/server/character-storage.js)

**èŒè´£**: è§’è‰²åº“æŒä¹…åŒ–å­˜å‚¨

**å­˜å‚¨ä½ç½®**: `data/characters.json`

**å…³é”®æ–¹æ³•**:
```javascript
// æ·»åŠ è§’è‰²ï¼ˆè‡ªåŠ¨å»é‡ï¼‰
characterStorage.addCharacter({
  id: 'ch_xxx',
  username: 'user.name',
  alias: 'åˆ«å',  // â­ æ–°å¢
  profilePictureUrl: 'url',
  platform: 'zhenzhen'
});

// æ›´æ–°è§’è‰²ï¼ˆè®¾ç½®åˆ«åï¼‰
characterStorage.updateCharacter(characterId, { alias: 'æ–°åˆ«å' });

// æœç´¢è§’è‰²
const results = characterStorage.searchCharacters('user');

// è·å–ç»Ÿè®¡
const stats = characterStorage.getStats();
// { total: 10, byPlatform: { juxin: 5, zhenzhen: 5 } }
```

### 4. åå°è½®è¯¢æœåŠ¡ (src/server/index.js)

**èŒè´£**: è‡ªåŠ¨æ£€æŸ¥å¹¶æ›´æ–°ä»»åŠ¡çŠ¶æ€

**é…ç½®**:
```javascript
const POLL_INTERVAL = 30000;  // 30ç§’

// æ£€æŸ¥æ‰€æœ‰ queued å’Œ processing çŠ¶æ€çš„ä»»åŠ¡
setInterval(async () => {
  const queuedTasks = historyStorage.getAllRecords({ status: 'queued' });
  const processingTasks = historyStorage.getAllRecords({ status: 'processing' });
  const allPendingTasks = [...queuedTasks, ...processingTasks];

  for (const record of allPendingTasks) {
    await checkAndUpdateTask(record.taskId, record.platform);
  }
}, POLL_INTERVAL);
```

---

## æœ€æ–°å¼€å‘è¿›åº¦

### å·²å®ŒæˆåŠŸèƒ½ âœ…

#### 1. è‡ªåŠ¨åŒ–éªŒè¯ç³»ç»Ÿ - é˜²æ­¢"æ”¹ä¸€åå¤š"çº§è”å¤±è´¥ (2026-01-09) â­ v4.9
- **æ ¸å¿ƒç›®æ ‡**: é˜²æ­¢ AI ä¿®æ”¹ä¸€ä¸ªèŠ‚ç‚¹æ—¶æ”¹åå¦ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¯¼è‡´å·¥ä½œæµæ— æ³•è¿è¡Œ
- **é—®é¢˜æè¿°**:
  - AI ç»å¸¸åœ¨ä¿®æ”¹ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œæ”¹å¥½ä¸€ä¸ªèŠ‚ç‚¹å´æ”¹åäº†å¦ä¸€ä¸ªèŠ‚ç‚¹
  - ç¼ºå°‘è‡ªåŠ¨åŒ–æ£€æŸ¥éªŒè¯æœºåˆ¶
  - æ²¡æœ‰èŠ‚ç‚¹å½±å“åˆ†æå·¥å…·
  - Git æäº¤æ²¡æœ‰é˜»æ­¢é”™è¯¯ä»£ç çš„æœºåˆ¶
- **æ ¹æœ¬åŸå› **:
  - ç¼ºå°‘éªŒè¯ä¸è¯Šæ–­å±‚ï¼ˆLayer 7ï¼‰
  - æ–‡æ¡£ä¸ä»£ç è„±èŠ‚ï¼ˆå¦‚é”™è¯¯55çš„ NarratorProcessorNode é—®é¢˜ï¼‰
  - æ²¡æœ‰ Git pre-commit hook
- **å®ç°å†…å®¹**:
  - **Phase 1: ç«‹å³å®æ–½ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰**
    - åˆ›å»º `scripts/validate-registry.js` - èŠ‚ç‚¹æ³¨å†Œè¡¨éªŒè¯
    - åˆ›å»º `scripts/validate-nodes.js` - èŠ‚ç‚¹è¯­æ³•éªŒè¯ï¼ˆæ™ºèƒ½å¤„ç† babel ç¼ºå¤±ï¼‰
    - åˆ›å»º `scripts/analyze-node-impact.js` - èŠ‚ç‚¹å½±å“åˆ†æå™¨
    - åˆ›å»º `scripts/test-affected-nodes.js` - å—å½±å“èŠ‚ç‚¹æµ‹è¯•
    - æ›´æ–° `.git/hooks/pre-commit` - Git æäº¤é’©å­ï¼ˆ4å±‚éªŒè¯ï¼‰
    - æ›´æ–° `package.json` - æ–°å¢ 6 ä¸ª npm å‘½ä»¤
- **æ–°å¢ npm å‘½ä»¤**:
  - `npm run validate:registry` - éªŒè¯èŠ‚ç‚¹æ³¨å†Œè¡¨
  - `npm run validate:nodes` - éªŒè¯èŠ‚ç‚¹æ–‡ä»¶è¯­æ³•
  - `npm run analyze:impact` - åˆ†æèŠ‚ç‚¹å½±å“
  - `npm run test:affected` - æµ‹è¯•å—å½±å“çš„èŠ‚ç‚¹
  - `npm run validate:all` - è¿è¡Œæ‰€æœ‰éªŒè¯
- **Git Pre-commit Hook**:
  æ¯æ¬¡æäº¤æ—¶è‡ªåŠ¨éªŒè¯ï¼š
  1. èŠ‚ç‚¹æ³¨å†Œè¡¨å®Œæ•´æ€§
  2. èŠ‚ç‚¹æ–‡ä»¶è¯­æ³•æ­£ç¡®æ€§ï¼ˆè­¦å‘Šä¸é˜»æ­¢ï¼‰
  3. èŠ‚ç‚¹ä¿®æ”¹å½±å“åˆ†æï¼ˆä¸é˜»æ­¢ï¼‰
  4. æ–‡æ¡£ä¸­çš„èŠ‚ç‚¹å¼•ç”¨ï¼ˆå¦‚ä¿®æ”¹äº†æ–‡æ¡£ï¼‰
- **éªŒè¯ç»“æœ**: âœ… å…¨éƒ¨é€šè¿‡
  - validate-registry.js: é€šè¿‡ï¼ˆ16ä¸ªèŠ‚ç‚¹å…¨éƒ¨æ³¨å†Œï¼‰
  - analyze-node-impact.js: æ­£å¸¸å·¥ä½œ
  - test-affected-nodes.js: æ­£å¸¸å·¥ä½œ
  - validate-nodes.js: æ™ºèƒ½å¤„ç† babel ç¼ºå¤±ï¼ˆè­¦å‘Šä¸é˜»æ­¢æäº¤ï¼‰
- **æŠ€æœ¯äº®ç‚¹**:
  - validate-nodes.js æ™ºèƒ½å¤„ç†ï¼šbabel ç¼ºå¤±æ—¶ä½¿ç”¨åŸºç¡€éªŒè¯ï¼Œç»“æœä½œä¸ºè­¦å‘Šè€Œéé”™è¯¯
  - é¿å…è¯¯æŠ¥é˜»æ­¢æ­£å¸¸çš„å¼€å‘å·¥ä½œæµç¨‹
  - å»ºè®®å®‰è£… @babel/cli è·å¾—æ›´å‡†ç¡®çš„éªŒè¯
- **å…³é”®æ•™è®­**:
  1. **é˜²å¾¡æ€§ç¼–ç¨‹**: ä¸‰å±‚é˜²å¾¡ç³»ç»Ÿï¼ˆå¼€å‘æ—¶ â†’ æäº¤å‰ â†’ CI/CDï¼‰
  2. **è‡ªåŠ¨åŒ–ä¼˜å…ˆ**: å‡å°‘äººå·¥å¹²é¢„ï¼Œæé«˜å¼€å‘æ•ˆç‡
  3. **è­¦å‘Šä¸é˜»æ­¢**: è¯¯æŠ¥ä¸åº”æˆä¸ºå¼€å‘çš„éšœç¢
  4. **å½±å“åˆ†æ**: ä¿®æ”¹èŠ‚ç‚¹å‰å…ˆäº†è§£å½±å“èŒƒå›´
- **ä¿®æ”¹æ–‡ä»¶**:
  - `scripts/validate-registry.js` - æ–°å¢ï¼ˆ126è¡Œï¼‰
  - `scripts/validate-nodes.js` - æ–°å¢ï¼ˆ193è¡Œï¼‰
  - `scripts/analyze-node-impact.js` - æ–°å¢ï¼ˆ287è¡Œï¼‰
  - `scripts/test-affected-nodes.js` - æ–°å¢ï¼ˆ302è¡Œï¼‰
  - `.git/hooks/pre-commit` - æ›´æ–°ï¼ˆ155è¡Œï¼‰
  - `package.json` - æ–°å¢ 6 ä¸ª npm å‘½ä»¤
  - `ç”¨æˆ·è¾“å…¥æ–‡ä»¶å¤¹/å¼€å‘å¯¹è¯/å¼€å‘äº¤æ¥ä¹¦.md` - ç‰ˆæœ¬å·æ›´æ–°åˆ° v4.9
- **Git æäº¤**: 55de78d
- **ä½¿ç”¨ç¤ºä¾‹**:
  ```bash
  # åˆ†ææŸä¸ªèŠ‚ç‚¹çš„å½±å“
  npm run analyze:impact -- promptOptimizerNode

  # æµ‹è¯•å—å½±å“çš„èŠ‚ç‚¹
  npm run test:affected -- CharacterLibraryNode

  # è¿è¡Œæ‰€æœ‰éªŒè¯
  npm run validate:all
  ```
- **ç›¸å…³è®¡åˆ’**: C:\Users\leon3\.claude\plans\mutable-dazzling-crystal.md

  - **Phase 2: çŸ­æœŸå¢å¼ºï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰** â­ v5.0 æ–°å¢ (2026-01-09)
    - åˆ›å»º `scripts/detect-data-contracts.js` - æ•°æ®å¥‘çº¦è‡ªåŠ¨æ£€æµ‹ï¼ˆ680è¡Œï¼‰
    - åˆ›å»º `scripts/validate-data-flow.js` - æ•°æ®æµå®Œæ•´æ€§éªŒè¯ï¼ˆ680+è¡Œï¼‰
    - æ›´æ–° `.git/hooks/pre-commit` - æ·»åŠ  Phase 2 éªŒè¯æ­¥éª¤
    - æ›´æ–° `package.json` - æ–°å¢ 3 ä¸ª npm å‘½ä»¤
- **Phase 2 æ–°å¢ npm å‘½ä»¤**:
  - `npm run validate:data-flow` - éªŒè¯æ•°æ®æµå®Œæ•´æ€§
  - `npm run detect:contracts` - æ£€æµ‹æ•°æ®å¥‘çº¦
  - `npm run validate:phase2` - è¿è¡Œå®Œæ•´ Phase 2 éªŒè¯
- **Phase 2 æ ¸å¿ƒåŠŸèƒ½**:
  - **æ•°æ®å¥‘çº¦æ£€æµ‹**: è‡ªåŠ¨åˆ†æèŠ‚ç‚¹çš„å†™å…¥/è¯»å–å­—æ®µ
  - **æ•°æ®æµéªŒè¯**: æ£€æµ‹èŠ‚ç‚¹é—´æ•°æ®ä¼ é€’çš„å®Œæ•´æ€§
  - **ä¾èµ–ç¼ºå¤±æ£€æµ‹**: è¯†åˆ« useEffect ä¾èµ–æ•°ç»„ç¼ºå¤±é—®é¢˜
  - **"ä¿®ä¸€åä¸€"æ£€æµ‹**: æˆåŠŸæ£€æµ‹ commit 42616aa å¯¼è‡´çš„æ•°æ®æµæ–­è£‚ â­
- **æŠ€æœ¯æ”¹è¿›**:
  - æ”¯æŒ React.memo å¯¼å‡ºæ¨¡å¼è¯†åˆ«
  - æ”¹è¿› setNodes() åµŒå¥—æ‹¬å·åŒ¹é…æ­£åˆ™
  - æ”¯æŒé—´æ¥æ•°æ®å¼•ç”¨æ¨¡å¼ (data: newData)
  - æ­£åˆ™è¡¨è¾¾å¼: `/setNodes\(([\s\S]+?)\n\s*\)/gm`
- **éªŒè¯ç»“æœ**: âœ… æˆåŠŸé‡ç°åŸå§‹é—®é¢˜
  - æ‰«æèŠ‚ç‚¹æ•°: 16 ä¸ª
  - æ£€æµ‹è¿æ¥æ•°: 6 ä¸ª
  - é”™è¯¯: 0 ä¸ª
  - è­¦å‘Š: 12 ä¸ª
  - **æˆåŠŸæ£€æµ‹é—®é¢˜**: NarratorProcessorNode â†’ VideoGenerateNode æ•°æ®æµæ–­è£‚
    - æºèŠ‚ç‚¹å†™å…¥: `manualPrompt, narratorMode, narratorIndex, narratorTotal, narratorSentences`
    - ç›®æ ‡èŠ‚ç‚¹è¯»å–: æ‰€æœ‰å­—æ®µéƒ½è¢«è¯»å–ï¼Œä½† **useEffect ä¾èµ–ä¸­ç¼ºå¤±** âš ï¸
    - è¿™æ˜¯ Phase 1 å®Œå…¨æ— æ³•æ£€æµ‹çš„é—®é¢˜ï¼
- **Phase 1 vs Phase 2 å¯¹æ¯”**:
  | éªŒè¯ç±»å‹ | Phase 1 | Phase 2 |
  |---------|---------|---------|
  | è¯­æ³•é”™è¯¯ | âœ… | âœ… |
  | èŠ‚ç‚¹å¼•ç”¨ | âœ… | âœ… |
  | æ•°æ®æµæ–­è£‚ | âŒ | âœ… |
  | ä¾èµ–ç¼ºå¤± | âŒ | âœ… |
  | "ä¿®ä¸€åä¸€" | âŒ | âœ… |
- **ä¿®æ”¹æ–‡ä»¶**:
  - `scripts/detect-data-contracts.js` - æ–°å¢ï¼ˆ680è¡Œï¼‰
  - `scripts/validate-data-flow.js` - æ–°å¢ï¼ˆ680+è¡Œï¼‰
  - `.git/hooks/pre-commit` - æ›´æ–°ï¼ˆæ·»åŠ  Phase 2 éªŒè¯æ­¥éª¤ï¼‰
  - `package.json` - æ–°å¢ 3 ä¸ª npm å‘½ä»¤
  - `ç”¨æˆ·è¾“å…¥æ–‡ä»¶å¤¹/å¼€å‘å¯¹è¯/å¼€å‘äº¤æ¥ä¹¦.md` - ç‰ˆæœ¬å·æ›´æ–°åˆ° v5.0
- **Git æäº¤**: 716f532
- **ä½¿ç”¨ç¤ºä¾‹**:
  ```bash
  # è¿è¡Œå®Œæ•´ Phase 2 éªŒè¯
  npm run validate:phase2

  # åªæ£€æµ‹æ•°æ®å¥‘çº¦
  npm run detect:contracts

  # åªéªŒè¯æ•°æ®æµ
  npm run validate:data-flow

  # Git æäº¤æ—¶è‡ªåŠ¨è¿è¡Œ
  git commit -m "message"
  ```
- **å…³é”®ç»éªŒ**:
  1. **æ­£åˆ™è¡¨è¾¾å¼æ”¹è¿›**: åµŒå¥—æ‹¬å·åŒ¹é…æ˜¯æœ€å¤§æŠ€æœ¯æŒ‘æˆ˜
  2. **React.memo è¯†åˆ«**: éœ€è¦å¤šç§æ¨¡å¼åŒ¹é…æ‰èƒ½è¦†ç›–æ‰€æœ‰èŠ‚ç‚¹
  3. **è­¦å‘Šä¸é˜»æ­¢æäº¤**: ä¿æŒå¼€å‘æµç¨‹é¡ºç•…ï¼Œä¸æˆä¸ºéšœç¢
  4. **Phase 2 æˆåŠŸä»·å€¼**: æ£€æµ‹ Phase 1 æ— æ³•å‘ç°çš„æ•°æ®æµé—®é¢˜

  - **Phase 3: è‡ªåŠ¨ä¿®å¤ä¸æŠ¥å‘Šç³»ç»Ÿï¼ˆä½ä¼˜å…ˆçº§ï¼‰** â­ v5.1 æ–°å¢ (2026-01-09)
    - åˆ›å»º `scripts/auto-fix.js` - è‡ªåŠ¨ä¿®å¤å·¥å…·ä¸»å…¥å£ï¼ˆ400+è¡Œï¼‰
    - åˆ›å»º `scripts/fix-strategies.json` - ä¿®å¤ç­–ç•¥é…ç½®
    - åˆ›å»º `scripts/fixers/` ç›®å½• - ä¿®å¤å™¨æ¨¡å—
      - `orphaned-node-fixer.js` - å­¤ç«‹èŠ‚ç‚¹å¼•ç”¨ä¿®å¤ï¼ˆ120è¡Œï¼‰
      - `missing-dependency-fixer.js` - useEffect ä¾èµ–ç¼ºå¤±ä¿®å¤ï¼ˆ100è¡Œï¼‰
      - `source-not-writing-fixer.js` - æºèŠ‚ç‚¹æœªå†™å…¥ä¿®å¤ï¼ˆ80è¡Œï¼‰
      - `data-flow-fixer.js` - æ•°æ®æµæ–­è£‚å»ºè®®ï¼ˆ150è¡Œï¼‰
    - åˆ›å»º `scripts/metrics/metrics-collector.js` - æŒ‡æ ‡æ”¶é›†å™¨ï¼ˆ200è¡Œï¼‰
    - åˆ›å»º `scripts/metrics/metrics-storage.js` - æŒ‡æ ‡å­˜å‚¨
    - åˆ›å»º `.claude/metrics/validation-metrics.json` - éªŒè¯æŒ‡æ ‡å­˜å‚¨
    - åˆ›å»º `.claude/templates/error-template.md` - é”™è¯¯æ¨¡å¼æ¨¡æ¿ï¼ˆ200è¡Œï¼‰
    - åˆ›å»º `docs/validation-guide.md` - éªŒè¯ç³»ç»Ÿä½¿ç”¨æŒ‡å—ï¼ˆ600+è¡Œï¼‰
    - æ›´æ–° `package.json` - æ–°å¢ 9 ä¸ª npm å‘½ä»¤
- **Phase 3 æ–°å¢ npm å‘½ä»¤**:
  - `npm run fix:scan` - æ‰«æå¯ä¿®å¤çš„é—®é¢˜
  - `npm run fix:all` - åº”ç”¨æ‰€æœ‰ä¿®å¤
  - `npm run fix:dry-run` - å¹²è¿è¡Œæµ‹è¯•ä¿®å¤
  - `npm run fix:backup` - ä¿®å¤å‰å¤‡ä»½
  - `npm run metrics:trend` - æŸ¥çœ‹è´¨é‡è¶‹åŠ¿
  - `npm run metrics:clear` - æ¸…ç©ºæŒ‡æ ‡
  - `npm run metrics:cleanup` - æ¸…ç†è¿‡æœŸæ•°æ®
  - `npm run metrics:export` - å¯¼å‡ºæŒ‡æ ‡æ•°æ®
  - `npm run validate:complete` - è¿è¡Œå®Œæ•´éªŒè¯ï¼ˆPhase 1+2+3ï¼‰
- **Phase 3 æ ¸å¿ƒåŠŸèƒ½**:
  - **è‡ªåŠ¨ä¿®å¤æ¡†æ¶**: æ‰«æå¯ä¿®å¤é—®é¢˜ï¼Œåº”ç”¨ä¿®å¤ç­–ç•¥
  - **ä¿®å¤ç­–ç•¥åº“**: 4ç§ä¿®å¤ç­–ç•¥ï¼ˆå­¤ç«‹èŠ‚ç‚¹ã€ä¾èµ–ç¼ºå¤±ã€æºèŠ‚ç‚¹æœªå†™å…¥ã€æ•°æ®æµæ–­è£‚ï¼‰
  - **æŒ‡æ ‡è¿½è¸ª**: è®°å½•æ¯æ¬¡éªŒè¯ç»“æœï¼Œè¿½è¸ªé”™è¯¯è¶‹åŠ¿
  - **æ ‡å‡†åŒ–æ¨¡æ¿**: åŠ é€Ÿæ–°é”™è¯¯æ¨¡å¼çš„æ·»åŠ 
  - **å®Œæ•´æ–‡æ¡£**: è®©æ–°æˆå‘˜å¿«é€Ÿä¸Šæ‰‹ä½¿ç”¨éªŒè¯ç³»ç»Ÿ
- **ä¿®å¤ç­–ç•¥è¯¦æƒ…**:
  | ç­–ç•¥ | ç±»å‹ | ç½®ä¿¡åº¦ | é£é™© | å¯è‡ªåŠ¨ä¿®å¤ |
  |------|------|--------|------|-----------|
  | å­¤ç«‹èŠ‚ç‚¹å¼•ç”¨ä¿®å¤ | orphaned_node | 95% | low | âœ… |
  | useEffect ä¾èµ–ç¼ºå¤±ä¿®å¤ | missing_dependency | 80% | medium | âœ… |
  | æºèŠ‚ç‚¹æœªå†™å…¥ä¿®å¤ | source_not_writing | 60% | high | âœ… |
  | æ•°æ®æµæ–­è£‚ä¿®å¤ | data_flow_break | 50% | high | âŒ (ä»…å»ºè®®) |
- **å¼€å‘æµç¨‹é›†æˆ**:
  ```
  å¼€å‘ä»£ç 
      â†“
  npm run validate:all  â† å¿«é€ŸéªŒè¯
      â†“
  npm run fix:scan      â† å¦‚æœ‰é—®é¢˜ï¼Œæ‰«æå¯ä¿®å¤é¡¹
      â†“
  npm run fix:dry-run    â† å¹²è¿è¡Œæµ‹è¯•
      â†“
  npm run fix:backup     â† åº”ç”¨ä¿®å¤
      â†“
  git commit -m "..."    â† Git hook è‡ªåŠ¨éªŒè¯
  ```
- **æŠ€æœ¯äº®ç‚¹**:
  - é»˜è®¤å¹²è¿è¡Œæ¨¡å¼ï¼ˆå®‰å…¨ç¬¬ä¸€ï¼‰
  - ä¿®å¤å‰è‡ªåŠ¨å¤‡ä»½
  - ç½®ä¿¡åº¦è¯„åˆ†ç³»ç»Ÿ
  - é«˜é£é™©ä¿®å¤éœ€è¦ç”¨æˆ·ç¡®è®¤
  - æŒ‡æ ‡è¶‹åŠ¿åˆ†æï¼ˆæ”¹å–„/æ¶åŒ–/ç¨³å®šï¼‰
- **éªŒè¯ç»“æœ**: âœ… å…¨éƒ¨å®Œæˆ
  - auto-fix.js: ä¸»å…¥å£å®Œæˆï¼Œæ”¯æŒæ‰«æ/ä¿®å¤/å¹²è¿è¡Œ/å¤‡ä»½æ¨¡å¼
  - fix-strategies.json: 4ç§ä¿®å¤ç­–ç•¥é…ç½®å®Œæˆ
  - fixers/: 4ä¸ªä¿®å¤å™¨æ¨¡å—å®Œæˆ
  - metrics/: æŒ‡æ ‡æ”¶é›†å’Œå­˜å‚¨å®Œæˆ
  - error-template.md: é”™è¯¯æ¨¡å¼æ¨¡æ¿å®Œæˆ
  - validation-guide.md: å®Œæ•´ä½¿ç”¨æŒ‡å—å®Œæˆï¼ˆ600+è¡Œï¼‰
  - package.json: æ–°å¢ 9 ä¸ª npm å‘½ä»¤
- **ä¿®æ”¹æ–‡ä»¶**:
  - `scripts/auto-fix.js` - æ–°å¢ï¼ˆ400+è¡Œï¼‰
  - `scripts/fix-strategies.json` - æ–°å¢ï¼ˆ150è¡Œï¼‰
  - `scripts/fixers/orphaned-node-fixer.js` - æ–°å¢ï¼ˆ120è¡Œï¼‰
  - `scripts/fixers/missing-dependency-fixer.js` - æ–°å¢ï¼ˆ100è¡Œï¼‰
  - `scripts/fixers/source-not-writing-fixer.js` - æ–°å¢ï¼ˆ80è¡Œï¼‰
  - `scripts/fixers/data-flow-fixer.js` - æ–°å¢ï¼ˆ150è¡Œï¼‰
  - `scripts/metrics/metrics-collector.js` - æ–°å¢ï¼ˆ200è¡Œï¼‰
  - `scripts/metrics/metrics-storage.js` - æ–°å¢
  - `.claude/metrics/validation-metrics.json` - è‡ªåŠ¨ç”Ÿæˆ
  - `.claude/templates/error-template.md` - æ–°å¢ï¼ˆ200è¡Œï¼‰
  - `docs/validation-guide.md` - æ–°å¢ï¼ˆ600+è¡Œï¼‰
  - `package.json` - æ–°å¢ 9 ä¸ª npm å‘½ä»¤
  - `.claude/skills/winjin-dev/SKILL.md` - æ·»åŠ éªŒè¯ç³»ç»Ÿç« èŠ‚
  - `CLAUDE.md` - æ·»åŠ éªŒè¯å‘½ä»¤
  - `ç”¨æˆ·è¾“å…¥æ–‡ä»¶å¤¹/å¼€å‘å¯¹è¯/å¼€å‘äº¤æ¥ä¹¦.md` - ç‰ˆæœ¬å·æ›´æ–°åˆ° v5.1
- **å…³é”®ç»éªŒ**:
  1. **å®‰å…¨æ€§ä¼˜å…ˆ**: é»˜è®¤å¹²è¿è¡Œæ¨¡å¼ï¼Œä¿®å¤å‰è‡ªåŠ¨å¤‡ä»½
  2. **ç½®ä¿¡åº¦è¯„åˆ†**: æ¯ä¸ªä¿®å¤éƒ½æœ‰ç½®ä¿¡åº¦è¯„åˆ†å’Œé£é™©è¯„ä¼°
  3. **æ¨¡å—åŒ–è®¾è®¡**: ä¿®å¤å™¨ç‹¬ç«‹æ–‡ä»¶ï¼Œæ˜“äºæ‰©å±•
  4. **å®Œæ•´æ–‡æ¡£**: validation-guide.md è®©æ–°æˆå‘˜å¿«é€Ÿä¸Šæ‰‹
  5. **æŒ‡æ ‡é©±åŠ¨**: è¶‹åŠ¿åˆ†æå¸®åŠ©æŒç»­æ”¹è¿›ä»£ç è´¨é‡

#### 2. NarratorProcessorNode ä¼˜åŒ–ç»“æœæŒä¹…åŒ–åŠŸèƒ½ (2026-01-08) â­ v4.7
- **æ ¸å¿ƒç›®æ ‡**: ä¿®å¤æ—ç™½å¤„ç†èŠ‚ç‚¹ä¼˜åŒ–ç»“æœåˆ·æ–°åä¸¢å¤±çš„é—®é¢˜
- **é—®é¢˜æè¿°**:
  - NarratorProcessorNode å®Œæˆä¼˜åŒ–åï¼ˆ9/9 100%ï¼‰ï¼Œåˆ·æ–°é¡µé¢ä¼˜åŒ–ç»“æœå…¨éƒ¨ä¸¢å¤±
  - ä¼˜åŒ–è¿›åº¦å›åˆ° 0/9 (0%)ï¼Œä¼˜åŒ–ç»“æœä¸ºç©º
  - ç”¨æˆ·æ¯æ¬¡åˆ·æ–°éƒ½éœ€è¦é‡æ–°ä¼˜åŒ–ï¼Œä¸¥é‡å½±å“å¼€å‘æ•ˆç‡
- **æ ¹æœ¬åŸå› **:
  1. **å·¥ä½œæµæœªè‡ªåŠ¨ä¿å­˜**: React Flow çš„ `node.data` ä¸ä¼šè‡ªåŠ¨ä¿å­˜åˆ° localStorage
  2. **éœ€è¦æ˜¾å¼ä¿å­˜**: ç”¨æˆ·å¿…é¡»æ‰‹åŠ¨ç‚¹å‡»"ğŸ’¾ ä¿å­˜å·¥ä½œæµ"æŒ‰é’®æ‰èƒ½ä¿å­˜
  3. **UI çŠ¶æ€æœªæ¢å¤**: è™½ç„¶ä¼˜åŒ–æ•°æ®è¢«åŒæ­¥åˆ° `node.data`ï¼Œä½† `progress`ã€`currentPrompt` ç­‰è¿è¡Œæ—¶çŠ¶æ€æœªæ¢å¤
- **ä¿®å¤å†…å®¹**:
  - **äº‹ä»¶é©±åŠ¨è‡ªåŠ¨ä¿å­˜**: NarratorProcessorNode å®Œæˆä¼˜åŒ–åæ´¾å‘ `narrator-optimization-complete` äº‹ä»¶
  - **App.jsx ç›‘å¬å¹¶ä¿å­˜**: ç›‘å¬äº‹ä»¶åè‡ªåŠ¨è°ƒç”¨ `WorkflowStorage.saveWorkflow()` ä¿å­˜å·¥ä½œæµ
  - **UI çŠ¶æ€æ¢å¤**: åˆ·æ–°æ—¶æ£€æµ‹ä¼˜åŒ–æ•°æ®ï¼Œè‡ªåŠ¨æ¢å¤è¿›åº¦ç™¾åˆ†æ¯”ã€å½“å‰ç´¢å¼•ã€å½“å‰æç¤ºè¯
  - **ç”Ÿæˆæœªå‘½åå·¥ä½œæµ**: å¦‚æœæ²¡æœ‰å½“å‰å·¥ä½œæµåç§°ï¼Œè‡ªåŠ¨ç”Ÿæˆ"æœªå‘½åå·¥ä½œæµ N"
- **éªŒè¯ç»“æœ**: âœ… æµ‹è¯•é€šè¿‡
  - ä¼˜åŒ–å®Œæˆåè‡ªåŠ¨ä¿å­˜å·¥ä½œæµï¼ˆæ— éœ€æ‰‹åŠ¨ç‚¹å‡»ä¿å­˜æŒ‰é’®ï¼‰
  - åˆ·æ–°åä¼˜åŒ–ç»“æœå®Œå…¨ä¿ç•™ï¼ˆè¿›åº¦ã€å½“å‰å¥å­ã€ä¼˜åŒ–ç»“æœï¼‰
  - è¿›åº¦æ­£ç¡®æ˜¾ç¤ºï¼ˆ8/9 89%ï¼‰
  - æ‰€æœ‰ UI çŠ¶æ€æ­£ç¡®æ¢å¤
- **å…³é”®æ•™è®­**:
  1. **äº‹ä»¶é©±åŠ¨æ˜¯è‡ªåŠ¨åŒ–çš„å¥½æ–¹æ¡ˆ**: ä¼˜åŒ–å®Œæˆ â†’ æ´¾å‘äº‹ä»¶ â†’ è‡ªåŠ¨ä¿å­˜
  2. **UI çŠ¶æ€å’Œæ•°æ®åˆ†ç¦»**: node.data åªä¿å­˜æ•°æ®ï¼ŒUI çŠ¶æ€éœ€è¦é¢å¤–æ¢å¤é€»è¾‘
  3. **å¼€å‘æ•ˆç‡ä¼˜å…ˆ**: è‡ªåŠ¨ä¿å­˜å¤§å¹…æå‡å¼€å‘æ•ˆç‡ï¼Œé¿å…é‡å¤ä¼˜åŒ–
  4. **ç”¨æˆ·ä½“éªŒæ”¹å–„**: æ— ç¼çš„çŠ¶æ€æ¢å¤ï¼Œç”¨æˆ·æ„Ÿè§‰ä¸åˆ°åˆ·æ–°çš„å½±å“
- **ä¿®æ”¹æ–‡ä»¶**:
  - `src/client/src/nodes/process/NarratorProcessorNode.jsx` - Lines 320-324, 67-78
  - `src/client/src/App.jsx` - Lines 522-570ï¼ˆæ·»åŠ äº‹ä»¶ç›‘å¬å™¨ï¼‰
  - `.claude/rules/error-patterns.md` - æ·»åŠ é”™è¯¯53
  - `.claude/skills/winjin-dev/SKILL.md` - æ·»åŠ é”™è¯¯53åˆ°é«˜é¢‘é”™è¯¯åˆ—è¡¨
  - `ç”¨æˆ·è¾“å…¥æ–‡ä»¶å¤¹/å¼€å‘å¯¹è¯/å¼€å‘äº¤æ¥ä¹¦.md` - ç‰ˆæœ¬å·æ›´æ–°åˆ° v4.7
- **ç›¸å…³é”™è¯¯**: é”™è¯¯53 - NarratorProcessorNode ä¼˜åŒ–ç»“æœåˆ·æ–°åä¸¢å¤± â­â­â­

