# WinJin AIGC å¼€å‘äº¤æ¥ä¹¦

**æ–‡æ¡£ç‰ˆæœ¬**: v2.4
**æ›´æ–°æ—¥æœŸ**: 2025-12-30
**é¡¹ç›®**: WinJin AIGC (å¼€æºé‡æ„ç‰ˆ)
**ä»“åº“**: https://github.com/leon30083/wenjing-aigc.git

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [ç¯å¢ƒè¦æ±‚](#ç¯å¢ƒè¦æ±‚)
3. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
4. [Claude Code é…ç½®ï¼ˆé‡è¦ï¼‰](#claude-code-é…ç½®é‡è¦)
5. [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
6. [å¸¸ç”¨å‘½ä»¤](#å¸¸ç”¨å‘½ä»¤)
7. [API ç«¯ç‚¹](#api-ç«¯ç‚¹)
8. [å¼€å‘è§„èŒƒ](#å¼€å‘è§„èŒƒ)
9. [å…³é”®æ¨¡å—è¯´æ˜](#å…³é”®æ¨¡å—è¯´æ˜)
10. [æœ€æ–°å¼€å‘è¿›åº¦](#æœ€æ–°å¼€å‘è¿›åº¦)
11. [æ³¨æ„äº‹é¡¹](#æ³¨æ„äº‹é¡¹)
12. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)
13. [å·¥ä½œæµç¼–è¾‘å™¨ä½¿ç”¨æŒ‡å—] â­ æ–°å¢

---

## é¡¹ç›®æ¦‚è¿°

WinJin AIGC æ˜¯ä¸€ä¸ªåŸºäº Electron + Express çš„ AI è§†é¢‘ç”Ÿæˆå·¥å…·ï¼Œæ”¯æŒï¼š

- **Sora2 è§†é¢‘ç”Ÿæˆ**: æ–‡ç”Ÿè§†é¢‘ã€è§’è‰²å‚è€ƒè§†é¢‘ã€æ•…äº‹æ¿æ‰¹é‡ç”Ÿæˆ
- **è§’è‰²åˆ›å»º**: ä»è§†é¢‘ä¸­æå–è§’è‰²ï¼Œæ”¯æŒè§’è‰²åº“ç®¡ç†
- **åŒå¹³å°æ”¯æŒ**: èšé‘«å¹³å° (api.jxincm.cn) å’Œè´è´å¹³å° (ai.t8star.cn)
- **å†å²è®°å½•**: è‡ªåŠ¨ä¿å­˜ä»»åŠ¡è®°å½•åˆ° JSON æ–‡ä»¶ï¼Œåå°è½®è¯¢è‡ªåŠ¨æ›´æ–°çŠ¶æ€
- **è§’è‰²åº“**: ç®¡ç†åˆ›å»ºçš„è§’è‰²ï¼Œæ”¯æŒæœç´¢ã€åˆ«åã€å¿«é€Ÿè°ƒç”¨
- **å¯è§†åŒ–èŠ‚ç‚¹å·¥ä½œæµ** â­ v2.0 æ–°å¢: ComfyUI é£æ ¼çš„æ‹–æ‹½å¼èŠ‚ç‚¹ç¼–è¾‘å™¨

---

## ç¯å¢ƒè¦æ±‚

### å¿…éœ€è½¯ä»¶

| è½¯ä»¶ | ç‰ˆæœ¬è¦æ±‚ | ä¸‹è½½åœ°å€ |
|------|----------|----------|
| **Node.js** | 16.x æˆ–æ›´é«˜ | https://nodejs.org/ |
| **npm** | 8.x æˆ–æ›´é«˜ | éš Node.js å®‰è£… |
| **Git** | æœ€æ–°ç‰ˆ | https://git-scm.com/ |
| **Claude Code** | æœ€æ–°ç‰ˆ | https://claude.com/claude-code |

### å¯é€‰è½¯ä»¶

- **VS Code**: æ¨èçš„ä»£ç ç¼–è¾‘å™¨
- **Chrome DevTools**: è°ƒè¯•å‰ç«¯ï¼ˆClaude Code å·²é›†æˆï¼‰

### æ“ä½œç³»ç»Ÿ

- Windows 10/11ï¼ˆä¸»è¦ç›®æ ‡å¹³å°ï¼‰
- macOS/Linuxï¼ˆå…¼å®¹ï¼‰

---

## å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/leon30083/wenjing-aigc.git
cd wenjing-aigc
```

### 2. å®‰è£…ä¾èµ–

```bash
# å®‰è£…é¡¹ç›®ä¾èµ–
npm install
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
copy .env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„ API Key
```

**`.env` æ–‡ä»¶å†…å®¹**:

```bash
# èšé‘«å¹³å° API Keyï¼ˆå¿…å¡«ï¼‰
SORA2_API_KEY=sk-your-actual-juxin-api-key

# è´è´å¹³å° API Keyï¼ˆå¯é€‰ï¼‰
ZHENZHEN_API_KEY=sk-your-actual-zhenzhen-api-key

# æœåŠ¡å™¨ç«¯å£
PORT=9000
```

### 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
# ä»…å¯åŠ¨ HTTP æœåŠ¡å™¨ï¼ˆç”¨äºå¼€å‘æµ‹è¯•ï¼‰
npm run server

# æˆ–è€…å¯åŠ¨å®Œæ•´çš„ Electron åº”ç”¨
npm start
```

æœåŠ¡å™¨å°†åœ¨ `http://localhost:9000` å¯åŠ¨ã€‚

---

## Claude Code é…ç½®ï¼ˆé‡è¦ï¼‰

**âš ï¸ è¿™æ˜¯å¼€å‘çš„æ ¸å¿ƒé…ç½®ï¼Œå¿…é¡»åœ¨æ–°çš„å¼€å‘ç¯å¢ƒä¸­æ­£ç¡®è®¾ç½®ï¼**

### é…ç½®æ–‡ä»¶ä½ç½®

```
.claude/
â”œâ”€â”€ settings.json          # Claude Code è®¾ç½®
â”œâ”€â”€ settings.local.json    # æœ¬åœ°è¦†ç›–è®¾ç½®ï¼ˆä¸æäº¤ï¼‰
â””â”€â”€ rules/                 # å¼€å‘è§„åˆ™
    â”œâ”€â”€ base.md            # åŸºç¡€æŠ€æœ¯æ ˆè§„åˆ™
    â””â”€â”€ code.md            # ä»£ç è§„èŒƒå’Œæœ€ä½³å®è·µ
```

### settings.json é…ç½®

**ä½ç½®**: `é¡¹ç›®æ ¹ç›®å½•/.claude/settings.json`

```json
{
  "mcpServers": {
    "memory": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-memory"]
    },
    "chrome-devtools": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-chrome-devtools"]
    },
    "context7": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-context7"]
    }
  }
}
```

### rules/base.md - æŠ€æœ¯æ ˆçº¦æŸ

**å…³é”®å†…å®¹**:

```markdown
## è¿è¡Œæ—¶ç¯å¢ƒ
- Node.js: 16.x æˆ–æ›´é«˜
- npm: 8.x æˆ–æ›´é«˜

## æ ¸å¿ƒæ¡†æ¶ç‰ˆæœ¬
| æ¡†æ¶/åº“ | ç‰ˆæœ¬è¦æ±‚ |
|---------|----------|
| Electron | ^28.0.0 |
| Express | ^4.18.2 |
| axios | ^1.6.5 |
| dotenv | ^17.2.3 |

## Sora2 API æ”¯æŒå¹³å°
### èšé‘«å¹³å° (api.jxincm.cn)
- åˆ›å»ºè§†é¢‘: POST /v1/video/create
- æŸ¥è¯¢ä»»åŠ¡: GET /v1/video/query?id={taskId} âš ï¸ æŸ¥è¯¢å‚æ•°
- åˆ›å»ºè§’è‰²: POST /sora/v1/characters

### è´è´å¹³å° (ai.t8star.cn)
- åˆ›å»ºè§†é¢‘: POST /v1/video/create
- æŸ¥è¯¢ä»»åŠ¡: GET /v2/videos/generations/{taskId} âš ï¸ è·¯å¾„å‚æ•°
- åˆ›å»ºè§’è‰²: POST /sora/v1/characters

### é‡è¦å·®å¼‚
- æŸ¥è¯¢ç«¯ç‚¹: èšé‘«ç”¨æŸ¥è¯¢å‚æ•° ?id=ï¼Œè´è´ç”¨è·¯å¾„å‚æ•° /{taskId}
- å“åº”æ ¼å¼: èšé‘«è¿”å› {id}, è´è´è¿”å› {task_id} âš ï¸ éœ€è¦å…¼å®¹å¤„ç†
- è§’è‰²åˆ›å»º: éƒ½æ”¯æŒ from_task å‚æ•°ï¼ˆæ¨èï¼‰

### è§’è‰²å¼•ç”¨è¯­æ³• â­
æ‰€æœ‰å¹³å°ç»Ÿä¸€ä½¿ç”¨ @username æ ¼å¼ï¼ˆä¸å¸¦èŠ±æ‹¬å·ï¼‰
ç¤ºä¾‹: @6f2dbf2b3.zenwhisper åœ¨å·¥åœ°ä¸Šå¹²æ´»

### è§’è‰²åˆ›å»ºè§„èŒƒ â­
- ç«¯ç‚¹: POST /sora/v1/characters
- å‚æ•°: url æˆ– from_task äºŒé€‰ä¸€
- å¿…å¡«: timestamps (æ ¼å¼: "1,3")
- âš ï¸ ç¦æ­¢: ä¸è¦ä¼ é€’ model å‚æ•°
- âœ… æ¨è: ä¼˜å…ˆä½¿ç”¨ from_task å‚æ•°

## è½®è¯¢ç­–ç•¥
- åå°è‡ªåŠ¨è½®è¯¢: 30ç§’é—´éš”
- æ£€æŸ¥èŒƒå›´: æ‰€æœ‰ queued å’Œ processing çŠ¶æ€çš„ä»»åŠ¡
- æ‰‹åŠ¨æŸ¥è¯¢: æä¾›"æŸ¥è¯¢çŠ¶æ€"æŒ‰é’®
```

### rules/code.md - ä»£ç è§„èŒƒ

**å…³é”®å†…å®¹**:

```markdown
## å‘½åçº¦å®š
- æ–‡ä»¶å: kebab-case
- å˜é‡/å‡½æ•°: camelCase
- ç±»å: PascalCase
- å¸¸é‡: UPPER_SNAKE_CASE
- ç§æœ‰æˆå‘˜: å‰ç¼€ä¸‹åˆ’çº¿ _

## Sora2 API å¼€å‘è§„èŒƒ

### åŒå¹³å°ä»»åŠ¡IDå…¼å®¹å¤„ç† âš ï¸ é‡è¦
// âœ… æ­£ç¡®ï¼šå…¼å®¹åŒå¹³å°çš„ä»»åŠ¡IDæ ¼å¼
const taskId = result.data.id || result.data.task_id;
if (taskId) {
  historyStorage.addRecord({ taskId, platform, prompt, model, options });
}

### è§’è‰²å¼•ç”¨è¯­æ³•
// âœ… æ­£ç¡®ï¼šæ‰€æœ‰å¹³å°ä½¿ç”¨ @username æ ¼å¼
const prompt = '@6f2dbf2b3.zenwhisper åœ¨å·¥åœ°ä¸Šå¹²æ´»';
// âŒ é”™è¯¯ï¼šä¸è¦ä½¿ç”¨èŠ±æ‹¬å·
const prompt = '@{6f2dbf2b3.zenwhisper} åœ¨å·¥åœ°ä¸Šå¹²æ´»';
```

### é…ç½® Claude Code è‡ªåŠ¨åŠ è½½è§„åˆ™

å½“åœ¨æ–°çš„å¼€å‘ç¯å¢ƒé¦–æ¬¡ä½¿ç”¨ Claude Code æ—¶ï¼š

1. **æ‰“å¼€é¡¹ç›®æ ¹ç›®å½•**
   ```bash
   cd D:\user\github\winjin
   ```

2. **å¯åŠ¨ Claude Code**
   - Claude Code ä¼šè‡ªåŠ¨è¯»å– `.claude/settings.json`
   - ä¼šè‡ªåŠ¨åŠ è½½ `rules/` ç›®å½•ä¸‹çš„è§„åˆ™æ–‡ä»¶

3. **éªŒè¯é…ç½®**
   - åœ¨ Claude Code ä¸­è¯¢é—®ï¼šè¯·åˆ—å‡ºå½“å‰é¡¹ç›®çš„æŠ€æœ¯æ ˆ
   - åº”è¯¥è¿”å› base.md ä¸­å®šä¹‰çš„æŠ€æœ¯æ ˆä¿¡æ¯

---

## é¡¹ç›®ç»“æ„

```
wenjing-aigc/
â”œâ”€â”€ .claude/                    # Claude Code é…ç½® â­
â”‚   â”œâ”€â”€ settings.json           # MCP æœåŠ¡å™¨é…ç½®
â”‚   â””â”€â”€ rules/                  # å¼€å‘è§„åˆ™
â”‚       â”œâ”€â”€ base.md             # æŠ€æœ¯æ ˆçº¦æŸ
â”‚       â””â”€â”€ code.md             # ä»£ç è§„èŒƒ
â”œâ”€â”€ data/                       # æ•°æ®æŒä¹…åŒ–ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”‚   â”œâ”€â”€ history.json            # å†å²è®°å½•
â”‚   â””â”€â”€ characters.json         # è§’è‰²åº“
â”œâ”€â”€ downloads/                  # è§†é¢‘ä¸‹è½½ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”œâ”€â”€ reference/                  # å‚è€ƒæ–‡æ¡£
â”‚   â””â”€â”€ ç”¨æˆ·è¾“å…¥æ–‡ä»¶å¤¹/
â”‚       â”œâ”€â”€ å¼€å‘ç»éªŒ/           # å¼€å‘æ–‡æ¡£ â­
â”‚       â”œâ”€â”€ èšé‘«sora2/          # èšé‘« API æ–‡æ¡£
â”‚       â””â”€â”€ è´è´å·¥åŠ/           # è´è´ API æ–‡æ¡£
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/                   # Electron ä¸»è¿›ç¨‹ï¼ˆæš‚æœªä½¿ç”¨ï¼‰
â”‚   â”œâ”€â”€ renderer/               # Electron æ¸²æŸ“è¿›ç¨‹
â”‚   â”‚   â””â”€â”€ public/
â”‚   â”‚       â””â”€â”€ index.html      # Web å‰ç«¯ç•Œé¢ï¼ˆv1.xï¼‰
â”‚   â”œâ”€â”€ server/                 # HTTP æœåŠ¡å™¨ â­
â”‚   â”‚   â”œâ”€â”€ index.js            # Express æœåŠ¡å™¨ä¸»æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ sora2-client.js     # Sora2 API å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ history-storage.js  # å†å²è®°å½•å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ character-storage.js # è§’è‰²åº“å­˜å‚¨
â”‚   â”‚   â””â”€â”€ batch-queue.js      # æ‰¹é‡ä»»åŠ¡é˜Ÿåˆ—
â”‚   â””â”€â”€ client/                 # â­ v2.0 æ–°å¢ï¼šå·¥ä½œæµç¼–è¾‘å™¨
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ nodes/          # è‡ªå®šä¹‰èŠ‚ç‚¹
â”‚       â”‚   â”‚   â”œâ”€â”€ input/      # è¾“å…¥èŠ‚ç‚¹ (4ä¸ª)
â”‚       â”‚   â”‚   â”œâ”€â”€ process/    # å¤„ç†èŠ‚ç‚¹ (3ä¸ª)
â”‚       â”‚   â”‚   â””â”€â”€ output/     # è¾“å‡ºèŠ‚ç‚¹ (2ä¸ª)
â”‚       â”‚   â”œâ”€â”€ hooks/          # React Hooks
â”‚       â”‚   â”‚   â””â”€â”€ useWorkflowExecution.js
â”‚       â”‚   â”œâ”€â”€ App.jsx         # ä¸»åº”ç”¨
â”‚       â”‚   â””â”€â”€ App.css
â”‚       â”œâ”€â”€ package.json
â”‚       â””â”€â”€ vite.config.js
â”œâ”€â”€ .env                        # ç¯å¢ƒå˜é‡ï¼ˆä¸æäº¤ï¼‰
â”œâ”€â”€ .env.example                # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ .gitignore                  # Git å¿½ç•¥è§„åˆ™
â”œâ”€â”€ package.json                # é¡¹ç›®ä¾èµ–
â””â”€â”€ README.md                   # é¡¹ç›®è¯´æ˜
```

---

## å¸¸ç”¨å‘½ä»¤

### å¼€å‘å‘½ä»¤

```bash
# å¯åŠ¨ HTTP æœåŠ¡å™¨ï¼ˆæœ€å¸¸ç”¨ï¼‰
npm run server

# å¯åŠ¨ Electron åº”ç”¨
npm start

# å¼€å‘æ¨¡å¼ï¼ˆçƒ­é‡è½½ï¼‰
npm run dev

# â­ v2.0 æ–°å¢ï¼šå¯åŠ¨å·¥ä½œæµç¼–è¾‘å™¨
cd src/client && npm run dev
# è®¿é—® http://localhost:5173
```

### Git å‘½ä»¤

```bash
# æŸ¥çœ‹çŠ¶æ€
git status

# æäº¤æ›´æ”¹
git add .
git commit -m "feat: your message"
git push origin master

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin master

# è®¾ç½®ä»£ç†ï¼ˆå¦‚éœ€è¦ï¼‰
git config --global http.proxy http://127.0.0.1:7890
git config --global https.proxy http://127.0.0.1:7890

# å–æ¶ˆä»£ç†
git config --global --unset http.proxy
git config --global --unset https.proxy
```

### æµ‹è¯•å‘½ä»¤

```bash
# æµ‹è¯•æœåŠ¡å™¨å¥åº·
curl http://localhost:9000/health

# æµ‹è¯•åˆ›å»ºè§†é¢‘
curl -X POST http://localhost:9000/api/video/create \
  -H "Content-Type: application/json" \
  -d '{"platform":"juxin","prompt":"A cat","model":"sora-2"}'
```

---

## API ç«¯ç‚¹

### å¥åº·æ£€æŸ¥
```
GET /health
```

### è§†é¢‘ç”Ÿæˆ
```
POST /api/video/create              # æ–‡ç”Ÿè§†é¢‘
POST /api/video/create-with-character  # å¸¦è§’è‰²å‚è€ƒ
POST /api/video/storyboard          # æ•…äº‹æ¿æ‰¹é‡
POST /api/video/download            # ä¸‹è½½è§†é¢‘
```

### è§’è‰²ç®¡ç†
```
POST   /api/character/create           # åˆ›å»ºè§’è‰²
GET    /api/character/list             # è·å–è§’è‰²åˆ—è¡¨
GET    /api/character/stats            # è·å–ç»Ÿè®¡ä¿¡æ¯
GET    /api/character/:characterId     # è·å–å•ä¸ªè§’è‰²
GET    /api/character/search/:query    # æœç´¢è§’è‰²
PUT    /api/character/:characterId/alias  # è®¾ç½®åˆ«å â­
DELETE /api/character/:characterId     # åˆ é™¤è§’è‰²
DELETE /api/character/all             # æ¸…ç©ºæ‰€æœ‰è§’è‰²
```

### ä»»åŠ¡æŸ¥è¯¢
```
GET /api/task/:taskId               # æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€
GET /api/task/:taskId/wait          # ç­‰å¾…ä»»åŠ¡å®Œæˆ
```

### å†å²è®°å½•
```
GET /api/history/list               # è·å–å†å²è®°å½•
GET /api/history/stats              # è·å–ç»Ÿè®¡ä¿¡æ¯
GET /api/history/:taskId            # è·å–å•æ¡è®°å½•
DELETE /api/history/:taskId         # åˆ é™¤è®°å½•
DELETE /api/history/all             # æ¸…ç©ºæ‰€æœ‰è®°å½•
```

### æ‰¹é‡ä»»åŠ¡
```
POST /api/batch/create              # åˆ›å»ºæ‰¹é‡ä»»åŠ¡
POST /api/batch/:id/submit          # æäº¤æ‰¹é‡ä»»åŠ¡
GET  /api/batch/:id/poll            # è½®è¯¢æ‰¹é‡ä»»åŠ¡
GET  /api/batch/:id/status          # è·å–æ‰¹é‡ä»»åŠ¡çŠ¶æ€
GET  /api/batch/list                # è·å–æ‰€æœ‰æ‰¹é‡ä»»åŠ¡
DELETE /api/batch/:id               # åˆ é™¤æ‰¹é‡ä»»åŠ¡
```

### å¤‡ä»½ç®¡ç† â­ æ–°å¢
```
GET  /api/backup/export             # å¯¼å‡ºå¤‡ä»½ï¼ˆJSONæ ¼å¼ï¼‰
POST /api/backup/import             # å¯¼å…¥å¤‡ä»½
GET  /api/backup/info               # è·å–æ•°æ®ç»Ÿè®¡ä¿¡æ¯
```

---

## å¼€å‘è§„èŒƒ

### ä»£ç é£æ ¼

```javascript
// âœ… æ­£ç¡®çš„å‘½å
const getUserData = () => {};  // camelCase
class UserService {};          // PascalCase
const MAX_RETRIES = 3;         // UPPER_SNAKE_CASE
const _privateVar = 'secret';  // ç§æœ‰æˆå‘˜å‰ç¼€

// âŒ é”™è¯¯çš„å‘½å
const GetUserData = () => {};  // ä¸ä½¿ç”¨ PascalCase
const user_data = () => {};    // ä¸ä½¿ç”¨ snake_case
```

### API è°ƒç”¨è§„èŒƒ

```javascript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ async/await + try-catch
async function createVideo(options) {
  try {
    const response = await axios.post('/api/video/create', options);
    return { success: true, data: response.data };
  } catch (error) {
    return { success: false, error: error.message };
  }
}

// âŒ é”™è¯¯ï¼šä¸ä½¿ç”¨ try-catch
async function createVideo(options) {
  const response = await axios.post('/api/video/create', options);
  return response.data;  // å¯èƒ½æŠ›å‡ºæœªæ•è·çš„å¼‚å¸¸
}
```

### ç»Ÿä¸€å“åº”æ ¼å¼

```javascript
// æˆåŠŸå“åº”
{ success: true, data: {...} }

// å¤±è´¥å“åº”
{ success: false, error: "é”™è¯¯ä¿¡æ¯" }
```

---

## å…³é”®æ¨¡å—è¯´æ˜

### 1. Sora2Client (src/server/sora2-client.js)

**èŒè´£**: å°è£… Sora2 API è°ƒç”¨ï¼Œæ”¯æŒåŒå¹³å°

**å…³é”®æ–¹æ³•**:
```javascript
// åˆ›å»ºè§†é¢‘ï¼ˆå…¼å®¹åŒå¹³å°å“åº”æ ¼å¼ï¼‰
await client.createVideo({
  prompt: 'A cat sleeping',
  model: 'sora-2',
  orientation: 'landscape',
  duration: 10,
  size: 'small'
});

// æŸ¥è¯¢ä»»åŠ¡ï¼ˆè‡ªåŠ¨å¤„ç†å¹³å°å·®å¼‚ï¼‰
await client.getTaskStatus(taskId);

// åˆ›å»ºè§’è‰²ï¼ˆæ”¯æŒ from_taskï¼‰
await client.createCharacter({
  from_task: taskId,  // æ¨èæ–¹å¼
  timestamps: '1,3'
});
```

### 2. HistoryStorage (src/server/history-storage.js)

**èŒè´£**: å†å²è®°å½•æŒä¹…åŒ–å­˜å‚¨

**å­˜å‚¨ä½ç½®**: `data/history.json`

**å…³é”®æ–¹æ³•**:
```javascript
// æ·»åŠ è®°å½•
historyStorage.addRecord({
  taskId: 'video_xxx',
  platform: 'juxin',
  prompt: 'A cat',
  model: 'sora-2'
});

// æ ‡è®°å®Œæˆ
historyStorage.markCompleted(taskId, { output: 'url' });

// è·å–æ‰€æœ‰è®°å½•
const records = historyStorage.getAllRecords({
  status: 'queued',
  platform: 'zhenzhen'
});
```

### 3. CharacterStorage (src/server/character-storage.js)

**èŒè´£**: è§’è‰²åº“æŒä¹…åŒ–å­˜å‚¨

**å­˜å‚¨ä½ç½®**: `data/characters.json`

**å…³é”®æ–¹æ³•**:
```javascript
// æ·»åŠ è§’è‰²ï¼ˆè‡ªåŠ¨å»é‡ï¼‰
characterStorage.addCharacter({
  id: 'ch_xxx',
  username: 'user.name',
  alias: 'åˆ«å',  // â­ æ–°å¢
  profilePictureUrl: 'url',
  platform: 'zhenzhen'
});

// æ›´æ–°è§’è‰²ï¼ˆè®¾ç½®åˆ«åï¼‰
characterStorage.updateCharacter(characterId, { alias: 'æ–°åˆ«å' });

// æœç´¢è§’è‰²
const results = characterStorage.searchCharacters('user');

// è·å–ç»Ÿè®¡
const stats = characterStorage.getStats();
// { total: 10, byPlatform: { juxin: 5, zhenzhen: 5 } }
```

### 4. åå°è½®è¯¢æœåŠ¡ (src/server/index.js)

**èŒè´£**: è‡ªåŠ¨æ£€æŸ¥å¹¶æ›´æ–°ä»»åŠ¡çŠ¶æ€

**é…ç½®**:
```javascript
const POLL_INTERVAL = 30000;  // 30ç§’

// æ£€æŸ¥æ‰€æœ‰ queued å’Œ processing çŠ¶æ€çš„ä»»åŠ¡
setInterval(async () => {
  const queuedTasks = historyStorage.getAllRecords({ status: 'queued' });
  const processingTasks = historyStorage.getAllRecords({ status: 'processing' });
  const allPendingTasks = [...queuedTasks, ...processingTasks];

  for (const record of allPendingTasks) {
    await checkAndUpdateTask(record.taskId, record.platform);
  }
}, POLL_INTERVAL);
```

---

## æœ€æ–°å¼€å‘è¿›åº¦

### å·²å®ŒæˆåŠŸèƒ½ âœ…

#### 1. åŒå¹³å°å…¼å®¹æ€§ä¿®å¤ (2025-12-29)
- **é—®é¢˜**: è´è´å¹³å°è§†é¢‘æœªä¿å­˜åˆ°å†å²è®°å½•
- **åŸå› **: è´è´è¿”å› `{task_id}`, èšé‘«è¿”å› `{id}`
- **è§£å†³**: å…¼å®¹å¤„ç† `result.data.id || result.data.task_id`

#### 2. è§’è‰²å¼•ç”¨è¯­æ³•ä¿®æ­£ (2025-12-29)
- **é—®é¢˜**: ä¹‹å‰ä½¿ç”¨ `@{username}` æ ¼å¼ï¼ˆé”™è¯¯ï¼‰
- **ä¿®æ­£**: æ‰€æœ‰å¹³å°ç»Ÿä¸€ä½¿ç”¨ `@username` æ ¼å¼ï¼ˆä¸å¸¦èŠ±æ‹¬å·ï¼‰
- **ç¤ºä¾‹**: `@6f2dbf2b3.zenwhisper åœ¨å·¥åœ°ä¸Šå¹²æ´»`

#### 3. åå°è½®è¯¢æœåŠ¡ (2025-12-29)
- **åŠŸèƒ½**: æ¯30ç§’è‡ªåŠ¨æ£€æŸ¥å¾…å¤„ç†ä»»åŠ¡çŠ¶æ€
- **èŒƒå›´**: æ‰€æœ‰ `queued` å’Œ `processing` çŠ¶æ€çš„ä»»åŠ¡
- **æ›´æ–°**: è‡ªåŠ¨æ›´æ–°å†å²è®°å½•çŠ¶æ€

#### 4. æ‰‹åŠ¨æŸ¥è¯¢åŠŸèƒ½ (2025-12-29)
- **åŠŸèƒ½**: ä¸ºæ¯ä¸ªä»»åŠ¡æ·»åŠ "æŸ¥è¯¢çŠ¶æ€"æŒ‰é’®
- **ç”¨é€”**: ç”¨æˆ·å¯ä¸»åŠ¨æŸ¥è¯¢è€Œæ— éœ€ç­‰å¾…è½®è¯¢

#### 5. è§’è‰²åº“å¢å¼º (2025-12-29)
- **åˆ«ååŠŸèƒ½**: ä¸ºè§’è‰²è®¾ç½®æ˜“äºè®°å¿†çš„åˆ«å
- **å¿«é€Ÿè°ƒç”¨**: åœ¨è§†é¢‘åˆ›å»ºè¡¨å•ä¸­æ·»åŠ è§’è‰²é€‰æ‹©å™¨
- **å¤åˆ¶ID**: ä¿®å¤å¤åˆ¶IDæŒ‰é’®åŠŸèƒ½

#### 6. å¯è§†åŒ–è§’è‰²é€‰æ‹©å™¨ (2025-12-29)
- **ç½‘æ ¼å¸ƒå±€**: ä»ä¸‹æ‹‰æ¡†æ”¹ä¸ºå¯è§†åŒ–è§’è‰²å¡ç‰‡ç½‘æ ¼
- **å¤´åƒæ˜¾ç¤º**: æ˜¾ç¤ºè§’è‰²å¤´åƒã€åˆ«åå’Œç”¨æˆ·å
- **é€‰ä¸­çŠ¶æ€**: æ”¯æŒç‚¹å‡»é€‰æ‹©/å–æ¶ˆé€‰ä¸­ï¼Œæœ‰è§†è§‰åé¦ˆ
- **å¹³å°é€šç”¨**: ä¸æ˜¾ç¤ºå¹³å°æ ‡ç­¾ï¼ˆsora2 è§’è‰²è·¨å¹³å°é€šç”¨ï¼‰

#### 7. å…‰æ ‡ä½ç½®æ’å…¥ (2025-12-29)
- **æ–‡ç”Ÿè§†é¢‘**: ç‚¹å‡»è§’è‰²æ—¶åœ¨å…‰æ ‡ä½ç½®æ’å…¥ `@username` å¼•ç”¨
- **æ•…äº‹æ¿**: è®°å½•æœ€åç„¦ç‚¹çš„åœºæ™¯è¾“å…¥æ¡†ï¼Œåªåœ¨å…¶ä¸­æ’å…¥
- **ä¸æ›¿æ¢å†…å®¹**: ä¸å½±å“ç”¨æˆ·å·²è¾“å…¥çš„å…¶ä»–å†…å®¹

#### 8. å¤‡ä»½ç®¡ç†åŠŸèƒ½ (2025-12-29) â­ æ–°å¢
- **å‰ç«¯ç•Œé¢**: æ–°å¢"å¤‡ä»½ç®¡ç†"æ ‡ç­¾é¡µ
- **å¯¼å‡ºå¤‡ä»½**: å°†æ‰€æœ‰å†å²è®°å½•å’Œè§’è‰²åº“å¯¼å‡ºä¸º JSON æ–‡ä»¶
- **å¯¼å…¥å¤‡ä»½**: ä»å¤‡ä»½æ–‡ä»¶æ¢å¤æ•°æ®ï¼Œè·³è¿‡å·²å­˜åœ¨çš„è®°å½•
- **æ•°æ®ç»Ÿè®¡**: å®æ—¶æ˜¾ç¤ºå†å²è®°å½•å’Œè§’è‰²æ•°é‡ç»Ÿè®¡
- **åŒæ ¼å¼æ”¯æŒ**: å¯¼å…¥åŠŸèƒ½æ”¯æŒ API åŒ…è£…æ ¼å¼å’Œçº¯å¤‡ä»½æ ¼å¼
- **ç‰ˆæœ¬æ§åˆ¶**: å¤‡ä»½æ–‡ä»¶åŒ…å«ç‰ˆæœ¬å·å’Œæ—¶é—´æˆ³

#### 9. å‚è€ƒå›¾ç‰‡åŠŸèƒ½ (2025-12-29) â­ æ–°å¢
- **æ–‡ç”Ÿ/å›¾ç”Ÿè§†é¢‘è‡ªåŠ¨æ£€æµ‹**: æ ¹æ®æ˜¯å¦æä¾›å‚è€ƒå›¾ç‰‡è‡ªåŠ¨é€‰æ‹©æ¨¡å¼
- **ç®€å•æ¨¡å¼**: æ”¯æŒåŠ¨æ€æ·»åŠ /åˆ é™¤å¤šå¼ å‚è€ƒå›¾ç‰‡
- **æ•…äº‹æ¿æ¨¡å¼**: æ¯ä¸ªåˆ†é•œå¤´å¯ç‹¬ç«‹é…ç½®å‚è€ƒå›¾ç‰‡
- **åç«¯æ”¶é›†**: è‡ªåŠ¨æ”¶é›†æ‰€æœ‰é•œå¤´çš„å›¾ç‰‡å¹¶åˆå¹¶åˆ° images æ•°ç»„
- **è§’è‰²æ··åˆ**: æ”¯æŒè§’è‰²å®¢ä¸²ä¸å‚è€ƒå›¾ç‰‡æ­é…ä½¿ç”¨
- **æç¤ºè¯ä¼˜åŒ–**: å…ˆåˆ†æå›¾ç‰‡å†…å®¹ï¼Œå†å†™ç›¸å…³æ€§å¼ºçš„æç¤ºè¯

#### 10. å†å²è®°å½•ç®¡ç†åŠŸèƒ½ (2025-12-29) â­ æ–°å¢
- **å•æ¡åˆ é™¤**: æ¯æ¡å†å²è®°å½•éƒ½æœ‰åˆ é™¤æŒ‰é’®ï¼Œæ”¯æŒæŒ‰ä»»åŠ¡IDåˆ é™¤
- **æ¸…ç©ºå…¨éƒ¨**: ä¸€é”®æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•ï¼Œæœ‰åŒé‡ç¡®è®¤æœºåˆ¶
- **å®‰å…¨ä¿æŠ¤**: æ‰€æœ‰åˆ é™¤æ“ä½œéƒ½éœ€è¦ç”¨æˆ·ç¡®è®¤ï¼Œé˜²æ­¢è¯¯æ“ä½œ
- **è‡ªåŠ¨åˆ·æ–°**: åˆ é™¤æˆåŠŸåè‡ªåŠ¨åˆ·æ–°å†å²è®°å½•åˆ—è¡¨
- **é”™è¯¯å¤„ç†**: å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ

#### 11. è§’è‰²æœç´¢ã€ç­›é€‰å’Œæ”¶è—åŠŸèƒ½ (2025-12-29) â­ æ–°å¢
- **å®æ—¶æœç´¢**: æŒ‰è§’è‰²ç”¨æˆ·åæˆ–åˆ«åæœç´¢ï¼Œ300ms é˜²æŠ–å»¶è¿Ÿ
- **ç­›é€‰ç±»å‹**: å…¨éƒ¨è§’è‰² / æˆ‘çš„æ”¶è— / æœ€è¿‘ä½¿ç”¨
- **æ”¶è—åŠŸèƒ½**: ç‚¹å‡»æ˜Ÿæ ‡å›¾æ ‡æ”¶è—/å–æ¶ˆæ”¶è—è§’è‰²
- **æœ€è¿‘ä½¿ç”¨**: è‡ªåŠ¨è®°å½•æœ€è¿‘ä½¿ç”¨çš„ 20 ä¸ªè§’è‰²ï¼ˆlocalStorageï¼‰
- **åç«¯ API**: æ–°å¢ `PUT /api/character/:username/favorite` æ”¶è—ç«¯ç‚¹
- **å­˜å‚¨å¢å¼º**: æ–°å¢ `updateByUsername` æ–¹æ³•æ”¯æŒæŒ‰ç”¨æˆ·åæ›´æ–°

### å·²çŸ¥é—®é¢˜
æ— 

### å¾…å¼€å‘åŠŸèƒ½

#### 13. å·¥ä½œæµä¿å­˜/åŠ è½½åŠŸèƒ½ (å¾…å¼€å‘) â³
- **åŠŸèƒ½**: ä¿å­˜å½“å‰å·¥ä½œæµé…ç½®ï¼Œæ”¯æŒå¿«é€ŸåŠ è½½
- **æ ¼å¼**: JSON æ–‡ä»¶å­˜å‚¨èŠ‚ç‚¹ä½ç½®ã€è¿æ¥å…³ç³»ã€å‚æ•°é…ç½®
- **æ¨¡æ¿åº“**: é¢„è®¾å¸¸ç”¨å·¥ä½œæµæ¨¡æ¿

---

## ğŸ‰ é‡å¤§é‡Œç¨‹ç¢‘ï¼šå¯è§†åŒ–èŠ‚ç‚¹å·¥ä½œæµç³»ç»Ÿå®Œæˆï¼ (2025-12-30)

#### 12. å¯è§†åŒ–èŠ‚ç‚¹å·¥ä½œæµç³»ç»Ÿ âœ… å·²å®Œæˆ

**å®ç°æ¦‚è¿°**ï¼š
æˆåŠŸå®ç°å®Œæ•´çš„ ComfyUI é£æ ¼å¯è§†åŒ–èŠ‚ç‚¹å·¥ä½œæµç¼–è¾‘å™¨ï¼ŒåŒ…å« 9 ç§èŠ‚ç‚¹ç±»å‹ã€æ™ºèƒ½æ‰§è¡Œå¼•æ“ã€å®æ—¶æ•°æ®æµä¼ é€’ã€‚

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
1. **React Flow ç”»å¸ƒ** - æ‹–æ‹½èŠ‚ç‚¹å¸ƒå±€ã€è´å¡å°”æ›²çº¿è¿çº¿
2. **9 ç§èŠ‚ç‚¹ç±»å‹** - 4 è¾“å…¥ + 3 å¤„ç† + 2 è¾“å‡º
3. **æ‰§è¡Œå¼•æ“** - æ‹“æ‰‘æ’åºè‡ªåŠ¨æ‰§è¡Œã€è¿›åº¦å®æ—¶åé¦ˆ
4. **å·¥å…·æ  UI** - æ‰§è¡Œ/é‡ç½®æŒ‰é’®ã€çŠ¶æ€æ˜¾ç¤º

**èŠ‚ç‚¹æ¸…å•**ï¼š

**è¾“å…¥èŠ‚ç‚¹ (4ä¸ª)** - è“è‰²ç³»:
- ğŸ“ æ–‡æœ¬èŠ‚ç‚¹ - æç¤ºè¯è¾“å…¥ (TextNode.jsx)
- ğŸ–¼ï¸ å‚è€ƒå›¾ç‰‡èŠ‚ç‚¹ - å›¾ç‰‡URLç®¡ç† (ReferenceImageNode.jsx)
- ğŸ± è§’è‰²é€‰æ‹©èŠ‚ç‚¹ - ä»åº“é€‰æ‹© (CharacterSelectNode.jsx)
- ğŸ“Š è§’è‰²åº“èŠ‚ç‚¹ - æµè§ˆæ‰€æœ‰è§’è‰² (CharacterLibraryNode.jsx)

**å¤„ç†èŠ‚ç‚¹ (3ä¸ª)** - ç»¿è‰²ç³»:
- ğŸ­ è§’è‰²ç”ŸæˆèŠ‚ç‚¹ - URL/ä»»åŠ¡IDåˆ›å»ºè§’è‰² (CharacterCreateNode.jsx)
- ğŸ¬ è§†é¢‘ç”ŸæˆèŠ‚ç‚¹ - æ–‡ç”Ÿè§†é¢‘ (VideoGenerateNode.jsx)
- ğŸï¸ æ•…äº‹æ¿èŠ‚ç‚¹ - æ‰¹é‡å¤šé•œå¤´ç”Ÿæˆ (StoryboardNode.jsx)

**è¾“å‡ºèŠ‚ç‚¹ (2ä¸ª)** - å¤©è“ç³»:
- ğŸ“º ä»»åŠ¡ç»“æœèŠ‚ç‚¹ - è§†é¢‘é¢„è§ˆ/ä¸‹è½½ (TaskResultNode.jsx)
- ğŸ“‹ æ‰§è¡Œæ—¥å¿—èŠ‚ç‚¹ - æ—¥å¿—å±•ç¤º (ExecutionLogNode.jsx)

**æŠ€æœ¯å®ç°**ï¼š
- React 19 + React Flow 11.x
- Vite 7.x æ„å»ºå·¥å…·
- è‡ªå®šä¹‰ useWorkflowExecution Hook
- æ‹“æ‰‘æ’åºç®—æ³•
- å¾ªç¯ä¾èµ–æ£€æµ‹

**Git æäº¤è®°å½•**ï¼š
```
1bc576f feat: Phase 5 - Implement output nodes
9da8039 feat: Phase 4 - Implement workflow execution engine
042b0ca feat: Phase 3 - Implement all process nodes
8a4d596 feat: Phase 2 - Implement all input nodes
b5b21c8 feat: Phase 1 - React Flow workflow editor foundation
```

**è®¿é—®åœ°å€**ï¼š
- å·¥ä½œæµç¼–è¾‘å™¨: http://localhost:5173
- å¯åŠ¨å‘½ä»¤: `cd src/client && npm run dev`

**é¡¹ç›®ç»“æ„**ï¼š
```
src/client/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ nodes/
â”‚   â”‚   â”œâ”€â”€ input/    # 4ä¸ªè¾“å…¥èŠ‚ç‚¹
â”‚   â”‚   â”œâ”€â”€ process/  # 3ä¸ªå¤„ç†èŠ‚ç‚¹
â”‚   â”‚   â””â”€â”€ output/   # 2ä¸ªè¾“å‡ºèŠ‚ç‚¹
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â””â”€â”€ useWorkflowExecution.js
â”‚   â””â”€â”€ App.jsx
```

**åŠŸèƒ½éªŒè¯**ï¼š
- âœ… æ‰€æœ‰èŠ‚ç‚¹æ­£å¸¸æ¸²æŸ“
- âœ… èŠ‚ç‚¹å¯æ‹–æ‹½/è¿æ¥
- âœ… æ‰§è¡Œå¼•æ“æ­£ç¡®æ’åº
- âœ… æ•°æ®æµè‡ªåŠ¨ä¼ é€’

---

### é‡å¤§ Bug ä¿®å¤ ğŸ›

#### 14. TaskResultNode API ç«¯ç‚¹è·¯å¾„ä¿®å¤ (2025-12-30) â­ é‡å¤§ä¿®å¤
- **é—®é¢˜**: TaskResultNode è½®è¯¢ä»»åŠ¡çŠ¶æ€æ—¶è¿”å› 404 é”™è¯¯
- **åŸå› **: API è·¯å¾„ç¼ºå°‘ `/api/` å‰ç¼€
  - é”™è¯¯: `http://localhost:9000/task/{taskId}` â†’ 404
  - æ­£ç¡®: `http://localhost:9000/api/task/{taskId}` â†’ 200
- **å½±å“**: è§†é¢‘ä»»åŠ¡å®Œæˆåæ— æ³•æ˜¾ç¤ºç»“æœ
- **ä¿®å¤ä½ç½®**:
  - `src/client/src/nodes/output/TaskResultNode.jsx` (ç¬¬66è¡Œã€ç¬¬102è¡Œ)
- **ä¿®å¤å†…å®¹**:
  - è½®è¯¢å‡½æ•°: æ·»åŠ  `/api/` å‰ç¼€
  - æ‰‹åŠ¨åˆ·æ–°å‡½æ•°: æ·»åŠ  `/api/` å‰ç¼€
- **éªŒè¯ç»“æœ**:
  - âœ… API è¯·æ±‚æˆåŠŸè¿”å› 200 OK
  - âœ… ä»»åŠ¡çŠ¶æ€æ­£ç¡®è½®è¯¢
  - âœ… è§†é¢‘URLæ­£ç¡®æ˜¾ç¤º
  - âœ… taskId é€šè¿‡äº‹ä»¶ç³»ç»Ÿæ­£ç¡®ä¼ é€’

#### 15. å·¥ä½œæµèŠ‚ç‚¹æ•°æ®æµä¿®å¤ (2025-12-30)

**é—®é¢˜æè¿°**ï¼š
- ä»»åŠ¡ç»“æœèŠ‚ç‚¹æœªæ¥æ”¶åˆ°æ¥è‡ªè§†é¢‘ç”ŸæˆèŠ‚ç‚¹çš„ taskId
- æ‰§è¡Œæ—¥å¿—èŠ‚ç‚¹æœªæ˜¾ç¤ºå·¥ä½œæµæ‰§è¡Œæ—¥å¿—
- å¯¼è‡´è¾“å‡ºèŠ‚ç‚¹æ— æ³•æ­£å¸¸å·¥ä½œ

**ä¿®å¤å†…å®¹**ï¼š

1. **ä¿®å¤æ— é™å¾ªç¯é—®é¢˜**
   - ç§»é™¤ useEffect ä¾èµ–æ•°ç»„ä¸­çš„ `nodes`
   - ä½¿ç”¨å‡½æ•°å¼æ›´æ–°è‡ªåŠ¨è·å–æœ€æ–°èŠ‚ç‚¹æ•°æ®
   - æ–‡ä»¶ï¼šApp.jsx:206

2. **ä¿®å¤ taskId ä¼ é€’**
   - VideoGenerateNode ä½¿ç”¨ `useNodeId()` è·å–èŠ‚ç‚¹ ID
   - é€šè¿‡ `setNodes()` æ›´æ–° node.data.taskId
   - æ´¾å‘è‡ªå®šä¹‰äº‹ä»¶ 'video-task-created' é€šçŸ¥è¿æ¥çš„èŠ‚ç‚¹
   - æ–‡ä»¶ï¼šVideoGenerateNode.jsx:7,85-87

3. **ä¿®å¤äº‹ä»¶ç›‘å¬**
   - TaskResultNode ç›‘å¬ 'video-task-created' äº‹ä»¶
   - æ£€æŸ¥ connectedSourceId åŒ¹é…åæ›´æ–° taskId
   - æ”¯æŒè‡ªåŠ¨è½®è¯¢ä»»åŠ¡çŠ¶æ€
   - æ–‡ä»¶ï¼šTaskResultNode.jsx:26-37

4. **ä¿®å¤æ‰§è¡Œæ—¥å¿—ä¼ é€’**
   - useWorkflowExecution æ·»åŠ  logs æ•°ç»„åˆ° executionState
   - åˆ›å»º addLog() è¾…åŠ©å‡½æ•°è®°å½•æ‰§è¡Œæ­¥éª¤
   - App.jsx ä¼ é€’ logs åˆ° ExecutionLogNode
   - æ–‡ä»¶ï¼šuseWorkflowExecution.js:9-19,77-81

5. **æ·»åŠ  connectedSourceId ä¼ é€’**
   - App.jsx åœ¨è¿æ¥æ—¶ä¼ é€’ source node ID
   - TaskResultNode ä½¿ç”¨ connectedSourceId éªŒè¯äº‹ä»¶æ¥æº
   - æ–‡ä»¶ï¼šApp.jsx:194-196

**æŠ€æœ¯è¦ç‚¹**ï¼š
- React Flow çš„ data ä¸åŒ…å«èŠ‚ç‚¹ idï¼Œå¿…é¡»ä½¿ç”¨ useNodeId()
- setNodes() æ˜¯å¼‚æ­¥æ‰¹å¤„ç†ï¼Œä¸èƒ½ä¾èµ– getNodes() è·å–æœ€æ–°æ•°æ®
- ä½¿ç”¨è‡ªå®šä¹‰äº‹ä»¶ç³»ç»Ÿå®ç°èŠ‚ç‚¹é—´å®æ—¶é€šä¿¡
- useEffect ä¾èµ–æ•°ç»„ä¸èƒ½åŒ…å«ä¼šå¯¼è‡´è‡ªèº«æ›´æ–°çš„çŠ¶æ€

**éªŒè¯ç»“æœ**ï¼š
- âœ… æ–‡æœ¬èŠ‚ç‚¹ â†’ è§†é¢‘ç”ŸæˆèŠ‚ç‚¹ï¼šæç¤ºè¯æ­£ç¡®ä¼ é€’
- âœ… è§†é¢‘ç”Ÿæˆ â†’ ä»»åŠ¡ç»“æœèŠ‚ç‚¹ï¼štaskId é€šè¿‡äº‹ä»¶æ­£ç¡®ä¼ é€’
- âœ… ä»»åŠ¡ç»“æœèŠ‚ç‚¹ï¼šæ˜¾ç¤º taskId å¹¶è‡ªåŠ¨è½®è¯¢çŠ¶æ€
- âœ… æ‰§è¡Œæ—¥å¿—èŠ‚ç‚¹ï¼šæ˜¾ç¤ºå®Œæ•´å·¥ä½œæµæ‰§è¡Œæ—¥å¿—

**ç›¸å…³æ–‡æ¡£æ›´æ–°**ï¼š
- code.mdï¼šæ·»åŠ  "é”™è¯¯16: React Flow èŠ‚ç‚¹é—´æ•°æ®ä¼ é€’é”™è¯¯"

---

#### 16. è§†é¢‘ç”ŸæˆèŠ‚ç‚¹æ—¶é•¿å‚æ•°ä¿®å¤ (2025-12-30) â­ æ–°å¢
- **é—®é¢˜**:
  - Sora2 API ä¸æ”¯æŒ 1:1 æ¯”ä¾‹
  - æ—¶é•¿å‚æ•°ç±»å‹é”™è¯¯ï¼ˆå­—ç¬¦ä¸²è€Œéæ•°å­—ï¼‰
- **ä¿®å¤**:
  - ç§»é™¤ 1:1 æ¯”ä¾‹é€‰é¡¹ï¼Œåªä¿ç•™ 16:9 å’Œ 9:16
  - æ·»åŠ æ—¶é•¿ä¸‹æ‹‰èœå•ï¼š5ç§’ã€10ç§’ã€15ç§’ã€25ç§’
  - æ—¶é•¿å‚æ•°ä»å­—ç¬¦ä¸²æ”¹ä¸ºæ•°å­—ç±»å‹
- **å½±å“æ–‡ä»¶**: `src/client/src/nodes/process/VideoGenerateNode.jsx`

#### 17. ä»»åŠ¡ç»“æœèŠ‚ç‚¹å¢å¼ºåŠŸèƒ½ (2025-12-30) â­ æ–°å¢
- **æ–°å¢åŠŸèƒ½**:
  - ğŸ“‹ å¤åˆ¶ TaskId æŒ‰é’®ï¼ˆå¸¦ 2 ç§’åé¦ˆæç¤ºï¼‰
  - ğŸ”— å¤åˆ¶è§†é¢‘é“¾æ¥æŒ‰é’®
  - ğŸ”„ æ‰‹åŠ¨æŸ¥è¯¢çŠ¶æ€æŒ‰é’®
  - æ”¯æŒæ—§æµè§ˆå™¨é™çº§ï¼ˆexecCommand å¤‡é€‰æ–¹æ¡ˆï¼‰
- **æŠ€æœ¯å®ç°**:
  - ä½¿ç”¨ navigator.clipboard APIï¼ˆç°ä»£æµè§ˆå™¨ï¼‰
  - é™çº§æ–¹æ¡ˆï¼šdocument.execCommand('copy')ï¼ˆæ—§æµè§ˆå™¨ï¼‰
  - å¤åˆ¶æˆåŠŸåæ˜¾ç¤º 2 ç§’åé¦ˆæç¤º
- **å½±å“æ–‡ä»¶**: `src/client/src/nodes/output/TaskResultNode.jsx`

#### 18. å·¥ä½œæµç®¡ç†ç³»ç»Ÿ (2025-12-30) â­ æ–°å¢
- **æ ¸å¿ƒåŠŸèƒ½**:
  - ğŸ’¾ **ä¿å­˜å·¥ä½œæµ** - ä¿å­˜åˆ°å½“å‰å·¥ä½œæµæˆ–å¦å­˜ä¸ºæ–°åç§°
  - ğŸ“‚ **æ‰“å¼€å·¥ä½œæµ** - åˆ—è¡¨æŸ¥çœ‹å¹¶åŠ è½½å·²ä¿å­˜çš„å·¥ä½œæµ
  - â• **æ–°å»ºå·¥ä½œæµ** - æ¸…ç©ºå½“å‰å·¥ä½œæµï¼ˆå¸¦ç¡®è®¤å¯¹è¯æ¡†ï¼‰
  - ğŸ—‘ï¸ **åˆ é™¤å·¥ä½œæµ** - åˆ é™¤æŒ‡å®šå·¥ä½œæµï¼ˆå¸¦ç¡®è®¤å¯¹è¯æ¡†ï¼‰
  - ğŸ“¤ **å¯¼å‡ºå·¥ä½œæµ** - ä¸‹è½½ä¸º JSON æ–‡ä»¶
  - ğŸ“¥ **å¯¼å…¥å·¥ä½œæµ** - ä» JSON æ–‡ä»¶å¯¼å…¥ï¼ˆè‡ªåŠ¨é‡å‘½åé¿å…å†²çªï¼‰
  - ğŸ“ **å½“å‰å·¥ä½œæµæ˜¾ç¤º** - å·¥å…·æ æ˜¾ç¤ºè“è‰²æ ‡ç­¾
- **æŠ€æœ¯å®ç°**:
  - åˆ›å»º `WorkflowStorage` å·¥å…·ç±»ï¼ˆ`src/client/src/utils/workflowStorage.js`ï¼‰
  - localStorage æŒä¹…åŒ–å­˜å‚¨ï¼ˆé”®åï¼š`winjin-workflows`ï¼‰
  - è‡ªåŠ¨ç®¡ç† nextNodeIdï¼ˆåŠ è½½å·¥ä½œæµåè‡ªåŠ¨é€’å¢ï¼‰
  - å®Œæ•´çš„ UI å¯¹è¯æ¡†å’Œä¸‹æ‹‰èœå•
  - æ•°æ®éªŒè¯ï¼ˆå¯¼å…¥æ—¶æ£€æŸ¥å¿…éœ€å­—æ®µï¼‰
  - å†²çªå¤„ç†ï¼ˆå¯¼å…¥æ—¶è‡ªåŠ¨æ·»åŠ åç¼€é¿å…è¦†ç›–ï¼‰
- **å½±å“æ–‡ä»¶**:
  - `src/client/src/utils/workflowStorage.js` (æ–°å¢)
  - `src/client/src/App.jsx` (å·¥ä½œæµç®¡ç† UI)
- **å­˜å‚¨ç»“æ„**:
  ```javascript
  {
    "å·¥ä½œæµåç§°": {
      name: "å·¥ä½œæµåç§°",
      description: "å·¥ä½œæµæè¿°",
      nodes: [...],      // React Flow èŠ‚ç‚¹æ•°ç»„
      edges: [...],      // React Flow è¿çº¿æ•°ç»„
      createdAt: "2025-12-30T12:00:00.000Z",
      updatedAt: "2025-12-30T12:30:00.000Z"
    }
  }
  ```

#### 19. èŠ‚ç‚¹ç®¡ç†å¢å¼ºåŠŸèƒ½ (2025-12-30) â­ æ–°å¢
- **å³é”®èœå•åŠŸèƒ½**:
  - **èŠ‚ç‚¹èœå•**: å¤åˆ¶èŠ‚ç‚¹ã€åˆ é™¤èŠ‚ç‚¹
  - **ç”»å¸ƒèœå•**: ç²˜è´´èŠ‚ç‚¹ã€æ·»åŠ æ‰€æœ‰èŠ‚ç‚¹ç±»å‹
  - **ç‚¹å‡»å¤–éƒ¨**: è‡ªåŠ¨å…³é—­èœå•
- **èŠ‚ç‚¹åˆ é™¤ä¿®å¤**:
  - **ä¸Šä¸‹æ–‡åˆ é™¤**: åˆ é™¤å³é”®ç‚¹å‡»çš„ç‰¹å®šèŠ‚ç‚¹ï¼ˆ`deleteNode(node)`ï¼‰
  - **å·¥å…·æ åˆ é™¤**: åˆ é™¤æ‰€æœ‰é€‰ä¸­èŠ‚ç‚¹ï¼ˆ`deleteSelectedNodes()`ï¼‰
  - **å¿«æ·é”®**: Delete é”®åˆ é™¤é€‰ä¸­èŠ‚ç‚¹
- **èŠ‚ç‚¹åˆ›å»ºä½ç½®ä¿®å¤**:
  - **å³é”®åˆ›å»º**: ä½¿ç”¨ `screenToFlowPosition()` è½¬æ¢åæ ‡
  - **é—®é¢˜**: ä¹‹å‰ä½¿ç”¨ `project()`ï¼ˆå·²åºŸå¼ƒï¼‰æˆ– viewport åæ ‡ï¼ŒèŠ‚ç‚¹ä½ç½®ä¸æ­£ç¡®
  - **è§£å†³**: ä½¿ç”¨æ­£ç¡®çš„åæ ‡è½¬æ¢ API
- **å½±å“æ–‡ä»¶**:
  - `src/client/src/App.jsx` (èŠ‚ç‚¹ç®¡ç†é€»è¾‘)
  - `src/client/src/main.jsx` (æ·»åŠ  ReactFlowProvider)

#### 20. è§’è‰²ç»“æœèŠ‚ç‚¹ (2025-12-30) â­ æ–°å¢
- **åŠŸèƒ½æè¿°**:
  - æ˜¾ç¤ºè§’è‰²åˆ›å»ºä»»åŠ¡çš„è¯¦ç»†ç»“æœ
  - é€šè¿‡äº‹ä»¶ç³»ç»Ÿä» CharacterCreateNode æ¥æ”¶è§’è‰²æ•°æ®
  - æä¾›å¤åˆ¶åˆ°å‰ªè´´æ¿åŠŸèƒ½ï¼ˆè§’è‰² IDã€ç”¨æˆ·åï¼‰
- **æ•°æ®æ ¼å¼**:
  ```javascript
  {
    id: "ch_69536e7ce60481919c4e9a2a3cf4c6d5",
    username: "de3602969.sunnykitty",
    permalink: "https://sora.chatgpt.com/profile/...",
    profile_picture_url: "https://...",
    alias: "å¯é€‰åˆ«å"
  }
  ```
- **äº‹ä»¶ç³»ç»Ÿ**:
  - äº‹ä»¶å: `character-created`
  - äº‹ä»¶æ•°æ®: `{ sourceNodeId, character }`
  - éªŒè¯é€»è¾‘: æ£€æŸ¥ `data.connectedSourceId === event.detail.sourceNodeId`
- **æŠ€æœ¯å®ç°**:
  - è¾“å…¥ç«¯å£: `character-input` (å·¦ä¾§)
  - æ— è¾“å‡ºç«¯å£ï¼ˆçº¯å±•ç¤ºèŠ‚ç‚¹ï¼‰
  - å‰ªè´´æ¿ API: ä¼˜å…ˆ `navigator.clipboard`ï¼Œé™çº§ `execCommand`
  - å¤åˆ¶åé¦ˆ: æ˜¾ç¤º "âœ“ å·²å¤åˆ¶" 2 ç§’
- **å½±å“æ–‡ä»¶**:
  - `src/client/src/nodes/output/CharacterResultNode.jsx` (æ–°å¢)
  - `src/client/src/nodes/process/CharacterCreateNode.jsx` (æ·»åŠ äº‹ä»¶æ´¾å‘)

#### 21. ç¼–è¯‘é”™è¯¯ä¿®å¤ (2025-12-30) â­ Bug ä¿®å¤
- **é—®é¢˜**: Babel ç¼–è¯‘é”™è¯¯ - "Identifier 'characterEdge' has already been declared"
- **åŸå› **: App.jsx ä¸­åŒä¸€ä½œç”¨åŸŸå†…é‡å¤å£°æ˜ `characterEdge` å˜é‡
- **è§£å†³**: åˆå¹¶ç›¸å…³é€»è¾‘ï¼Œåªå£°æ˜ä¸€æ¬¡å˜é‡ï¼Œä½¿ç”¨æ¡ä»¶åˆ†æ”¯å¤„ç†ä¸åŒåœºæ™¯
- **å½±å“æ–‡ä»¶**: `src/client/src/App.jsx` (ç¬¬ 207-221 è¡Œ)

#### 22. è§’è‰²åº“ç®¡ç†åŠŸèƒ½ (2025-12-30) â­ æ–°å¢
- **åŠŸèƒ½ç‚¹1: å•ä¸ªè§’è‰²åˆ é™¤**
  - æ‚¬åœæ˜¾ç¤ºåˆ é™¤æŒ‰é’®ï¼ˆâœ•ï¼‰åœ¨è§’è‰²å¡ç‰‡å³ä¸Šè§’
  - ç‚¹å‡»åˆ é™¤æŒ‰é’®å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†
  - æ˜¾ç¤º "âš ï¸ ç¡®è®¤åˆ é™¤" å’Œ "æ­¤æ“ä½œä¸å¯æ¢å¤!" è­¦å‘Š
  - åˆ é™¤æˆåŠŸåé‡æ–°åŠ è½½è§’è‰²åˆ—è¡¨
- **åŠŸèƒ½ç‚¹2: ç¼–è¾‘è§’è‰²åˆ«å**
  - ç‚¹å‡»è§’è‰²å¡ç‰‡æ‰“å¼€ç¼–è¾‘å¯¹è¯æ¡†
  - æ˜¾ç¤ºç”¨æˆ·åã€è§’è‰² ID å’Œå½“å‰åˆ«å
  - è¾“å…¥æ–°åˆ«åï¼ˆæœ€å¤š 50 å­—ç¬¦ï¼‰
  - ä¿å­˜/å–æ¶ˆæŒ‰é’®ï¼ŒæˆåŠŸåæ˜¾ç¤º "âœ… åˆ«åå·²æ›´æ–°"
- **åŠŸèƒ½ç‚¹3: æ‰¹é‡é€‰æ‹©æ¨¡å¼**
  - "æ‰¹é‡æ“ä½œ" æŒ‰é’®åˆ‡æ¢æ‰¹é‡æ¨¡å¼
  - ç‚¹å‡»è§’è‰²å¡ç‰‡è¿›è¡Œé€‰æ‹©/å–æ¶ˆé€‰æ‹©
  - é»„è‰²è¾¹æ¡†å’ŒèƒŒæ™¯è¡¨ç¤ºé€‰ä¸­çŠ¶æ€
  - å¤é€‰æ¡†æ˜¾ç¤ºé€‰ä¸­æ ‡è®°ï¼ˆâœ“ï¼‰
- **åŠŸèƒ½ç‚¹4: æ‰¹é‡åˆ é™¤åŠŸèƒ½**
  - "å…¨é€‰" / "å–æ¶ˆå…¨é€‰" æŒ‰é’®
  - "åˆ é™¤ (N)" æŒ‰é’®æ˜¾ç¤ºå·²é€‰æ•°é‡
  - ç¡®è®¤å¯¹è¯æ¡†æ˜¾ç¤ºåˆ é™¤æ•°é‡
  - å¹¶å‘è°ƒç”¨åˆ é™¤ APIï¼ˆPromise.allï¼‰
- **æŠ€æœ¯å®ç°**:
  - 7 ä¸ªæ–°çŠ¶æ€å˜é‡ï¼ˆbatchMode, selectedCharacters, editingCharacter ç­‰ï¼‰
  - 4 ä¸ªæ–°å¼‚æ­¥å‡½æ•°ï¼ˆdeleteCharacter, updateAlias, deleteBatchCharacters ç­‰ï¼‰
  - 2 ä¸ªæ¨¡æ€å¯¹è¯æ¡†ï¼ˆç¼–è¾‘åˆ«åã€åˆ é™¤ç¡®è®¤ï¼‰
  - UI è§†è§‰åé¦ˆï¼ˆé€‰ä¸­çŠ¶æ€ã€æŒ‰é’®çŠ¶æ€ï¼‰
- **API é›†æˆ**:
  - `DELETE /api/character/:characterId` - åˆ é™¤å•ä¸ªè§’è‰²
  - `PUT /api/character/:characterId/alias` - æ›´æ–°åˆ«å
- **æµ‹è¯•ç»“æœ**:
  - âœ… ç¼–è¾‘åˆ«å: æˆåŠŸæ›´æ–° "5562be00d.sunbeamkit" â†’ "é˜³å…‰å°çŒ«"
  - âœ… æ‰¹é‡é€‰æ‹©: å…¨é€‰/å–æ¶ˆå…¨é€‰/å•ä¸ªé€‰æ‹©æ­£å¸¸å·¥ä½œ
  - âœ… å•ä¸ªåˆ é™¤: ç¡®è®¤å¯¹è¯æ¡†å’Œåˆ é™¤åŠŸèƒ½æ­£å¸¸
  - âœ… æ‰¹é‡åˆ é™¤: å¹¶å‘åˆ é™¤å¤šä¸ªè§’è‰²æˆåŠŸ
- **å½±å“æ–‡ä»¶**:
  - `src/client/src/nodes/input/CharacterLibraryNode.jsx` (419 è¡Œæ–°å¢ä»£ç )

---

### å¾…å¼€å‘åŠŸèƒ½

æš‚æ— å¾…å¼€å‘åŠŸèƒ½

---

## æ³¨æ„äº‹é¡¹

### âš ï¸ ç¦æ­¢äº‹é¡¹

1. **ç¦æ­¢ä½¿ç”¨ child_process è°ƒç”¨ API**
   ```javascript
   // âŒ é”™è¯¯ï¼šä¼šå¯¼è‡´è¿›ç¨‹åƒµæ­»
   const { spawn } = require('child_process');
   spawn('curl', ['https://api...']);

   // âœ… æ­£ç¡®ï¼šä½¿ç”¨ axios
   const axios = require('axios');
   await axios.post('https://api...', data);
   ```

2. **ç¦æ­¢ç¡¬ç¼–ç  API Key**
   ```javascript
   // âŒ é”™è¯¯
   const apiKey = 'sk-1234567890';

   // âœ… æ­£ç¡®
   const apiKey = process.env.SORA2_API_KEY;
   ```

3. **ç¦æ­¢åˆ›å»ºè§’è‰²æ—¶ä¼ é€’ model å‚æ•°**
   ```javascript
   // âŒ é”™è¯¯ï¼šä¼šå¯¼è‡´ 404 é”™è¯¯
   await axios.post('/sora/v1/characters', {
     model: 'sora-2',  // âŒ åˆ é™¤æ­¤è¡Œ
     url: videoUrl,
     timestamps: '1,3'
   });

   // âœ… æ­£ç¡®
   await axios.post('/sora/v1/characters', {
     from_task: taskId,
     timestamps: '1,3'
   });
   ```

4. **ç¦æ­¢ä½¿ç”¨é”™è¯¯çš„æŸ¥è¯¢ç«¯ç‚¹**
   ```javascript
   // âŒ é”™è¯¯ï¼šå¯¹èšé‘«ä½¿ç”¨è´è´çš„ç«¯ç‚¹
   await axios.get(`https://api.jxincm.cn/v2/videos/generations/${taskId}`);

   // âœ… æ­£ç¡®ï¼šèšé‘«ä½¿ç”¨æŸ¥è¯¢å‚æ•°
   await axios.get('https://api.jxincm.cn/v1/video/query', {
     params: { id: taskId }
   });
   ```

5. **ç¦æ­¢å‡è®¾ä»»åŠ¡IDå­—æ®µåç§°** â­ æ–°å¢
   ```javascript
   // âŒ é”™è¯¯ï¼šåªæ£€æŸ¥ id å­—æ®µ
   if (result.success && result.data?.id) {
     // è´è´å¹³å°çš„è§†é¢‘ä¸ä¼šè¢«ä¿å­˜
   }

   // âœ… æ­£ç¡®ï¼šå…¼å®¹åŒå¹³å°
   const taskId = result.data.id || result.data.task_id;
   if (taskId) {
     historyStorage.addRecord({ taskId, platform, prompt, model, options });
   }
   ```

6. **ç¦æ­¢ä½¿ç”¨é”™è¯¯çš„è§’è‰²å¼•ç”¨æ ¼å¼** â­ æ–°å¢
   ```javascript
   // âŒ é”™è¯¯ï¼šä½¿ç”¨èŠ±æ‹¬å·
   const prompt = '@{username} åœ¨å·¥åœ°ä¸Šå¹²æ´»';

   // âœ… æ­£ç¡®ï¼šä¸ä½¿ç”¨èŠ±æ‹¬å·
   const prompt = '@username åœ¨å·¥åœ°ä¸Šå¹²æ´»';
   ```

### âœ… æ¨èåšæ³•

1. **è§’è‰²åˆ›å»ºä¼˜å…ˆä½¿ç”¨ from_task**
   - æ›´å¯é ï¼Œé¿å…è§†é¢‘ URL è®¿é—®é—®é¢˜
   - ä»å·²å®Œæˆçš„è§†é¢‘ä»»åŠ¡åˆ›å»º

2. **è½®è¯¢é—´éš”è¦åˆç†**
   - Sora2 è§†é¢‘ç”Ÿæˆéœ€è¦ 3-5 åˆ†é’Ÿ
   - æ¨èè½®è¯¢é—´éš”ï¼š30 ç§’ï¼ˆå·²å®ç°ï¼‰
   - è¿‡çŸ­ä¼šå¯¼è‡´ 429 Rate Limit é”™è¯¯

3. **ä½¿ç”¨ç»Ÿä¸€çš„å“åº”æ ¼å¼**
   - æ‰€æœ‰ API è¿”å› `{success, data/error}`
   - ä¾¿äºå‰ç«¯å¤„ç†

4. **è‡ªåŠ¨ä¿å­˜åˆ°å­˜å‚¨**
   - è§†é¢‘åˆ›å»ºæˆåŠŸ â†’ è‡ªåŠ¨ä¿å­˜åˆ°å†å²è®°å½•
   - è§’è‰²åˆ›å»ºæˆåŠŸ â†’ è‡ªåŠ¨ä¿å­˜åˆ°è§’è‰²åº“
   - ä»»åŠ¡å®Œæˆ â†’ åå°è½®è¯¢è‡ªåŠ¨æ›´æ–°çŠ¶æ€

5. **åŒå¹³å°å…¼å®¹å¤„ç†** â­ æ–°å¢
   - å§‹ç»ˆä½¿ç”¨ `result.data.id || result.data.task_id` è·å–ä»»åŠ¡ID
   - æ ¹æ®å¹³å°é€‰æ‹©æ­£ç¡®çš„æŸ¥è¯¢ç«¯ç‚¹

6. **å‚è€ƒå›¾ç‰‡åŠŸèƒ½** â­ æ–°å¢
   - **å…ˆåˆ†æå›¾ç‰‡å†å†™æç¤ºè¯**: ä½¿ç”¨å›¾ç‰‡åˆ†æå·¥å…·ç†è§£å†…å®¹ï¼Œç„¶åå†™å‡ºç›¸å…³æ€§å¼ºçš„æç¤ºè¯
   - **æç¤ºè¯ç»“æ„**: åŒ…å«ä¸»ä½“ã€å¤–è§‚ã€åŠ¨ä½œã€ç¯å¢ƒã€æ°›å›´äº”ä¸ªè¦ç´ 
   - **æ•…äº‹æ¿å›¾ç‰‡æ”¶é›†**: åç«¯è‡ªåŠ¨æ”¶é›†æ‰€æœ‰é•œå¤´çš„ `shot.image` å¹¶åˆå¹¶åˆ° `images` æ•°ç»„
   - **è§’è‰²ä¸å›¾ç‰‡æ··åˆ**: å‚è€ƒå›¾ç‰‡ä½œä¸ºåœºæ™¯ï¼Œè§’è‰²åœ¨åœºæ™¯ä¸­æ´»åŠ¨
   - **è‡ªåŠ¨æ£€æµ‹æ¨¡å¼**: æœ‰å›¾ç‰‡è‡ªåŠ¨ä½¿ç”¨å›¾ç”Ÿè§†é¢‘ï¼Œæ— å›¾ç‰‡ä½¿ç”¨æ–‡ç”Ÿè§†é¢‘

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: è´è´å¹³å°è§†é¢‘æœªä¿å­˜åˆ°å†å² â­ æ–°å¢

**ç°è±¡**: ä½¿ç”¨è´è´å¹³å°åˆ›å»ºè§†é¢‘åï¼Œå†å²è®°å½•ä¸­æ‰¾ä¸åˆ°

**åŸå› **: è´è´è¿”å› `{task_id}`, èšé‘«è¿”å› `{id}`ï¼Œä»£ç åªæ£€æŸ¥äº† `id`

**è§£å†³æ–¹æ¡ˆ**:
```javascript
// âœ… å…¼å®¹åŒå¹³å°
const taskId = result.data.id || result.data.task_id;
if (taskId) {
  historyStorage.addRecord({ taskId, platform, prompt, model, options });
}
```

### é—®é¢˜ 2: è§’è‰²åˆ›å»ºè¿”å› 500 é”™è¯¯

**ç°è±¡**: ä½¿ç”¨è§†é¢‘ URL åˆ›å»ºè§’è‰²å¤±è´¥ï¼Œè¿”å› "Request failed with status code 500"

**åŸå› **: è§†é¢‘æ— æ³•è®¿é—®ï¼ˆé˜²ç›—é“¾/è¿‡æœŸ/éœ€è¦ç‰¹æ®Š headersï¼‰

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨ `from_task` å‚æ•°
```javascript
// å…ˆåˆ›å»ºè§†é¢‘ä»»åŠ¡
const videoResult = await client.createVideo({...});
const taskId = videoResult.data.id || videoResult.data.task_id;

// ç­‰å¾…ä»»åŠ¡å®Œæˆ
const completed = await client.waitForTask(taskId);

// ä»å·²å®Œæˆçš„ä»»åŠ¡åˆ›å»ºè§’è‰²
const character = await client.createCharacter({
  from_task: taskId,
  timestamps: '1,3'
});
```

### é—®é¢˜ 3: æŸ¥è¯¢ä»»åŠ¡è¿”å› HTML

**ç°è±¡**: æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€è¿”å› HTML è€Œä¸æ˜¯ JSON

**åŸå› **: ä½¿ç”¨äº†é”™è¯¯çš„æŸ¥è¯¢ç«¯ç‚¹

**è§£å†³æ–¹æ¡ˆ**:
```javascript
// èšé‘«å¹³å°
GET /v1/video/query?id={taskId}

// è´è´å¹³å°
GET /v2/videos/generations/{taskId}
```

### é—®é¢˜ 4: é¢‘ç¹å‡ºç° 429 é”™è¯¯

**ç°è±¡**: è½®è¯¢ä»»åŠ¡çŠ¶æ€æ—¶é¢‘ç¹è¿”å› 429 Rate Limit

**åŸå› **: è½®è¯¢é—´éš”å¤ªçŸ­

**è§£å†³æ–¹æ¡ˆ**: å°†è½®è¯¢é—´éš”å¢åŠ åˆ° 30 ç§’
```javascript
const POLL_INTERVAL = 30000;  // 30ç§’
const TIMEOUT = 600000;       // 10åˆ†é’Ÿ
```

### é—®é¢˜ 5: å‰ç«¯ä¸€ç›´æ˜¾ç¤º "Creating..."

**ç°è±¡**: åˆ›å»ºè§†é¢‘åå‰ç«¯ä¸€ç›´æ˜¾ç¤ºåŠ è½½ä¸­

**åŸå› **: åç«¯ä½¿ç”¨äº† `spawn` å¯¼è‡´é˜»å¡

**è§£å†³æ–¹æ¡ˆ**: æ”¹ç”¨ `await fetch()` æˆ– `await axios()`

### é—®é¢˜ 6: Claude Code ä¸è¯»å–è§„åˆ™æ–‡ä»¶

**ç°è±¡**: Claude Code æ²¡æœ‰åŠ è½½ `.claude/rules/` ä¸­çš„è§„åˆ™

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®ä¿ Claude Code åœ¨é¡¹ç›®æ ¹ç›®å½•å¯åŠ¨
2. æ£€æŸ¥ `settings.json` æ ¼å¼æ˜¯å¦æ­£ç¡®
3. å°è¯•é‡å¯ Claude Code

### é—®é¢˜ 7: è§’è‰²å¼•ç”¨ä¸ç”Ÿæ•ˆ â­ æ–°å¢

**ç°è±¡**: ä½¿ç”¨è§’è‰²å¼•ç”¨åè§†é¢‘æ²¡æœ‰ä½¿ç”¨è¯¥è§’è‰²

**åŸå› **: ä½¿ç”¨äº†é”™è¯¯çš„æ ¼å¼ `@{username}`

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨æ­£ç¡®æ ¼å¼ `@username`ï¼ˆä¸å¸¦èŠ±æ‹¬å·ï¼‰
```javascript
// âœ… æ­£ç¡®
const prompt = '@6f2dbf2b3.zenwhisper åœ¨å·¥åœ°ä¸Šå¹²æ´»';

// âŒ é”™è¯¯
const prompt = '@{6f2dbf2b3.zenwhisper} åœ¨å·¥åœ°ä¸Šå¹²æ´»';
```

### é—®é¢˜ 8: å¤‡ä»½å¯¼å…¥å¤±è´¥ "æ— æ•ˆçš„å¤‡ä»½æ–‡ä»¶æ ¼å¼" â­ æ–°å¢

**ç°è±¡**: å¯¼å…¥ä¹‹å‰å¯¼å‡ºçš„å¤‡ä»½æ–‡ä»¶æ—¶ï¼Œæç¤º"æ— æ•ˆçš„å¤‡ä»½æ–‡ä»¶æ ¼å¼"

**åŸå› **: å¯¼å‡ºçš„å¤‡ä»½æ–‡ä»¶åŒ…å« API å“åº”åŒ…è£… `{success: true, data: {...}}`ï¼Œä½†å¯¼å…¥éªŒè¯æœŸæœ›çº¯å¤‡ä»½æ ¼å¼

**è§£å†³æ–¹æ¡ˆ**: å¯¼å…¥åŠŸèƒ½å·²æ”¯æŒåŒæ ¼å¼å…¼å®¹
```javascript
// å¤„ç†ä¸¤ç§æ ¼å¼ï¼š
// 1. å¯¼å‡ºæ—¶çš„æ ¼å¼ï¼š{success: true, data: {version: ..., data: {...}}}
// 2. çº¯å¤‡ä»½æ ¼å¼ï¼š{version: ..., data: {...}}

let backupData = JSON.parse(fileContent);

// è‡ªåŠ¨æå–å®é™…æ•°æ®
if (backupData.success && backupData.data) {
  backupData = backupData.data;
}
```

**å¤‡ä»½æ–‡ä»¶æ ¼å¼**:
```json
{
  "success": true,
  "data": {
    "version": "1.0",
    "timestamp": "2025-12-29T13:05:30.148Z",
    "data": {
      "history": [...],
      "characters": [...]
    }
  }
}
```

### é—®é¢˜ 9: ç”Ÿæˆçš„è§†é¢‘ä¸å‚è€ƒå›¾ç‰‡ä¸ç¬¦ â­ æ–°å¢

**ç°è±¡**: ä½¿ç”¨å‚è€ƒå›¾ç‰‡ç”Ÿæˆçš„è§†é¢‘å†…å®¹ä¸å›¾ç‰‡ä¸åŒ¹é…

**åŸå› **: æç¤ºè¯æœªæè¿°å›¾ç‰‡å†…å®¹ï¼Œä½¿ç”¨äº†é€šç”¨æç¤ºè¯

**è§£å†³æ–¹æ¡ˆ**: å…ˆåˆ†æå›¾ç‰‡å†…å®¹ï¼Œå†å†™ç›¸å…³æ€§å¼ºçš„æç¤ºè¯
```javascript
// âŒ é”™è¯¯ï¼šä½¿ç”¨é€šç”¨æç¤ºè¯
const prompt = 'ä¸€ä¸ªå¯çˆ±çš„çŒ«å’ªåœ¨èŠ±å›­é‡Œç©è€ï¼Œé˜³å…‰æ˜åªš';
// é—®é¢˜ï¼šå›¾ç‰‡æ˜¯å¡é€šåƒåœ¾è½¦ï¼Œä½†æç¤ºè¯æè¿°çš„æ˜¯çŒ«å’ª

// âœ… æ­£ç¡®ï¼šå…ˆåˆ†æå›¾ç‰‡ï¼Œå†å†™ç›¸å…³æç¤ºè¯
// ä½¿ç”¨å›¾ç‰‡åˆ†æå·¥å…·è¯†åˆ«ï¼šé»„è‰²è½¦å¤´ã€ç»¿è‰²è½¦èº«ã€å¯çˆ±è¡¨æƒ…ã€åŸå¸‚è¡—é“ã€å¡é€šé£æ ¼
const prompt = 'ä¸€è¾†å¡é€šé£æ ¼çš„åƒåœ¾è½¦åœ¨åŸå¸‚è¡—é“ä¸Šè¡Œé©¶ï¼Œé»„è‰²è½¦å¤´ã€ç»¿è‰²è½¦èº«ï¼Œ' +
               'è½¦å¤´æœ‰å¯çˆ±çš„è¡¨æƒ…ï¼ˆå¤§çœ¼ç›ã€å¾®ç¬‘ã€è…®çº¢ï¼‰ï¼Œè½¦æ–—é€šè¿‡æœºæ¢°è‡‚æŠ¬èµ·æ­£åœ¨ä½œä¸šï¼Œ' +
               'æ™´æœ—å¤©æ°”ï¼Œå¡é€šæ’ç”»é£æ ¼';
```

**æç¤ºè¯ç»“æ„å»ºè®®**:
1. **ä¸»ä½“**: ç”»é¢ä¸­çš„ä¸»è¦è§’è‰²/ç‰©ä½“
2. **å¤–è§‚**: é¢œè‰²ã€å½¢çŠ¶ã€è¡¨æƒ…ã€å§¿æ€
3. **åŠ¨ä½œ**: æ­£åœ¨åšä»€ä¹ˆ
4. **ç¯å¢ƒ**: èƒŒæ™¯åœºæ™¯ã€å‘¨å›´ç‰©ä½“
5. **æ°›å›´**: å…‰çº¿ã€è‰²è°ƒã€é£æ ¼

### é—®é¢˜ 10: æ•…äº‹æ¿é•œå¤´å›¾ç‰‡ä¸¢å¤± â­ æ–°å¢

**ç°è±¡**: æ•…äº‹æ¿æ¨¡å¼ä¸­é…ç½®çš„é•œå¤´å›¾ç‰‡æœªç”Ÿæ•ˆ

**åŸå› **:
- å‰ç«¯æœªæ”¶é›† `shot.image` å­—æ®µ
- åç«¯æœªå°†é•œå¤´å›¾ç‰‡åˆå¹¶åˆ° `images` æ•°ç»„

**è§£å†³æ–¹æ¡ˆ**:
```javascript
// å‰ç«¯ï¼šæ­£ç¡®æ”¶é›†é•œå¤´å›¾ç‰‡
const shots = [];
document.querySelectorAll('.shot-item').forEach(item => {
  const duration = item.querySelector('.shot-duration').value;
  const scene = item.querySelector('.shot-scene').value.trim();
  const image = item.querySelector('.shot-image').value.trim();

  if (scene) {
    const shotData = {
      duration: parseFloat(duration),
      scene: scene
    };
    // å¦‚æœæœ‰å‚è€ƒå›¾ç‰‡ï¼Œæ·»åŠ åˆ°é•œå¤´æ•°æ®ä¸­
    if (image) {
      shotData.image = image;
    }
    shots.push(shotData);
  }
});

// åç«¯ï¼šæ”¶é›†æ‰€æœ‰é•œå¤´çš„å›¾ç‰‡
async createStoryboardVideo(options) {
  const { shots, images = [] } = options;

  // æ”¶é›†æ‰€æœ‰é•œå¤´çš„å‚è€ƒå›¾ç‰‡
  const allImages = [...images];
  shots.forEach((shot) => {
    if (shot.image) {
      allImages.push(shot.image);
    }
  });

  // ä½¿ç”¨åˆå¹¶åçš„å›¾ç‰‡æ•°ç»„
  const body = {
    model,
    prompt,
    images: allImages,  // åŒ…å«æ‰€æœ‰é•œå¤´çš„å›¾ç‰‡
    watermark,
    private: isPrivate,
  };
}
```

---

## å¿«é€Ÿå‚è€ƒ

### ç¯å¢ƒå˜é‡é€ŸæŸ¥

```bash
SORA2_API_KEY=sk-xxxxx      # èšé‘«å¹³å° API Key
ZHENZHEN_API_KEY=sk-xxxxx   # è´è´å¹³å° API Key
PORT=9000                    # æœåŠ¡å™¨ç«¯å£
```

### å…³é”®ç«¯å£

- HTTP æœåŠ¡å™¨: `http://localhost:9000`
- å¥åº·æ£€æŸ¥: `http://localhost:9000/health`

### æ•°æ®æ–‡ä»¶ä½ç½®

- å†å²è®°å½•: `data/history.json`
- è§’è‰²åº“: `data/characters.json`
- è§†é¢‘ä¸‹è½½: `downloads/`

### å‚è€ƒæ–‡æ¡£

- å¼€å‘ç»éªŒ: `reference/ç”¨æˆ·è¾“å…¥æ–‡ä»¶å¤¹/å¼€å‘ç»éªŒ/Sora2_Character_Best_Practices.md`
- èšé‘« API: `reference/ç”¨æˆ·è¾“å…¥æ–‡ä»¶å¤¹/èšé‘«sora2/`
- è´è´ API: `reference/ç”¨æˆ·è¾“å…¥æ–‡ä»¶å¤¹/è´è´å·¥åŠ/`

### è§’è‰²å¼•ç”¨è¯­æ³•é€ŸæŸ¥ â­ æ–°å¢

```
@username æç¤ºè¯å†…å®¹

ç¤ºä¾‹ï¼š
@6f2dbf2b3.zenwhisper åœ¨å·¥åœ°ä¸Šå¹²æ´»
@783316a1d.diggyloade åœ¨å·¥åœ°ä¸Šå¹²æ´»
```

**æ³¨æ„**:
- æ‰€æœ‰å¹³å°ç»Ÿä¸€æ ¼å¼
- ä¸ä½¿ç”¨èŠ±æ‹¬å·
- è§’è‰²å¼•ç”¨å’Œæç¤ºè¯ä¹‹é—´ç”¨ç©ºæ ¼éš”å¼€

### åŒå¹³å°å·®å¼‚é€ŸæŸ¥ â­ æ–°å¢

| é¡¹ç›® | èšé‘«å¹³å° | è´è´å¹³å° |
|------|----------|----------|
| æŸ¥è¯¢ç«¯ç‚¹ | `/v1/video/query?id={taskId}` | `/v2/videos/generations/{taskId}` |
| å“åº”æ ¼å¼ | `{ id: "video_xxx" }` | `{ task_id: "video_xxx" }` |
| å…¼å®¹å¤„ç† | `result.data.id \|\| result.data.task_id` | åŒå·¦ |

---

## è”ç³»æ–¹å¼

- é¡¹ç›®ä»“åº“: https://github.com/leon30083/wenjing-aigc.git
- é—®é¢˜åé¦ˆ: GitHub Issues

---

**æœ€åæ›´æ–°**: 2025-12-30
**ç»´æŠ¤è€…**: WinJin AIGC Team
**ç‰ˆæœ¬**: v2.2
