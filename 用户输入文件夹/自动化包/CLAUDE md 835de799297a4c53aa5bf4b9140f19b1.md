# CLAUDE.md

# Wenjing AIGC 项目规范

## 项目概述

这是一个AI内容生成与提示词优化平台，专注于提升AI交互体验和内容质量。

## 技术栈

- **前端**: Next.js 14 / React 18 / TypeScript
- **后端**: Node.js / Express
- **AI集成**: OpenAI API / Claude API
- **数据库**: PostgreSQL / Prisma ORM
- **包管理**: bun（优先）/ npm

## 构建命令

```bash
# 开发环境
bun install
bun dev

# 生产构建
bun run build
bun start

# 测试
bun test
```

## 代码规范

### 命名约定

- 组件：PascalCase（例：`PromptOptimizer.tsx`）
- 工具函数：camelCase（例：`validatePrompt.ts`）
- 常量：UPPER_SNAKE_CASE（例：`MAX_TOKEN_LENGTH`）
- CSS模块：kebab-case（例：`prompt-card.module.css`）

### 目录结构

```
src/
├── app/              # Next.js App Router页面
├── components/       # React组件
│   ├── ui/          # 通用UI组件
│   └── features/    # 功能组件
├── lib/             # 工具函数和配置
├── hooks/           # 自定义React Hooks
├── types/           # TypeScript类型定义
└── styles/          # 全局样式
```

## 开发原则

1. **类型安全优先**：所有API响应必须有TypeScript类型定义
2. **组件化思维**：UI组件保持单一职责，可复用
3. **性能优化**：使用React.memo、useMemo、useCallback避免不必要的重渲染
4. **错误处理**：所有异步操作必须包含try-catch和用户友好的错误提示
5. **提示词版本控制**：每次提示词优化需记录版本号和变更说明

## AI API集成规范

### 调用流程

1. 输入验证（长度、格式、敏感词）
2. Token预估（避免超限）
3. API调用（带超时和重试）
4. 响应解析和错误处理
5. 结果缓存（相同输入避免重复调用）

### 错误处理

```tsx
try {
  const response = await callAI(prompt);
  return response;
} catch (error) {
  if (error.code === 'rate_limit') {
    // 速率限制处理
  } else if (error.code === 'context_length_exceeded') {
    // 上下文超长处理
  }
  throw new AppError('AI调用失败', error);
}
```

## 部署流程

1. 运行完整测试套件：`bun test`
2. 类型检查：`bun run type-check`
3. Lint检查：`bun run lint`
4. 构建：`bun run build`
5. 预览：`bun start`
6. 提交到main分支触发自动部署

## 常见问题

### Q: Token超限怎么办？

A: 启用Plan Mode（Shift+Tab×2）分析后再优化提示词长度

### Q: API响应慢？

A: 检查是否启用了缓存，考虑使用流式响应

### Q: 如何测试提示词效果？

A: 使用 `/prompt-test` 命令自动化测试多个版本