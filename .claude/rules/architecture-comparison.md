# WinJin 文档架构分析 - CLAUDE.md 与规则体系的关系

## 📊 三层文档架构

```
┌─────────────────────────────────────────────────────────┐
│                     第一层：项目入口                      │
│                     CLAUDE.md (根目录)                   │
│                      78 行，简洁                        │
└─────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────┐
│              第二层：通用规则和流程                      │
│              .claude/rules/ (详细规范)                  │
│          quick-reference.md (479行) ⭐ 开发前必读       │
│          base.md (1,193行) - 技术栈约束                 │
│          code.md (544行) - 代码规范                     │
│          error-patterns.md (~2,500行) - 错误模式 ⭐      │
│          docs.md (451行) - 文档更新规范                 │
└─────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────┐
│              第三层：项目特定技能                         │
│         .claude/skills/winjin-dev/ (项目专属)            │
│          SKILL.md (336行) - 开发规范和提示              │
│          references/UPDATE.md - 更新流程                │
└─────────────────────────────────────────────────────────┘
```

---

## 🎯 CLAUDE.md 的定位

### **角色：项目根目录的"门面"文件**

| 特性 | 说明 |
|------|------|
| **位置** | 项目根目录（`D:\user\github\winjin\CLAUDE.md`） |
| **长度** | 78 行（非常简洁） |
| **目的** | 快速了解项目基本规范 |
| **读者** | 任何人（包括 AI、开发者、新成员） |

### **内容结构**

```markdown
# WinJin AIGC 项目开发规范

├── 项目概述（核心功能）
├── 时间获取（命令规范）
├── 技术文档（官方文档链接）
├── 开发规范
│   ├── 代码风格
│   ├── API 设计
│   ├── Sora2 API 注意事项
│   └── 参考文档位置
├── 命令规范（npm 命令）
└── 安全规范（安全注意事项）
```

---

## 📋 三层对比表

### **1. CLAUDE.md（第一层）**

| 维度 | 特点 | 示例内容 |
|------|------|----------|
| **粒度** | 项目级，高层概述 | "WinJin AIGC 开源重构版本" |
| **深度** | 浅层，快速参考 | "缩进: 2 空格；引号: 单引号" |
| **范围** | 基础规范 | 代码风格、API 设计、安全规范 |
| **更新频率** | 低（项目初始化后基本不变） | 很少修改 |
| **目标读者** | 所有人 | AI、开发者、新成员 |

**适用场景**：
- ✅ 快速了解项目基本规范
- ✅ 首次接触项目的开发者
- ✅ AI 首次访问项目时的入门指引
- ✅ 作为 README 的补充

---

### **2. .claude/rules/（第二层）**

| 维度 | 特点 | 说明 |
|------|------|------|
| **粒度** | 领域级，详细规范 | 每个文件专注一个领域 |
| **深度** | 深层，完整细节 | 包含代码示例、错误分析 |
| **范围** | 全面覆盖 | 开发流程、技术栈、错误模式 |
| **更新频率** | 中等（功能/架构变更时更新） | 定期更新 |
| **目标读者** | 开发者、AI（主要） | **AI 开发助手的核心输入** |

**文件分工**：

| 文件 | 行数 | 作用 | 与 CLAUDE.md 的关系 |
|------|------|------|---------------------|
| **quick-reference.md** | 479行 | 开发流程、启动命令、常见问题 | **扩展** "命令规范" 章节 |
| **base.md** | 1,193行 | 技术栈、API规范、平台差异 | **扩展** "开发规范" 章节 |
| **code.md** | 544行 | 代码规范、最佳实践 | **扩展** "代码风格" 章节 |
| **error-patterns.md** | ~2,500行 | 错误模式（48个，7种类型） | **新增**，CLAUDE.md 未涉及 ⭐ |
| **docs.md** | 451行 | 文档更新规范 | **新增**，CLAUDE.md 未涉及 |

**与 CLAUDE.md 的关系**：
- **扩展关系**：CLAUDE.md 提供概览，rules/ 提供细节
- **举例说明**：
  ```
  CLAUDE.md: "缩进: 2 空格"
  code.md:   "详细代码示例、API 路由规范、错误处理模式"

  CLAUDE.md: "使用 async/await"
  code.md:   "完整的异步错误处理示例、常见错误模式"
  ```

---

### **3. .claude/skills/winjin-dev/（第三层）**

| 维度 | 特点 | 说明 |
|------|------|------|
| **粒度** | 项目级，实战经验 | WinJin 项目特定的规范和经验 |
| **深度** | 最深层，项目专属 | 48个错误模式、34个开发提示 |
| **范围** | 项目特定 | Sora2 API、React Flow、角色系统 |
| **更新频率** | 高（每次开发后必须更新） | 持续迭代 |
| **目标读者** | AI（主要）、开发者 | **AI 开发助手的核心知识库** |

**文件内容**：

| 文件 | 行数 | 作用 | 与 rules/ 的关系 |
|------|------|------|-----------------|
| **SKILL.md** | 336行 | 项目特定开发规范、开发提示 | **引用** rules/ 的规范 + **添加**项目经验 |
| **references/UPDATE.md** | 250行 | 文档更新流程 | **扩展** docs.md 的更新流程 |

**与 rules/ 的关系**：
- **引用 + 添加**：SKILL.md 引用 rules/ 的规范，并添加项目特定经验
- **举例说明**：
  ```
  rules/base.md:     "技术栈约束（通用）"
  SKILL.md:          "Sora2 API 特定注意事项" + "双平台差异处理"

  rules/code.md:     "代码规范（通用）"
  SKILL.md:          "React Flow 节点开发规范" + "角色引用最佳实践"

  rules/error-patterns.md: "错误模式（按类型分类）"
  SKILL.md:              "高频错误链接" + "开发提示（精选34条）"
  ```

---

## 🔄 三层协作流程

### **AI 开发时如何使用这些文档？**

```
用户提出需求
    ↓
┌─────────────────────────────────────┐
│ 1. AI 读取 CLAUDE.md（快速了解）    │
│    - 项目概述                        │
│    - 基本规范                        │
│    - 命令规范                        │
└─────────────────┬───────────────────┘
                  ↓
┌─────────────────────────────────────┐
│ 2. AI 读取 rules/（详细规范）       │
│    - quick-reference.md: 开发流程   │
│    - base.md: 技术栈、API 规范      │
│    - code.md: 代码规范              │
│    - error-patterns.md: 错误模式    │
└─────────────────┬───────────────────┘
                  ↓
┌─────────────────────────────────────┐
│ 3. AI 读取 SKILL.md（项目专属）    │
│    - 开发提示（精选34条）           │
│    - 高频错误链接                   │
│    - 项目特定规范                   │
└─────────────────┬───────────────────┘
                  ↓
              开始开发
```

### **文档更新时的优先级**

```
发现新错误模式
    ↓
┌─────────────────────────────────────┐
│ 1. 更新 error-patterns.md ⭐ 第一  │
│    - 添加到对应类型章节             │
│    - 更新快速索引表                 │
└─────────────────┬───────────────────┘
                  ↓
┌─────────────────────────────────────┐
│ 2. 更新 SKILL.md（可选）            │
│    - 添加高频错误链接               │
│    - 更新开发提示                   │
└─────────────────┬───────────────────┘
                  ↓
┌─────────────────────────────────────┐
│ 3. 更新 CLAUDE.md（很少）           │
│    - 只在架构重大变更时更新         │
└─────────────────────────────────────┘
```

---

## 💡 关键理解

### **1. CLAUDE.md ≠ 完整文档体系**

**❌ 错误理解**：
- "CLAUDE.md 包含了所有开发规范"
- "更新文档就是更新 CLAUDE.md"

**✅ 正确理解**：
- CLAUDE.md 是**入口门面**，提供快速参考
- 完整规范在 `.claude/rules/` 和 `.claude/skills/`
- CLAUDE.md 很少更新，rules/ 和 skills/ 持续更新

---

### **2. rules/ vs skills/ 的分工**

| 维度 | rules/ | skills/ |
|------|--------|---------|
| **性质** | 通用规则 | 项目特定 |
| **可移植性** | 高（可用于其他项目） | 低（仅 WinJin 项目） |
| **内容来源** | 模板（templates/） | 项目实战经验 |
| **更新驱动** | 架构/技术栈变更 | 功能开发/问题解决 |
| **示例** | "async/await 使用规范" | "Sora2 API 双平台差异" |

**类比**：
```
rules/     = "编程语法书"（通用，适用于所有项目）
skills/    = "项目实战手册"（特定，针对当前项目）
CLAUDE.md  = "目录/快速参考卡"（概览，快速查找）
```

---

### **3. 为什么需要三层架构？**

**场景1: 新成员加入**
```
1. 读 CLAUDE.md（5分钟）→ 了解项目基本情况
2. 读 quick-reference.md（10分钟）→ 了解开发流程
3. 读 SKILL.md（20分钟）→ 了解项目特定规范
4. 开始开发（遇到问题时查阅 error-patterns.md）
```

**场景2: AI 开发新功能**
```
1. 读 CLAUDE.md → 项目上下文
2. 读 quick-reference.md → Plan-First 流程
3. 读 SKILL.md → 项目特定规范（如 Sora2 API）
4. 读 error-patterns.md → 避免已知错误
5. 开发完成 → 更新文档
```

**场景3: 遇到问题**
```
1. 在 error-patterns.md 中搜索问题
2. 找到对应的错误模式和解决方案
3. 如果是新问题 → 添加到 error-patterns.md
4. 如果是高频错误 → 在 SKILL.md 中添加链接
```

---

## 🎯 实用建议

### **何时更新哪个文档？**

| 场景 | 更新文档 | 优先级 |
|------|----------|--------|
| 新增错误模式 | error-patterns.md | ⭐⭐⭐ 第一优先 |
| 新增开发提示 | SKILL.md | ⭐⭐ |
| API 端点变更 | base.md + SKILL.md | ⭐⭐ |
| 技术栈变更 | base.md + templates/ | ⭐ |
| 架构重大变更 | CLAUDE.md（很少） | ⚠️ 极少 |

### **如何查找信息？**

```
快速了解 → CLAUDE.md
开发流程 → quick-reference.md
技术规范 → base.md
代码规范 → code.md
错误模式 → error-patterns.md
项目特定 → SKILL.md
```

---

## 📊 数据对比

| 文档 | 行数 | 字符数 | 更新频率 | 主要作用 |
|------|------|--------|----------|----------|
| **CLAUDE.md** | 78 | ~2K | 极低 | 项目入口 |
| **rules/** | ~5,167 | ~160K | 中等 | 详细规范 |
| **skills/** | ~586 | ~20K | 高 | 项目特定 |
| **总计** | ~5,831 | ~182K | - | 完整体系 |

**占比分析**：
```
CLAUDE.md:    1.3%  （门面）
rules/:       88.6% （核心）
skills/:      10.1% （项目特定）
```

---

## ✅ 核心要点

1. **CLAUDE.md 是门面**：快速了解项目，不是完整文档
2. **rules/ 是核心**：详细规范，AI 开发助手的主要输入
3. **skills/ 是精华**：项目特定经验，持续迭代
4. **三层各司其职**：分工明确，互相配合
5. **更新优先级**：error-patterns.md > SKILL.md > rules/ > CLAUDE.md

---

**创建日期**: 2026-01-06
**维护者**: WinJin AIGC 开发团队
