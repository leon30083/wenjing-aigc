# WinJin AIGC å¼€å‘äº¤æ¥ä¹¦

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æ›´æ–°æ—¥æœŸ**: 2025-12-29
**é¡¹ç›®**: WinJin AIGC (å¼€æºé‡æ„ç‰ˆ)
**ä»“åº“**: https://github.com/leon30083/wenjing-aigc.git

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [ç¯å¢ƒè¦æ±‚](#ç¯å¢ƒè¦æ±‚)
3. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
4. [Claude Code é…ç½®ï¼ˆé‡è¦ï¼‰](#claude-code-é…ç½®é‡è¦)
5. [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
6. [å¸¸ç”¨å‘½ä»¤](#å¸¸ç”¨å‘½ä»¤)
7. [API ç«¯ç‚¹](#api-ç«¯ç‚¹)
8. [å¼€å‘è§„èŒƒ](#å¼€å‘è§„èŒƒ)
9. [å…³é”®æ¨¡å—è¯´æ˜](#å…³é”®æ¨¡å—è¯´æ˜)
10. [æ³¨æ„äº‹é¡¹](#æ³¨æ„äº‹é¡¹)
11. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)

---

## é¡¹ç›®æ¦‚è¿°

WinJin AIGC æ˜¯ä¸€ä¸ªåŸºäº Electron + Express çš„ AI è§†é¢‘ç”Ÿæˆå·¥å…·ï¼Œæ”¯æŒï¼š

- **Sora2 è§†é¢‘ç”Ÿæˆ**: æ–‡ç”Ÿè§†é¢‘ã€è§’è‰²å‚è€ƒè§†é¢‘ã€æ•…äº‹æ¿æ‰¹é‡ç”Ÿæˆ
- **è§’è‰²åˆ›å»º**: ä»è§†é¢‘ä¸­æå–è§’è‰²ï¼Œæ”¯æŒè§’è‰²åº“ç®¡ç†
- **åŒå¹³å°æ”¯æŒ**: èšé‘«å¹³å° (api.jxincm.cn) å’Œè´è´å¹³å° (ai.t8star.cn)
- **å†å²è®°å½•**: è‡ªåŠ¨ä¿å­˜ä»»åŠ¡è®°å½•åˆ° JSON æ–‡ä»¶
- **è§’è‰²åº“**: ç®¡ç†åˆ›å»ºçš„è§’è‰²ï¼Œæ”¯æŒæœç´¢å’Œç»Ÿè®¡

---

## ç¯å¢ƒè¦æ±‚

### å¿…éœ€è½¯ä»¶

| è½¯ä»¶ | ç‰ˆæœ¬è¦æ±‚ | ä¸‹è½½åœ°å€ |
|------|----------|----------|
| **Node.js** | 16.x æˆ–æ›´é«˜ | https://nodejs.org/ |
| **npm** | 8.x æˆ–æ›´é«˜ | éš Node.js å®‰è£… |
| **Git** | æœ€æ–°ç‰ˆ | https://git-scm.com/ |
| **Claude Code** | æœ€æ–°ç‰ˆ | https://claude.com/claude-code |

### å¯é€‰è½¯ä»¶

- **VS Code**: æ¨èçš„ä»£ç ç¼–è¾‘å™¨
- **Chrome DevTools**: è°ƒè¯•å‰ç«¯ï¼ˆClaude Code å·²é›†æˆï¼‰

### æ“ä½œç³»ç»Ÿ

- Windows 10/11ï¼ˆä¸»è¦ç›®æ ‡å¹³å°ï¼‰
- macOS/Linuxï¼ˆå…¼å®¹ï¼‰

---

## å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/leon30083/wenjing-aigc.git
cd wenjing-aigc
```

### 2. å®‰è£…ä¾èµ–

```bash
# å®‰è£…é¡¹ç›®ä¾èµ–
npm install
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
copy .env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„ API Key
```

**`.env` æ–‡ä»¶å†…å®¹**:

```bash
# èšé‘«å¹³å° API Keyï¼ˆå¿…å¡«ï¼‰
SORA2_API_KEY=sk-your-actual-juxin-api-key

# è´è´å¹³å° API Keyï¼ˆå¯é€‰ï¼‰
ZHENZHEN_API_KEY=sk-your-actual-zhenzhen-api-key

# æœåŠ¡å™¨ç«¯å£
PORT=9000
```

### 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
# ä»…å¯åŠ¨ HTTP æœåŠ¡å™¨ï¼ˆç”¨äºå¼€å‘æµ‹è¯•ï¼‰
npm run server

# æˆ–è€…å¯åŠ¨å®Œæ•´çš„ Electron åº”ç”¨
npm start
```

æœåŠ¡å™¨å°†åœ¨ `http://localhost:9000` å¯åŠ¨ã€‚

---

## Claude Code é…ç½®ï¼ˆé‡è¦ï¼‰

**âš ï¸ è¿™æ˜¯å¼€å‘çš„æ ¸å¿ƒé…ç½®ï¼Œå¿…é¡»åœ¨æ–°çš„å¼€å‘ç¯å¢ƒä¸­æ­£ç¡®è®¾ç½®ï¼**

### é…ç½®æ–‡ä»¶ä½ç½®

```
.claude/
â”œâ”€â”€ settings.json          # Claude Code è®¾ç½®
â”œâ”€â”€ settings.local.json    # æœ¬åœ°è¦†ç›–è®¾ç½®ï¼ˆä¸æäº¤ï¼‰
â””â”€â”€ rules/                 # å¼€å‘è§„åˆ™
    â”œâ”€â”€ base.md            # åŸºç¡€æŠ€æœ¯æ ˆè§„åˆ™
    â””â”€â”€ code.md            # ä»£ç è§„èŒƒå’Œæœ€ä½³å®è·µ
```

### settings.json é…ç½®

**ä½ç½®**: `é¡¹ç›®æ ¹ç›®å½•/.claude/settings.json`

```json
{
  "mcpServers": {
    "memory": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-memory"]
    },
    "chrome-devtools": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-chrome-devtools"]
    },
    "context7": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-context7"]
    }
  }
}
```

### rules/base.md - æŠ€æœ¯æ ˆçº¦æŸ

**å…³é”®å†…å®¹**:

```markdown
## è¿è¡Œæ—¶ç¯å¢ƒ
- Node.js: 16.x æˆ–æ›´é«˜
- npm: 8.x æˆ–æ›´é«˜

## æ ¸å¿ƒæ¡†æ¶ç‰ˆæœ¬
| æ¡†æ¶/åº“ | ç‰ˆæœ¬è¦æ±‚ |
|---------|----------|
| Electron | ^28.0.0 |
| Express | ^4.18.2 |
| axios | ^1.6.5 |
| dotenv | ^17.2.3 |

## Sora2 API æ”¯æŒå¹³å°
### èšé‘«å¹³å° (api.jxincm.cn)
- åˆ›å»ºè§†é¢‘: POST /v1/video/create
- æŸ¥è¯¢ä»»åŠ¡: GET /v1/video/query?id={taskId} âš ï¸ æŸ¥è¯¢å‚æ•°
- åˆ›å»ºè§’è‰²: POST /sora/v1/characters

### è´è´å¹³å° (ai.t8star.cn)
- åˆ›å»ºè§†é¢‘: POST /v1/video/create
- æŸ¥è¯¢ä»»åŠ¡: GET /v2/videos/generations/{taskId} âš ï¸ è·¯å¾„å‚æ•°
- åˆ›å»ºè§’è‰²: POST /sora/v1/characters

### é‡è¦å·®å¼‚
- æŸ¥è¯¢ç«¯ç‚¹: èšé‘«ç”¨æŸ¥è¯¢å‚æ•° ?id=ï¼Œè´è´ç”¨è·¯å¾„å‚æ•° /{taskId}
- è§’è‰²åˆ›å»º: éƒ½æ”¯æŒ from_task å‚æ•°ï¼ˆæ¨èï¼‰

### è§’è‰²åˆ›å»ºè§„èŒƒ â­
- ç«¯ç‚¹: POST /sora/v1/characters
- å‚æ•°: url æˆ– from_task äºŒé€‰ä¸€
- å¿…å¡«: timestamps (æ ¼å¼: "1,3")
- âš ï¸ ç¦æ­¢: ä¸è¦ä¼ é€’ model å‚æ•°
- âœ… æ¨è: ä¼˜å…ˆä½¿ç”¨ from_task å‚æ•°
```

### rules/code.md - ä»£ç è§„èŒƒ

**å…³é”®å†…å®¹**:

```markdown
## å‘½åçº¦å®š
- æ–‡ä»¶å: kebab-case
- å˜é‡/å‡½æ•°: camelCase
- ç±»å: PascalCase
- å¸¸é‡: UPPER_SNAKE_CASE
- ç§æœ‰æˆå‘˜: å‰ç¼€ä¸‹åˆ’çº¿ _

## Sora2 API å¼€å‘è§„èŒƒ

### å¹³å°å·®å¼‚å¤„ç†
// âœ… æ­£ç¡®ï¼šæ ¹æ®å¹³å°ä½¿ç”¨ä¸åŒçš„æŸ¥è¯¢ç«¯ç‚¹
async getTaskStatus(taskId) {
  if (this.platformType === 'ZHENZHEN') {
    // è´è´ï¼šä½¿ç”¨è·¯å¾„å‚æ•°
    return await this.client.get(`/v2/videos/generations/${taskId}`);
  } else {
    // èšé‘«ï¼šä½¿ç”¨æŸ¥è¯¢å‚æ•°
    return await this.client.get('/v1/video/query', {
      params: { id: taskId }
    });
  }
}

### è§’è‰²åˆ›å»ºè§„èŒƒ â­
// âœ… æ¨èï¼šä»å·²å®Œæˆçš„è§†é¢‘ä»»åŠ¡åˆ›å»ºï¼ˆæ›´å¯é ï¼‰
const taskResult = await waitForTaskCompletion(taskId);
if (taskResult.status === 'SUCCESS') {
  const character = await axios.post('/sora/v1/characters', {
    from_task: taskId,  // ä½¿ç”¨ from_task å‚æ•°
    timestamps: '1,3'
  });
}
```

### é…ç½® Claude Code è‡ªåŠ¨åŠ è½½è§„åˆ™

å½“åœ¨æ–°çš„å¼€å‘ç¯å¢ƒé¦–æ¬¡ä½¿ç”¨ Claude Code æ—¶ï¼š

1. **æ‰“å¼€é¡¹ç›®æ ¹ç›®å½•**
   ```bash
   cd E:\path\to\wenjing-aigc
   ```

2. **å¯åŠ¨ Claude Code**
   - Claude Code ä¼šè‡ªåŠ¨è¯»å– `.claude/settings.json`
   - ä¼šè‡ªåŠ¨åŠ è½½ `rules/` ç›®å½•ä¸‹çš„è§„åˆ™æ–‡ä»¶

3. **éªŒè¯é…ç½®**
   - åœ¨ Claude Code ä¸­è¯¢é—®ï¼šè¯·åˆ—å‡ºå½“å‰é¡¹ç›®çš„æŠ€æœ¯æ ˆ
   - åº”è¯¥è¿”å› base.md ä¸­å®šä¹‰çš„æŠ€æœ¯æ ˆä¿¡æ¯

---

## é¡¹ç›®ç»“æ„

```
wenjing-aigc/
â”œâ”€â”€ .claude/                    # Claude Code é…ç½® â­
â”‚   â”œâ”€â”€ settings.json           # MCP æœåŠ¡å™¨é…ç½®
â”‚   â””â”€â”€ rules/                  # å¼€å‘è§„åˆ™
â”‚       â”œâ”€â”€ base.md             # æŠ€æœ¯æ ˆçº¦æŸ
â”‚       â””â”€â”€ code.md             # ä»£ç è§„èŒƒ
â”œâ”€â”€ data/                       # æ•°æ®æŒä¹…åŒ–ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”‚   â”œâ”€â”€ history.json            # å†å²è®°å½•
â”‚   â””â”€â”€ characters.json         # è§’è‰²åº“
â”œâ”€â”€ downloads/                  # è§†é¢‘ä¸‹è½½ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”œâ”€â”€ reference/                  # å‚è€ƒæ–‡æ¡£
â”‚   â””â”€â”€ ç”¨æˆ·è¾“å…¥æ–‡ä»¶å¤¹/
â”‚       â”œâ”€â”€ å¼€å‘ç»éªŒ/           # å¼€å‘æ–‡æ¡£ â­
â”‚       â”œâ”€â”€ èšé‘«sora2/          # èšé‘« API æ–‡æ¡£
â”‚       â””â”€â”€ è´è´å·¥åŠ/           # è´è´ API æ–‡æ¡£
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/                   # Electron ä¸»è¿›ç¨‹ï¼ˆæš‚æœªä½¿ç”¨ï¼‰
â”‚   â”œâ”€â”€ renderer/               # Electron æ¸²æŸ“è¿›ç¨‹
â”‚   â”‚   â””â”€â”€ public/
â”‚   â”‚       â””â”€â”€ index.html      # Web å‰ç«¯ç•Œé¢
â”‚   â””â”€â”€ server/                 # HTTP æœåŠ¡å™¨ â­
â”‚       â”œâ”€â”€ index.js            # Express æœåŠ¡å™¨ä¸»æ–‡ä»¶
â”‚       â”œâ”€â”€ sora2-client.js     # Sora2 API å®¢æˆ·ç«¯
â”‚       â”œâ”€â”€ history-storage.js  # å†å²è®°å½•å­˜å‚¨
â”‚       â”œâ”€â”€ character-storage.js # è§’è‰²åº“å­˜å‚¨
â”‚       â””â”€â”€ batch-queue.js      # æ‰¹é‡ä»»åŠ¡é˜Ÿåˆ—
â”œâ”€â”€ .env                        # ç¯å¢ƒå˜é‡ï¼ˆä¸æäº¤ï¼‰
â”œâ”€â”€ .env.example                # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ .gitignore                  # Git å¿½ç•¥è§„åˆ™
â”œâ”€â”€ package.json                # é¡¹ç›®ä¾èµ–
â””â”€â”€ README.md                   # é¡¹ç›®è¯´æ˜
```

---

## å¸¸ç”¨å‘½ä»¤

### å¼€å‘å‘½ä»¤

```bash
# å¯åŠ¨ HTTP æœåŠ¡å™¨ï¼ˆæœ€å¸¸ç”¨ï¼‰
npm run server

# å¯åŠ¨ Electron åº”ç”¨
npm start

# å¼€å‘æ¨¡å¼ï¼ˆçƒ­é‡è½½ï¼‰
npm run dev
```

### Git å‘½ä»¤

```bash
# æŸ¥çœ‹çŠ¶æ€
git status

# æäº¤æ›´æ”¹
git add .
git commit -m "feat: your message"
git push origin master

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin master
```

### æµ‹è¯•å‘½ä»¤

```bash
# æµ‹è¯•æœåŠ¡å™¨å¥åº·
curl http://localhost:9000/health

# æµ‹è¯•åˆ›å»ºè§†é¢‘
curl -X POST http://localhost:9000/api/video/create \
  -H "Content-Type: application/json" \
  -d "{\"platform\":\"juxin\",\"prompt\":\"A cat\",\"model\":\"sora-2\"}"
```

---

## API ç«¯ç‚¹

### å¥åº·æ£€æŸ¥
```
GET /health
```

### è§†é¢‘ç”Ÿæˆ
```
POST /api/video/create              # æ–‡ç”Ÿè§†é¢‘
POST /api/video/create-with-character  # å¸¦è§’è‰²å‚è€ƒ
POST /api/video/storyboard          # æ•…äº‹æ¿æ‰¹é‡
POST /api/video/download            # ä¸‹è½½è§†é¢‘
```

### è§’è‰²ç®¡ç†
```
POST /api/character/create          # åˆ›å»ºè§’è‰²
GET  /api/character/list            # è·å–è§’è‰²åˆ—è¡¨
GET  /api/character/stats           # è·å–ç»Ÿè®¡ä¿¡æ¯
GET  /api/character/:id             # è·å–å•ä¸ªè§’è‰²
GET  /api/character/search/:query   # æœç´¢è§’è‰²
DELETE /api/character/:id           # åˆ é™¤è§’è‰²
DELETE /api/character/all           # æ¸…ç©ºæ‰€æœ‰è§’è‰²
```

### ä»»åŠ¡æŸ¥è¯¢
```
GET /api/task/:taskId               # æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€
GET /api/task/:taskId/wait          # ç­‰å¾…ä»»åŠ¡å®Œæˆ
```

### å†å²è®°å½•
```
GET /api/history/list               # è·å–å†å²è®°å½•
GET /api/history/stats              # è·å–ç»Ÿè®¡ä¿¡æ¯
GET /api/history/:taskId            # è·å–å•æ¡è®°å½•
DELETE /api/history/:taskId         # åˆ é™¤è®°å½•
DELETE /api/history/all             # æ¸…ç©ºæ‰€æœ‰è®°å½•
```

### æ‰¹é‡ä»»åŠ¡
```
POST /api/batch/create              # åˆ›å»ºæ‰¹é‡ä»»åŠ¡
POST /api/batch/:id/submit          # æäº¤æ‰¹é‡ä»»åŠ¡
GET  /api/batch/:id/poll            # è½®è¯¢æ‰¹é‡ä»»åŠ¡
GET  /api/batch/:id/status          # è·å–æ‰¹é‡ä»»åŠ¡çŠ¶æ€
GET  /api/batch/list                # è·å–æ‰€æœ‰æ‰¹é‡ä»»åŠ¡
DELETE /api/batch/:id               # åˆ é™¤æ‰¹é‡ä»»åŠ¡
```

---

## å¼€å‘è§„èŒƒ

### ä»£ç é£æ ¼

```javascript
// âœ… æ­£ç¡®çš„å‘½å
const getUserData = () => {};  // camelCase
class UserService {};          // PascalCase
const MAX_RETRIES = 3;         // UPPER_SNAKE_CASE
const _privateVar = 'secret';  // ç§æœ‰æˆå‘˜å‰ç¼€

// âŒ é”™è¯¯çš„å‘½å
const GetUserData = () => {};  // ä¸ä½¿ç”¨ PascalCase
const user_data = () => {};    // ä¸ä½¿ç”¨ snake_case
```

### API è°ƒç”¨è§„èŒƒ

```javascript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ async/await + try-catch
async function createVideo(options) {
  try {
    const response = await axios.post('/api/video/create', options);
    return { success: true, data: response.data };
  } catch (error) {
    return { success: false, error: error.message };
  }
}

// âŒ é”™è¯¯ï¼šä¸ä½¿ç”¨ try-catch
async function createVideo(options) {
  const response = await axios.post('/api/video/create', options);
  return response.data;  // å¯èƒ½æŠ›å‡ºæœªæ•è·çš„å¼‚å¸¸
}
```

### ç»Ÿä¸€å“åº”æ ¼å¼

```javascript
// æˆåŠŸå“åº”
{ success: true, data: {...} }

// å¤±è´¥å“åº”
{ success: false, error: "é”™è¯¯ä¿¡æ¯" }
```

---

## å…³é”®æ¨¡å—è¯´æ˜

### 1. Sora2Client (src/server/sora2-client.js)

**èŒè´£**: å°è£… Sora2 API è°ƒç”¨ï¼Œæ”¯æŒåŒå¹³å°

**å…³é”®æ–¹æ³•**:
```javascript
// åˆ›å»ºè§†é¢‘
await client.createVideo({
  prompt: 'A cat sleeping',
  model: 'sora-2',
  orientation: 'landscape',
  duration: 10,
  size: 'small'
});

// æŸ¥è¯¢ä»»åŠ¡ï¼ˆè‡ªåŠ¨å¤„ç†å¹³å°å·®å¼‚ï¼‰
await client.getTaskStatus(taskId);

// åˆ›å»ºè§’è‰²ï¼ˆæ”¯æŒ from_taskï¼‰
await client.createCharacter({
  from_task: taskId,  // æ¨èæ–¹å¼
  timestamps: '1,3'
});
```

### 2. HistoryStorage (src/server/history-storage.js)

**èŒè´£**: å†å²è®°å½•æŒä¹…åŒ–å­˜å‚¨

**å­˜å‚¨ä½ç½®**: `data/history.json`

**å…³é”®æ–¹æ³•**:
```javascript
// æ·»åŠ è®°å½•
historyStorage.addRecord({
  taskId: 'video_xxx',
  platform: 'juxin',
  prompt: 'A cat',
  model: 'sora-2'
});

// æ ‡è®°å®Œæˆ
historyStorage.markCompleted(taskId, { output: 'url' });

// è·å–æ‰€æœ‰è®°å½•
const records = historyStorage.getAllRecords();
```

### 3. CharacterStorage (src/server/character-storage.js)

**èŒè´£**: è§’è‰²åº“æŒä¹…åŒ–å­˜å‚¨

**å­˜å‚¨ä½ç½®**: `data/characters.json`

**å…³é”®æ–¹æ³•**:
```javascript
// æ·»åŠ è§’è‰²ï¼ˆè‡ªåŠ¨å»é‡ï¼‰
characterStorage.addCharacter({
  id: 'ch_xxx',
  username: 'user.name',
  profilePictureUrl: 'url',
  platform: 'zhenzhen'
});

// æœç´¢è§’è‰²
const results = characterStorage.searchCharacters('user');

// è·å–ç»Ÿè®¡
const stats = characterStorage.getStats();
// { total: 10, byPlatform: { juxin: 5, zhenzhen: 5 } }
```

---

## æ³¨æ„äº‹é¡¹

### âš ï¸ ç¦æ­¢äº‹é¡¹

1. **ç¦æ­¢ä½¿ç”¨ child_process è°ƒç”¨ API**
   ```javascript
   // âŒ é”™è¯¯ï¼šä¼šå¯¼è‡´è¿›ç¨‹åƒµæ­»
   const { spawn } = require('child_process');
   spawn('curl', ['https://api...']);

   // âœ… æ­£ç¡®ï¼šä½¿ç”¨ axios
   const axios = require('axios');
   await axios.post('https://api...', data);
   ```

2. **ç¦æ­¢ç¡¬ç¼–ç  API Key**
   ```javascript
   // âŒ é”™è¯¯
   const apiKey = 'sk-1234567890';

   // âœ… æ­£ç¡®
   const apiKey = process.env.SORA2_API_KEY;
   ```

3. **ç¦æ­¢åˆ›å»ºè§’è‰²æ—¶ä¼ é€’ model å‚æ•°**
   ```javascript
   // âŒ é”™è¯¯ï¼šä¼šå¯¼è‡´ 404 é”™è¯¯
   await axios.post('/sora/v1/characters', {
     model: 'sora-2',  // âŒ åˆ é™¤æ­¤è¡Œ
     url: videoUrl,
     timestamps: '1,3'
   });

   // âœ… æ­£ç¡®
   await axios.post('/sora/v1/characters', {
     from_task: taskId,
     timestamps: '1,3'
   });
   ```

4. **ç¦æ­¢ä½¿ç”¨é”™è¯¯çš„æŸ¥è¯¢ç«¯ç‚¹**
   ```javascript
   // âŒ é”™è¯¯ï¼šå¯¹èšé‘«ä½¿ç”¨è´è´çš„ç«¯ç‚¹
   await axios.get(`https://api.jxincm.cn/v2/videos/generations/${taskId}`);

   // âœ… æ­£ç¡®ï¼šèšé‘«ä½¿ç”¨æŸ¥è¯¢å‚æ•°
   await axios.get('https://api.jxincm.cn/v1/video/query', {
     params: { id: taskId }
   });
   ```

### âœ… æ¨èåšæ³•

1. **è§’è‰²åˆ›å»ºä¼˜å…ˆä½¿ç”¨ from_task**
   - æ›´å¯é ï¼Œé¿å…è§†é¢‘ URL è®¿é—®é—®é¢˜
   - ä»å·²å®Œæˆçš„è§†é¢‘ä»»åŠ¡åˆ›å»º

2. **è½®è¯¢é—´éš”è¦åˆç†**
   - Sora2 è§†é¢‘ç”Ÿæˆéœ€è¦ 3-5 åˆ†é’Ÿ
   - æ¨èè½®è¯¢é—´éš”ï¼š30-60 ç§’
   - è¿‡çŸ­ä¼šå¯¼è‡´ 429 Rate Limit é”™è¯¯

3. **ä½¿ç”¨ç»Ÿä¸€çš„å“åº”æ ¼å¼**
   - æ‰€æœ‰ API è¿”å› `{success, data/error}`
   - ä¾¿äºå‰ç«¯å¤„ç†

4. **è‡ªåŠ¨ä¿å­˜åˆ°å­˜å‚¨**
   - è§†é¢‘åˆ›å»ºæˆåŠŸ â†’ è‡ªåŠ¨ä¿å­˜åˆ°å†å²è®°å½•
   - è§’è‰²åˆ›å»ºæˆåŠŸ â†’ è‡ªåŠ¨ä¿å­˜åˆ°è§’è‰²åº“

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: è§’è‰²åˆ›å»ºè¿”å› 500 é”™è¯¯

**ç°è±¡**: ä½¿ç”¨è§†é¢‘ URL åˆ›å»ºè§’è‰²å¤±è´¥ï¼Œè¿”å› "Request failed with status code 500"

**åŸå› **: è§†é¢‘æ— æ³•è®¿é—®ï¼ˆé˜²ç›—é“¾/è¿‡æœŸ/éœ€è¦ç‰¹æ®Š headersï¼‰

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨ `from_task` å‚æ•°
```javascript
// å…ˆåˆ›å»ºè§†é¢‘ä»»åŠ¡
const videoResult = await client.createVideo({...});
const taskId = videoResult.data.id;

// ç­‰å¾…ä»»åŠ¡å®Œæˆ
const completed = await client.waitForTask(taskId);

// ä»å·²å®Œæˆçš„ä»»åŠ¡åˆ›å»ºè§’è‰²
const character = await client.createCharacter({
  from_task: taskId,
  timestamps: '1,3'
});
```

### é—®é¢˜ 2: æŸ¥è¯¢ä»»åŠ¡è¿”å› HTML

**ç°è±¡**: æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€è¿”å› HTML è€Œä¸æ˜¯ JSON

**åŸå› **: ä½¿ç”¨äº†é”™è¯¯çš„æŸ¥è¯¢ç«¯ç‚¹

**è§£å†³æ–¹æ¡ˆ**:
```javascript
// èšé‘«å¹³å°
GET /v1/video/query?id={taskId}

// è´è´å¹³å°
GET /v2/videos/generations/{taskId}
```

### é—®é¢˜ 3: é¢‘ç¹å‡ºç° 429 é”™è¯¯

**ç°è±¡**: è½®è¯¢ä»»åŠ¡çŠ¶æ€æ—¶é¢‘ç¹è¿”å› 429 Rate Limit

**åŸå› **: è½®è¯¢é—´éš”å¤ªçŸ­

**è§£å†³æ–¹æ¡ˆ**: å°†è½®è¯¢é—´éš”å¢åŠ åˆ° 30-60 ç§’
```javascript
const POLL_INTERVAL = 30000;  // 30ç§’
const TIMEOUT = 600000;       // 10åˆ†é’Ÿ
```

### é—®é¢˜ 4: å‰ç«¯ä¸€ç›´æ˜¾ç¤º "Creating..."

**ç°è±¡**: åˆ›å»ºè§†é¢‘åå‰ç«¯ä¸€ç›´æ˜¾ç¤ºåŠ è½½ä¸­

**åŸå› **: åç«¯ä½¿ç”¨äº† `spawn` å¯¼è‡´é˜»å¡

**è§£å†³æ–¹æ¡ˆ**: æ”¹ç”¨ `await fetch()` æˆ– `await axios()`

### é—®é¢˜ 5: Claude Code ä¸è¯»å–è§„åˆ™æ–‡ä»¶

**ç°è±¡**: Claude Code æ²¡æœ‰åŠ è½½ `.claude/rules/` ä¸­çš„è§„åˆ™

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®ä¿ Claude Code åœ¨é¡¹ç›®æ ¹ç›®å½•å¯åŠ¨
2. æ£€æŸ¥ `settings.json` æ ¼å¼æ˜¯å¦æ­£ç¡®
3. å°è¯•é‡å¯ Claude Code

---

## å¿«é€Ÿå‚è€ƒ

### ç¯å¢ƒå˜é‡é€ŸæŸ¥

```bash
SORA2_API_KEY=sk-xxxxx      # èšé‘«å¹³å° API Key
ZHENZHEN_API_KEY=sk-xxxxx   # è´è´å¹³å° API Key
PORT=9000                    # æœåŠ¡å™¨ç«¯å£
```

### å…³é”®ç«¯å£

- HTTP æœåŠ¡å™¨: `http://localhost:9000`
- å¥åº·æ£€æŸ¥: `http://localhost:9000/health`

### æ•°æ®æ–‡ä»¶ä½ç½®

- å†å²è®°å½•: `data/history.json`
- è§’è‰²åº“: `data/characters.json`
- è§†é¢‘ä¸‹è½½: `downloads/`

### å‚è€ƒæ–‡æ¡£

- å¼€å‘ç»éªŒ: `reference/ç”¨æˆ·è¾“å…¥æ–‡ä»¶å¤¹/å¼€å‘ç»éªŒ/Sora2_Character_Best_Practices.md`
- èšé‘« API: `reference/ç”¨æˆ·è¾“å…¥æ–‡ä»¶å¤¹/èšé‘«sora2/`
- è´è´ API: `reference/ç”¨æˆ·è¾“å…¥æ–‡ä»¶å¤¹/è´è´å·¥åŠ/`

---

## è”ç³»æ–¹å¼

- é¡¹ç›®ä»“åº“: https://github.com/leon30083/wenjing-aigc.git
- é—®é¢˜åé¦ˆ: GitHub Issues

---

**æœ€åæ›´æ–°**: 2025-12-29
**ç»´æŠ¤è€…**: WinJin AIGC Team
